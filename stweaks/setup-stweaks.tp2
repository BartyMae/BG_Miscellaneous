BACKUP ~stweaks/backup~
AUTHOR ~Salk~
VERSION ~1.6~
//README ~stweaks/stweaks-readme.txt~
//MODDER setup_tra none area_variables fail missing_extern fail missing_resref fail missing_eval fail

//! BG1UB files//////////////////////////////////////////////////////////////
ALLOW_MISSING 
	~UBFARM5.DLG~
	~UBFELDAN.DLG~
	~UBMALKAL.DLG~
	~UBSHILO.DLG~
	~UBCORIAN.DLG~
	~UBEDIE.DLG~
	~UBWILTON.DLG~

//! Platform variables //////////////////////////////////////////////////////
ALWAYS
  ACTION_IF FILE_EXISTS_IN_GAME ~fw0125.are~ BEGIN //Tutu
    OUTER_SPRINT tsu ~_~
    OUTER_SPRINT tbg ~_~
    OUTER_SPRINT nml2 ~fw4805~
    OUTER_SPRINT nml3 ~fw0144~
    OUTER_SPRINT nml4 ~fw0145~
  END ELSE BEGIN
    OUTER_SPRINT tsu ~~
    ACTION_IF FILE_EXISTS_IN_GAME ~ar7200.are~ BEGIN //BGT
      OUTER_SPRINT tbg ~bg~
      OUTER_SPRINT ts1 ~1~
      OUTER_SPRINT nml2 ~ar3705~
      OUTER_SPRINT nml3 ~ar7244~
      OUTER_SPRINT nml4 ~ar7245~
    END ELSE BEGIN //BG2
      OUTER_SPRINT tbg ~~
      OUTER_SPRINT ts1 ~~
    END
  END
END

//! Languages ///////////////////////////////////////////////////////////////
AUTO_TRA ~stweaks/%s~
//Uncomment this if the mod gets traified
LANGUAGE ~English~ ~english~ ~stweaks/english/setup.tra~

//! Revised Weapon Proficiencies ////////////////////////////////////////////
BEGIN ~Revised Weapon Proficiencies~
REQUIRE_PREDICATE (GAME_IS ~bg2 tob tutu tutu_totsc~) ~This component only applies to the BG2 engine.~
DESIGNATED 10

COPY ~stweaks/2da/wspatck.2da~ override
COPY ~stweaks/2da/wspecial.2da~ override

STRING_SET 9588 ~You have been given proficiencies with which to start your character. These represent the abilities to use weapons effectively. You may choose from any of the selectable proficiencies available to your character class. If your character is a fighter he will be able to choose the same proficiency up to five times. This will grant him additional levels of specialization with the weapon listed. Keep in mind that a character can use any weapon available to his race and class whether he has proficiency with it or not. However, if he attacks using a weapon he is not proficient with, he suffers a malus to his attack roll (-2 warrior, -5 wizard, -3 rogue, -3 priest), damage (-2) and speed factor (+2).

Proficiency Slot Table:

1 slot:  No penalties.
2 slots: +1 to hit, +1 to damage, an extra half attack.
3 slots: +2 to hit, +3 to damage, an extra half attack, -2 to speed factor.
4 slots: +3 to hit, +4 to damage, an extra attack, -2 to speed factor. 
5 slots: +4 to hit, +5 to damage, an extra one and half attack, -4 to speed factor.~

STRING_SET 32116 ~Proficient: At this level the character can use the selected weapon with no penalties.~

STRING_SET 32117 ~Specialized: At this level the character gains +1 to hit, +1 to damage and an extra 1/2 attack per round with the selected weapon.~

STRING_SET 32118 ~Mastery: At this level the character gains +1 to hit, +2 to damage and -2 to speed factor with the selected weapon.~

STRING_SET 32119 ~High Mastery: At this level the character gains +1 to hit, +1 to damage and an extra 1/2 attack per round with the selected weapon.~

STRING_SET 32120 ~Grand Mastery: At this level the character gains +1 to hit, +1 to damage, -2 to speed factor and an extra 1/2 attack per round with the selected weapon.~

//! Alternate Worldmap //////////////////////////////////////////////////////
BEGIN ~BGT Alternate Worldmap by Dex~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 20

COPY ~stweaks/mos/bpbgtmap.mos~ override

//! Consistent BGT NPC Portraits //////////////////////////////////////////////
BEGIN ~Consistent BGT NPC Portraits~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 30

COPY ~stweaks/bmp/branwel.bmp~ override
COPY ~stweaks/bmp/branwem.bmp~ override
COPY ~stweaks/bmp/branwes.bmp~ override

COPY ~stweaks/bmp/kivanl.bmp~ override
COPY ~stweaks/bmp/kivanm.bmp~ override
COPY ~stweaks/bmp/kivans.bmp~ override

COPY ~stweaks/bmp/nviconl.bmp~ override
COPY ~stweaks/bmp/nviconm.bmp~ override
COPY ~stweaks/bmp/nvicons.bmp~ override

COPY ~stweaks/bmp/viconial.bmp~ override
COPY ~stweaks/bmp/viconiam.bmp~ override
COPY ~stweaks/bmp/viconias.bmp~ override

COPY ~stweaks/bmp/quaylel.bmp~ override
COPY ~stweaks/bmp/quaylem.bmp~ override
COPY ~stweaks/bmp/quayles.bmp~ override

COPY ~stweaks/bmp/nedwinl.bmp~ override
COPY ~stweaks/bmp/nedwinm.bmp~ override
COPY ~stweaks/bmp/nedwins.bmp~ override

COPY ~stweaks/bmp/nimoenl.bmp~ override
COPY ~stweaks/bmp/nimoenm.bmp~ override
COPY ~stweaks/bmp/nimoens.bmp~ override

COPY ~stweaks/bmp/nminscl.bmp~ override
COPY ~stweaks/bmp/nminscm.bmp~ override
COPY ~stweaks/bmp/nminscs.bmp~ override

COPY ~stweaks/bmp/njaheirl.bmp~ override
COPY ~stweaks/bmp/njaheirm.bmp~ override
COPY ~stweaks/bmp/njaheirs.bmp~ override


//! Modified Resources for Salk's customized BG1 to BGT dialog.tlk //////////
// 1) Remove +2 bonus to THAC0 and Damage to AROW08.ITM, AROWKC.ITM and ARROPHE2.ITM
// 2) HALBRD01?
// 3) MISC1B.ITM: Restore Cmisc1b.bam and Gdagg01.bam
// 4) MISC1H.ITM: Restore Ghamm01.bam
// 5) MISC1I.ITM, MISC1J.ITM, MISC2O.ITM and MISC51.ITM: Change weight from 1 to 0
// 6) MISC13.ITM: Restore Gmisc13.bam
// 7) MISC49.ITM: Change weight from 1 to 5
// 8) MISC50.ITM: Change weight from 1 to 3
// 9) MISC55.ITM: Change weight from 100 to 150
// 10) MISC60.ITM: Change weight from 0 to 50
// 11) MISC62.ITM: Restore Gmisc62.bam
// 12) MISC65.ITM: Restore Gmisc65.bam and Imisc65.bam; change weight from 110 to 185; assign string 15843 to General Name
// 13) MISC67.ITM: Restore Gmisc66.bam and Imish66.bam; assign string 16323 to General Name 
// 14) MISC68.ITM: Restore Gmisc68.bam, Imisc68.bam, Cmisc79.bam; assign string 16624 to Identified Name
// 15) MISC70.ITM: Restore Imisc70.bam
// 16) MISC71.ITM: Restore Imisc71.bam
// 17) MISC75.ITM: Restore Imisc75.bam
// 18) MISC77.ITM: Assign string 17301 to Identified Name; assign string 17302 to General Description
// 19) MISC80.ITM: Change weight from 185 to 130
// 20) MISC81.ITM: Change weight from 1 to 3
// 21) MISC92.ITM: Restore Gmisc92.bam
// 22) MISC94.ITM: Restore Gmisc94.bam
// 23) MISC95.ITM: Restore Gmisc95.bam
// 24) POTN47.ITM: Change weight from 0 to 1
// 25) POTN48.ITM: Change weight from 0 to 1
// 26) BOOK68.ITM: Restore Ibook68.bam
// 27) HELM06.ITM: Restore Ihelm06.bam
// New Additions
// 28) MISC72.ITM: Assign Gring01.bam
// More new additions
// 29) Change Identify description as to not break so the fourth wall
BEGIN ~Modified Resources for Salk's customized BG1 to BGT dialog.tlk~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~

DESIGNATED 40

// 1

COPY_EXISTING ~Arow08.itm~ ~override~
              ~ArowKC.itm~ ~override~
              ~Arrophe2.itm~ ~override~ // a TOTSC file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  READ_LONG   0x64 "abil_off"
  READ_SHORT  0x68 "abil_num"
  FOR (index = 0; index < abil_num; index = index + 1) BEGIN
   WRITE_SHORT (%abil_off% + (%index% * 0x38) + 0x14) 0 //THAC0 Bonus
   WRITE_SHORT (%abil_off% + (%index% * 0x38) + 0x1a) 0 //Damage Bonus
  END
 END
BUT_ONLY

// 2 ?

// 3

COPY_EXISTING ~Misc1b.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Gdagg01~ // ground icon
  WRITE_ASCII 0x58 ~Cmisc1b~ // description icon
 END
BUT_ONLY

// 4

COPY_EXISTING ~Misc1h.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Ghamm01~ // ground icon
 END
BUT_ONLY

// 5

COPY_EXISTING ~Misc1i.itm~ ~override~ //totsc file
              ~Misc1j.itm~ ~override~ //totsc file
              ~Misc2o.itm~ ~override~ //totsc file
              ~Misc51.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 0 // weight
 END
BUT_ONLY

// 6

COPY_EXISTING ~Misc13.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Gmisc13~ // ground icon
 END
BUT_ONLY

// 7

COPY_EXISTING ~Misc49.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 5 // weight
 END
BUT_ONLY

// 8

COPY_EXISTING ~Misc50.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 3 // weight
 END
BUT_ONLY

// 9

COPY_EXISTING ~Misc55.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 150 // weight
 END
BUT_ONLY

// 10

COPY_EXISTING ~Misc60.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 50 // weight
 END
BUT_ONLY

// 11

COPY_EXISTING ~Misc62.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Gmisc62~ // ground icon
 END
BUT_ONLY

// 12

COPY_EXISTING ~Misc65.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 185 // weight
  WRITE_ASCII 0x3a ~IMISC65~ // inventory icon
  WRITE_ASCII 0x44 ~Gmisc65~ // ground icon
  SAY NAME1 @15843
  SAY DESC @15842
 END
BUT_ONLY

// 13

COPY_EXISTING ~Misc67.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~Imisc66~ // inventory icon
  WRITE_ASCII 0x44 ~Gmisc66~ // ground icon
  SAY NAME1 @16324
  SAY DESC @16323
 END
BUT_ONLY

// 14

COPY_EXISTING ~Misc68.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x58 ~Cmisc79~ // Description Icon
  WRITE_ASCII 0x3a ~Imisc68~ // inventory icon
  WRITE_ASCII 0x44 ~Gmisc68~ // ground icon
  SAY NAME2 @16624
  SAY DESC @16625
 END
BUT_ONLY

// 15

COPY_EXISTING ~Misc70.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~Imisc70~ // inventory icon
 END
BUT_ONLY

// 16

COPY_EXISTING ~Misc71.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~Imisc71~ // inventory icon
 END
BUT_ONLY

// 17

COPY_EXISTING ~Misc75.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~Imisc75~ // inventory icon
 END
BUT_ONLY

// 18

COPY_EXISTING ~Misc77.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  SAY NAME2 @17301
  SAY DESC @17302
 END
BUT_ONLY

// 19

COPY_EXISTING ~Misc80.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 130
 END
BUT_ONLY

// 20

COPY_EXISTING ~Misc81.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 3 // weight
 END
BUT_ONLY

// 21

COPY_EXISTING ~Misc92.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Gmisc92~ // ground icon
 END
BUT_ONLY

// 22

COPY_EXISTING ~Misc94.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Gmisc94~ // ground icon
 END
BUT_ONLY

// 23

COPY_EXISTING ~Misc95.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Gmisc95~ // ground icon
 END
BUT_ONLY

// 24

COPY_EXISTING ~Potn47.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  SAY IDENTIFIED_DESC @300
  WRITE_LONG 0x34 500 // price
  WRITE_LONG 0x4c 1 // weight
 END
BUT_ONLY

// 25

COPY_EXISTING ~Potn48.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_LONG 0x4c 1 // weight
 END
BUT_ONLY

// 26

COPY_EXISTING ~Book68.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~Ibook68~ // inventory icon
 END
BUT_ONLY

// 27

COPY_EXISTING ~Helm06.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~Ihelm06~ // inventory icon
 END
BUT_ONLY

// 28

COPY_EXISTING ~Misc72.itm~ ~override~ //totsc file
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x44 ~Gring01~ // inventory icon
 END
BUT_ONLY

COPY ~stweaks/misc~ override

// 29

// Spells descriptions

STRING_SET 12161 ~Identify
Level: 1
School: Divination
Range: Personal
Duration: Instant
Casting Time: Special
Area of Effect: 1 item
Saving Throw: None

When this spell is cast, name and enchantments (including curses) of one item subsequently touched by the wizard are revealed without fail. Many unidentified items can still be used, but at great risk.~

//! Additional Portraits for non-joinable BG1 NPCs //////////////////////
BEGIN ~Additional Portraits for non-joinable BG1 NPCs~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 50

  COPY ~stweaks/portraits~ ~override~
  /* Standard Non-Joinable Actors */
  COPY_EXISTING ~alatos.cre~ ~override~
    WRITE_ASCII 0x34 ~alatos~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~albert.cre~ ~override~
    WRITE_ASCII 0x34 ~albers~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~alyth.cre~ ~override~
    WRITE_ASCII 0x34 ~alyths~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~amaran.cre~ ~override~
    WRITE_ASCII 0x34 ~amarans~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~sarev1.cre~ ~override~
    WRITE_ASCII 0x34 ~armoreds~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~bjorni.cre~ ~override~
    WRITE_ASCII 0x34 ~bjorns~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~bassil.cre~ ~override~
    WRITE_ASCII 0x34 ~bass~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~belt.cre~ ~override~
    WRITE_ASCII 0x34 ~belts~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~brage.cre~  ~override~
                ~brage2.cre~ ~override~
    WRITE_ASCII 0x34 ~brages~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~brilla.cre~ ~override~
    WRITE_ASCII 0x34 ~brilles~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~farmbr.cre~ ~override~
    WRITE_ASCII 0x34 ~bruns~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~cadder.cre~ ~override~
    WRITE_ASCII 0x34 ~cadds~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~coksmth.cre~ ~override~
    WRITE_ASCII 0x34 ~peters~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~davaeo.cre~ ~override~
    WRITE_ASCII 0x34 ~daverons~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~drizzt.cre~ ~override~
    WRITE_ASCII 0x34 ~drizzts~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~drienn.cre~ ~override~
    WRITE_ASCII 0x34 ~driens~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~elmin2.cre~  ~override~
                ~elmin3.cre~  ~override~
                ~elmin5.cre~  ~override~
                ~elmins4.cre~ ~override~
    WRITE_ASCII 0x34 ~elmins~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~gerde.cre~ ~override~
    WRITE_ASCII 0x34 ~gerdes~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~greywo.cre~ ~override~
    WRITE_ASCII 0x34 ~greyws~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~jessup.cre~ ~override~
    WRITE_ASCII 0x34 ~jessups~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~halbaz.cre~ ~override~
    WRITE_ASCII 0x34 ~halbazs~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~liia.cre~ ~override~
    WRITE_ASCII 0x34 ~liias~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~larze.cre~ ~override~
    WRITE_ASCII 0x34 ~larzes~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~keldda.cre~ ~override~
    WRITE_ASCII 0x34 ~keldaths~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~korax.cre~ ~override~
    WRITE_ASCII 0x34 ~koraxs~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~mulahe.cre~ ~override~
    WRITE_ASCII 0x34 ~mulahs~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~narlen.cre~ ~override~
    WRITE_ASCII 0x34 ~narlens~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~niemai.cre~ ~override~
    WRITE_ASCII 0x34 ~niemais~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~petrin.cre~ ~override~
    WRITE_ASCII 0x34 ~petrins~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~rielta.cre~ ~override~
    WRITE_ASCII 0x34 ~rieltars~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~seniya.cre~ ~override~
    WRITE_ASCII 0x34 ~seniyas~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~thalan.cre~ ~override~
    WRITE_ASCII 0x34 ~thalas~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~vai.cre~ ~override~
    WRITE_ASCII 0x34 ~ofvais~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~shoal.cre~ ~override~
    WRITE_ASCII 0x34 ~shoals~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~tamoko.cre~ ~override~
    WRITE_ASCII 0x34 ~tamokos~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~tenya.cre~  ~override~
                ~tenya2.cre~ ~override~
    WRITE_ASCII 0x34 ~tenyas~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~pumberl.cre~ ~override~
    WRITE_ASCII 0x34 ~umbpr2s~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~pumber2.cre~ ~override~
    WRITE_ASCII 0x34 ~umbprs~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~winthr2.cre~ ~override~
                ~winthr3.cre~ ~override~
                ~innke2.cre~ ~override~
    WRITE_ASCII 0x34 ~winthrs~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~yago.cre~ ~override~
    WRITE_ASCII 0x34 ~yagos~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~angelo.cre~ ~override~
    WRITE_ASCII 0x34 ~angelos~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~arkush.cre~ ~override~
    SAY NAME1 ~Arkushule~
    SAY NAME2 ~Arkushule~
    WRITE_ASCII 0x34 ~arkushs~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~brielb.cre~ ~override~
    SAY NAME1 ~Brielbara~
    SAY NAME2 ~Brielbara~
    WRITE_ASCII 0x34 ~briels~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~deltan.cre~  ~override~
                ~deltan2.cre~ ~override~
    WRITE_ASCII 0x34 ~eltans~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~gorion.cre~  ~override~
                ~gorion3.cre~ ~override~
    WRITE_ASCII 0x34 ~gorions~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~sarevo.cre~  ~override~
                ~sarevo2.cre~ ~override~
    WRITE_ASCII 0x34 ~sarevoks~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~scar.cre~ ~override~
    WRITE_ASCII 0x34 ~scars~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~vail.cre~ ~override~
    WRITE_ASCII 0x34 ~vails~//  small portrait
  BUT_ONLY
  COPY_EXISTING ~volo.cre~ ~override~
    WRITE_ASCII 0x34 ~volos~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~tazok.cre~  ~override~
                ~tazok2.cre~ ~override~
    WRITE_ASCII 0x34 ~tazoks~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~chase.cre~  ~override~
    WRITE_ASCII 0x34 ~chases~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~dryad.cre~  ~override~
    WRITE_ASCII 0x34 ~dryadcps~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~fireb1.cre~ ~override~
                ~firebe.cre~ ~override~
    WRITE_ASCII 0x34 ~fbehs~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~keeper.cre~ ~override~
    WRITE_ASCII 0x34 ~keepers~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~silke.cre~ ~override~
    WRITE_ASCII 0x34 ~silkes~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~gatewa.cre~ ~override~
                ~gatewa2.cre~ ~override~
    WRITE_ASCII 0x34 ~gatewars~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~joia.cre~ ~override~
    WRITE_ASCII 0x34 ~joias~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~marl.cre~ ~override~
    WRITE_ASCII 0x34 ~marls~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~perdue.cre~ ~override~
    WRITE_ASCII 0x34 ~perdues~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~winski.cre~ ~override~
    WRITE_ASCII 0x34 ~winskis~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~winski2.cre~ ~override~
    WRITE_ASCII 0x34 ~winskis~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~taerom.cre~ ~override~
    WRITE_ASCII 0x34 ~taeroms~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~tarnes.cre~ ~override~
    WRITE_ASCII 0x34 ~tarness~ #8 //  small portrait
  BUT_ONLY
// New associations
  COPY_EXISTING ~riggilo.cre~ ~override~
    WRITE_ASCII 0x34 ~riggilos~ #8 //  small portrait
  BUT_ONLY
  COPY_EXISTING ~calaha.cre~ ~override~
    WRITE_ASCII 0x34 ~calahas~ #8 //  small portrait
  BUT_ONLY

  /* Miloch's Gnome Portraits */
  COPY_EXISTING ~bently.cre~ ~override~ // Bentley Mirrorshade
    WRITE_ASCII 0x34 ~bentlys~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~galtok.cre~ ~override~ // Galtok (in Nashkel Mines)
    WRITE_ASCII 0x34 ~galtoks~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~gellan.cre~ ~override~ // Gellana Mirrorshade (in FAI Temple of Wisdom)
    WRITE_ASCII 0x34 ~gellans~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~hafiz.cre~ ~override~ // Hafiz (in Gibberling Mountains)
    WRITE_ASCII 0x34 ~hafizs~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~landri.cre~ ~override~ // Landrin (in FAI L3)
    WRITE_ASCII 0x34 ~landris~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~madarc.cre~ ~override~ // Mad Arcand (in Shipwreck's Coast)
    WRITE_ASCII 0x34 ~madarcs~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~mutami.cre~ ~override~ // Mutamin (in Mutamin's Garden)
    WRITE_ASCII 0x34 ~mutamis~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~neb.cre~ ~override~ // Neb (in SW Baldur's Gate FF HQ L1)
    WRITE_ASCII 0x34 ~nebs~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~pheirk.cre~ ~override~ // Pheirkas (in NW Baldur's Gate)
    WRITE_ASCII 0x34 ~pheirks~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~sarhed.cre~ ~override~ // Sarhedra (in Lonely Peaks)
    WRITE_ASCII 0x34 ~sarheds~ #8 // Small portrait
  BUT_ONLY
  COPY_EXISTING ~unshey.cre~ ~override~ // Unshey (in Friendly Arm Inn L2)
    WRITE_ASCII 0x34 ~unsheys~ #8 // Small portrait
  BUT_ONLY

//! SixofSpades Extended Sarevok's Diary  ///////////////////////////////////
BEGIN ~SixofSpades Extended Sarevok's Diary~
DEPRECATED @2
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 60

  COPY_EXISTING ~SCRL3F.itm~ ~override~
    SAY UNIDENTIFIED_DESC ~The Personal Diary of Sarevok

This diary looks to be important.  You should probably keep it on your person, as it could be a key piece of incriminating evidence regarding Sarevok's involvement in the iron crisis and bandit raids, as well as some rather interesting insight into his murderous heritage. Some of the more relevant entries are as follows:


21st of Nightal, 1366:  Father seems to be plotting something major, but as usual, he is not revealing any details of the plan to me.  The conversations in his study lately have tended toward the Cloakwood and its natural defenses, and pumping water from caves.  I have been able to piece together nothing from this, nor do I know the men who have been visiting him.  This will change.

11th of Ches, 1367:  Another violent dream.  I was a boy again, and a dog was barking at me, so I killed it with the dagger I found in my hand, the same bone dagger from the other dreams.  Mother started to chastise me, and I ripped out her throat.  Her blood was fresh, but I already had old blood on my hands, and my fingers had strangely turned into claws.  The dog's head came back to life; its eyes were solid black.  "Like father, like son," it said.  I felt quite calm during the dream, but when I awoke I found I had been crying.  Is this weakness?  I must expunge it.

14th of Mirtul, 1367:  The ceremony marking the completion of my Deathbringer training seemed rather anticlimactic to me, but my performance seems to have impressed father.  He took me aside and informed me that tomorrow, he shall reveal to me what he has been plotting these past few months, and even grant me a major role in it, if his associates agree.  He assures me that it is a far-reaching plan, and I should not be disappointed with my responsibilities.  My interest is quite piqued.
Cythandria was also quite pleased with my display this morning, so much so that it took her hours to fully express her appreciation.  When we first grew close, I remember how glad I was to find someone who was not repulsed by my affinity for death, but tonight I realized that her thirst is not like mine after all:  She has no real desire to get in close and perform the deed herself, she prefers to derive her thrill vicariously.  And whether she feels the genuine rush of bloodlust as I do, or if she merely thinks of it as a way to excite her arousal, I am not sure. . . but I fear it is the latter.

15th of Mirtul, 1367: Father has finally informed me of his secret, and frankly, it sounds rather pathetic, not worth any excitement at all.  All father has is the location of a mine concealed deep in the Cloakwood, unknown to anyone else but the virtually extinct Orothiar dwarf clan, and according to them still rich in iron ore when it was accidentally flooded years ago.  Bah.  Iron?!  I had guessed something similar, but from all of father's caution and secrecy, I was anticipating a treasure much more glamorous than a stupid iron mine.  Where is the glorious blood-rush that awaits me?  I did not spend years of combat training just to assist in father's counting-house.  I feel the need for a challenge much more exciting than the rabble I have been wasting my skills on.  I feel the need to finally slay something worthy of the strength I have been sensing awakening within me.

8th of Flamerule, 1367:  Today, father introduced me to his subordinates Davaeorn and Tranzig, who have made the journey to the hidden mine and confirmed that it could be put into use once again. 
This evening, I was approached on the street by a ragged beggarly man who would not give his name, but thrust a book into my hands and said he would be back.  The book is worthless, a common third-rate account of the Time of Troubles, and in horrible condition as well; nearly every single page is torn in some way.  Yet something about the man tells me he was more than a simple lunatic.

9th of Flamerule, 1367:  This night's dream was very strange: it was back in the temple, except that every single priestess had MY face, and held an identical bone dagger.  I looked toward the altar where I had always been before, but instead of ME tied to the stone slab, it was the tattered book from yesterday.  I had a dagger too, and when I stabbed the book, it bled.  The blood, and then the book itself, dissolved into a sort of magical energy which overflowed the gutters in the altar and then evaporated into the air.  I awoke to what felt like an icy grip trying to shatter my heart.  I immediately examined the book again.  It was damaged deliberately: no two rips line up, and the only pages that were NOT torn have to do with the killing of Bhaal and his efforts to ensure his legacy.  The more I think about what this might mean, the more I hesitate to write it down, even here.

14th of Eleint, 1367:  Cormyr has instituted a ban against the Iron Throne from operating within their borders.  While this is a great blow to the Iron Throne, it is the perfect opportunity for father to approach the Throne high council with his proposal.  If things go well, we could begin the operation within the year. 
In more personal matters, my curiosity about my ancestry grows unceasingly; I simply must know if the dreams speak the truth.  I will not believe the words of phantoms without proof, but the Priest of Bhaal I confronted today gave me nothing: he was old and died quickly in my grasp.  If the words are true, I shall surely groom stronger acolytes than this.

20th of Eleint, 1367:  The ragged man has finally reappeared, this time without his disguise.  He gives the name of Winski Perorate, and confirms my suspicions: I am indeed one of the fallen Bhaal's many offspring.  He claims to have been apprenticed to a Deathstalker, and therefore knows the signs.  He has spent the past few years on the move, tracking down as many of the children as he can, but it seems that I am the most promising of them all, and he apparently intends to train me as his sole pupil.  He has already informed me that I could not have chosen a more appropriate path than that of Deathbringer.  I think I shall enjoy this very much.

28th of Eleint, 1367:  Davaeorn reports that the mines at Cloakwood have been drained and are ready for use.  This revelation should help greatly in convincing the Throne high council.  Rieltar is setting up a base in Baldur's Gate, in the mansion of a destitute noble family, and everything is running smoothly. 

19th of Marpenoth, 1367:  The Iron Throne council has agreed to support father's plan.  He has been given all the resources he needs, as well as leadership of the project.  I have expressed interest to my 'father', and as promised, he is including me within the operations along the Sword Coast.  He is sending me, as his representative, to make contact with some of the mercenary groups operating to the east.  He mentioned mother in our conversation: how I wasn't to be disloyal to him as she had.  He made it clear that I would suffer her fate if I was.  His threats are weak and hollow, and I shall listen to them for only so long. 
I am tempted to take the opportunity to make a side visit to Candlekeep on the return trip.  There are some things about my heritage that even Winski does not know, and the exact text of the prophecies of Alaundo should prove most illuminating.

30th of Marpenoth, 1367:  I met with the leaders of the Chill, and Black Talons.  I have little liking for Ardenor, commander of the Chill, but Taugosz seems to be a man of his word.  It is a good thing, as I'll have to work with these mercenaries for the full duration:  Rieltar is even supporting placing me in command of this entire wing of the operation.  But it would not do, of course, for the adopted son of an Iron Throne leader to be seen visiting the bandits, so I have chosen the half-ogre Tazok as my figurehead; his abilities and loyalty to me are very satisfactory.

3rd of Uktar, 1367:  A new dream this night.  Mother was talking to me, but as she did her face became bloated and discolored.  Her voice became weaker as she spoke to me, telling me to save her from Rieltar.  I could see the garrote cutting into her neck, but I did nothing.  It was only a dream.

8th of Uktar, 1367:  Today I returned to our newly-completed headquarters in Baldur's Gate and reported to Rieltar.  The fool still insists on calling me his son, and for now I will let him.  He assumes that I am loyal to him because he raised me.  Well, loyal I am, but only as long as he is useful.  He has indeed placed me in full command of the mercenary operations, while he supervises the doppelganger intrigues and Davaeorn oversees the mining angle.  The demonstration of the mineral poison was most impressive.

9th of Uktar, 1367:  Winksi has similarly occupied himself well during my absence, and today presented me with the location of a nearby sect of Cyricists, who have made a particular practice of researching everything they can about Bhaal, and especially his successor.  It only makes sense that Cyric would be very interested in the offspring of his fallen foe, rising to reclaim his portfolio.  Winski wants to capture one or more of their leaders and extract their knowledge from them, but I say we should shoot higher and interrogate them all.  But that requires more than just two people, so I shall begin carefully selecting followers.  Though I fully realize that my heritage should remain a general secret, especially from Rieltar, it is time that the Son of Murder had the acolytes he deserves.

14th of Uktar, 1367:  Cythandria reacted to my revelation exactly as I thought she would:  She immediately saw herself as a queen or an idol of worship, the only fitting roles for the consort of the Lord of Murder.  Only after several minutes of imagining life seated at my right hand did she think to pay me any proper homage or obeisance.  If I had the luxury of choice, I would not have to put up with this kind of attitude, but I need to establish a power base of my own, so I shall tolerate it. . . for now.  There will be time for correction later.

Feast of the Moon, 1367:  The Cyricists are ours, and we have begun pumping them for information, with Zhalimar taking over whenever other matters call me away.  I have ordered that the younger members be kept alive, except to serve as useful examples to motivate the elder priests to be more forthcoming.  What Winski is most concerned about is that some mysterious "ward of Gorion" is mentioned in the prophecies, and is said to play a major role in the succession to Bhaal's portfolio, but there is no depiction of this rune or sigil anywhere, nor does he know what its significance might be.  It is a pity that Gorion is not a more uncommon name.

17th of Nightal, 1367:  Mulahey has established himself at the mines of Nashkel, and should already be converting the kobolds to follow him as their leader.  I expect they will begin contaminating the ore soon, though it will take some time before it becomes evident on the surface.  Only a few slaves have begun to mine out the ore at Cloakwood, though once the bandit raids begin I will be sending Davaeorn a steady supply of new slaves.  I wish I could lure Davaeorn into joining my little cult, knowing that he still secretly worships Bhaal, but he has some deep distrust of me, even after I dropped hints about my true parentage.

29th of Nightal, 1367:  Tamoko has displayed surprising skill in demoralizing some of the most resistant Cyricists.  The way she slew one of the junior members, and then later quietly re-animated his corpse to attack his sleeping former comrades, was a sheer treat to watch.  I was quite surprised that she had the audacity to rouse me directly out of my bed for the latter portion, however.  Not that I needed an excuse to leave Cythandria's company:  She complains far too much.

6th of Hammer, 1368:  The Flaming Fist have finally begun to take notice of our little mercenary operation, and have dispatched several small contingents to the Coast Way to try to fend off the bandit raids.  I shall order all the men to, in the event of capture, claim Zhentish allegiance, and I shall provide them with corroborative details to make the lie more convincing.  I am sure the Zhents at Darkhold won't be pleased to know that their name has been falsely used, but we cannot have the authorities catching our scent.  Meanwhile, we have successfully infiltrated Angelo into the Flaming Fist, and I am instructing him in military strategy:  Once this new talent of his gets recognized, he will be sure to get promoted, giving us a valuable spy right under Eltan's nose.

22nd of Hammer, 1368:  More revelations from the Cyricists: after intense examination, we finally got some names and numbers.  I wonder what is so important about Saradush?  It seems Bhaal spawned literally hundreds of offspring, all over Faerun, but only twenty of these shall be of any real importance, and from them, five shall almost make the heavens themselves tremble in fear.  This is very promising.  But it seems that the head priest of Cyric is as in the dark as to this 'ward of Gorion' as we are.  Blast!  I shall have to find an opportunity to enter Candlekeep after all.

14th of Alturiak, 1368:  In Candlekeep at last, and though Winski was too ill to leave Baldur's Gate, my research has gone well.  The monks here are quite helpful.  From what I have read, it is beyond all doubt that the blood of Bhaal flows through my veins.  Alaundo's prophecies are, of course, anything but explicit, but I think I understand them.  Bhaal's children bear the marks of chaos, have power with no direction, shall feel the blood of a god within them, and shall be driven to cause death and destruction, especially among each other.  "The deaths they bring shall awaken the father, and through them he will rise."  The wording is somewhat ambiguous, but obviously this means that death wrought by the children will cause them to ascend.  Fitting, and since the father was the Lord of Murder, proving one's worth must involve an act in accordance with his portfolio.  I begin to see what I must do.  Death on a god-like scale. 

15th of Alturiak, 1368:  Winski was a fool.  "Gorion's ward" is not any sort of glyph at all, but rather a brat named <CHARNAME>, a few years younger than myself.  And Gorion himself, though even older now, is doubtless the very same man from the temple, all those long years ago.  How ironic that the face that has been etched upon my brain for most of my life has been, for all this time, living as a monk practically on my doorstep.  And while I have nothing to prove it, I believe that <CHARNAME> was that same squealing baby in the soiled diaper.  And THIS little pipsqueak is to have monumental importance in the fulfillment of MY destiny?  The very idea seems ludicrous.  I barely got more than a glimpse today, but <CHARNAME> seems nothing more than a blissfully ignorant whelp, with next to no training whatsoever.  Hardly a figure to shake the deities.  But Gorion troubles me.  He seems to have taken an interest in my readings; I must be careful to be more clandestine in my research.

16th of Alturiak, 1368:  I take my leave of Candlekeep now, and not a moment too soon, for I am sure that Gorion has perceived my heritage.  I wish I could simply kill him, but I doubt I could safely murder him within this damnable library.  One thing I am certain of: <CHARNAME> is, in actuality, one of Bhaal's brood as well.  All the markings are there, and it would explain Gorion's curiosity of my studies, as well as <CHARNAME>'s being mentioned in the prophecy.  Though there is nothing I can do now, I will have to make certain to return and kill the little brat.  It would be foolish of me to let one of my siblings live, especially one being brought up by Harpers (and I am sure that is where Gorion's allegiances lay).  And I expect that Bhaal's power would be shared among his surviving children, so obviously I must make sure that I am the last man standing.  If I am to inherit the Throne of Bhaal, I want it all for myself.

19th of Alturiak, 1368:  The last of our little Cyric cult has died, but I think we wrung everything useful from them in time.  Winski largely shares my opinion about <CHARNAME> in that the child's death is almost certainly called for, but advises me to stop short of actual murder until he can determine exactly what sort of role 'Gorion's ward' is expected to play.  Very well, I can wait.  Winski's health seems to be failing him, so he has deputized Semaj to take over the business of sniffing out any possible Bhaalspawn in the area, and luring them to the Iron Throne on the pretense of business reasons.  Those I deem a possible threat I shall kill myself, the rest I will let Semaj deal with in some way.  I have discreetly commissioned a fine suit of armor and sword, worthy of the next Lord of Murder, and have postponed my fratricidal activities until I can dress the part.

17th of Ches, 1368:  Everything proceeds well.  The ore coming from Nashkel has started to deteriorate, and the mercenaries have been doing a fine job at seizing any iron caravans on route to Baldur's Gate.  Though some of my men have been captured, the Zhent story is holding up well, so no trouble has fallen on the Iron Throne.  But I will have to be wary for Zhentish agents in the coming months. 
I am actually a bit disappointed in Rieltar:  His skill in manipulating this whole iron plot notwithstanding, he sees it as nothing more than another way to make money, and increase his own status within the Iron Throne hierarchy.  Bah!  Who cares about the petty intrigues of one pathetic mercantile organization, when one can control the armies of entire nations?  Ah, well.  His blindness is my gain.

25th of Tarsakh, 1368:  The armor is completed, and is wonderfully appropriate for the terrifying presence of a Deathbringer descended from the Lord of Murder.  I shall have to congratulate Winski for helping with the design, especially the additional enchantments awakened only by the presence of the Bhaal essence.  The sword shall not be finished for another day or two, but it seems appropriate that I should kill my first sibling with my own bare hands.  Goodbye, Colin de'Graage.  You are not one of the twenty; Alaundo never gave a damn about you, and neither do I. 

28th of Tarsakh, 1368:  The Sword of Chaos is glorious.  The time is now ripe to deal with that old codger Gorion, and his little whelp.  I will have to inform my men that I'll be gone for the next few days.  Cythandria was furious when she learned I am taking Tamoko instead of her.  Perhaps this will motivate her to support me in areas other than just the bedroom.

2nd of Mirtul, 1368:  My long-delayed revenge on the withered old man is complete.  I actually killed him a bit too quickly; I wanted enough time to look into his dying eyes and remind him of where we had met before.  Ah well, it is of no real consequence.  What a pair of prize fools he and his little puppy were, fleeing Candlekeep under cover of night, neither one of them carrying any more than a few pitiful scraps of equipment.  Semaj's agents scared them right into our ambush.  Unfortunately, the whelp got away; took off running like a terrified jackrabbit after only a single spell.  I would have told Tamoko to follow him, but between my laughter and my lust for vengeance, it slipped my mind.  Still, with the old fool gone, the young fool shall not be far behind.  From what I have seen, I would expect anyone with <CHARNAME>'s level of skill and bravery to simply get lost in the wilderness, and die of exposure after a day or two.  A fitting end for the prize pupil of the man who thought I was less important than a squealing infant.  I return to Baldur's Gate, and the list of brothers and sisters who are actually worthy of death by my hand.  Just to be on the safe side, I have contacted Semaj's little network, and added <CHARNAME>'s name to those whose deaths will be rewarded.

9th of Mirtul, 1368:  Well, well!  Not only has <CHARNAME> NOT gotten eaten by gibberlings as I expected, but has also survived the best attempts of two of Semaj's bounty hunters, fallen in with a group of adventurers, and safely met with the mayor of Nashkel!  It appears there may be a spine in there after all.  Still, it is obvious that this little war party seeks to disrupt our activities in the mines; happily, Tazok and Tranzig have been well prepared for this sort of thing, and know just what to do.

15th of Mirtul, 1368:  The loss of Nashkel was a shocking blow to us, but we can recover; at the emergency meeting, we agreed that the best solution would be to send some of our own men into Nashkel, if not into the mine itself, and corrupt as much ore as possible without getting caught.  I suggested that the most opportune time would be during transit: whether as ore-cart drivers or caravan guards, our men should easily be able to contaminate the iron, since everyone else would be watching the horizon, not the wagons, and in the event of an attack by our mercenaries, the Black Talons would already have a couple of their men planted among the enemy.  After some debate, even Davaeorn was made to see the wisdom of this.  The best part is that even if we only manage to poison SOME of the ore shipped out of Nashkel, rumors will start circulating that the town's iron is still just as tainted as before, they're just claiming that it's pure and shipping it out anyway.  Some might even say that the entire adventuring party was just a lie that Nashkel made up, so people would start buying their iron again.  I will mention this additional angle to Rieltar tomorrow.  Still, the news that <CHARNAME> is still alive, despite all odds, troubles me greatly.  I shall talk the matter over with Winski, and then strike.  Personally, if I can find the time.

24th of Mirtul, 1368:  Hellfire and damnation!  I cannot believe the dispatches, but there is no denying them.  With Tazok's camp destroyed, I shall have to establish a roaming base of operations, and supervise it myself.  Rieltar and Davaeorn have agreed to this largely because, in my new armor, I cannot be recognized and traced back to the Iron Throne.  But blast it all, in addition to the loss of men, this will take up ALL of my time, and I shall even have to recall most of the death squads that I had ordered to seek out and ambush <CHARNAME> and company.  The situation looks dire, <CHARNAME> already knows far too much.  At least their next move is predictable; Davaeorn and a crew hand-picked by Rieltar have already left to personally guard the mines.  So let <CHARNAME>'s little band follow the trail of clues if they wish.  Just let them TRY to struggle through the Cloakwood, and may they all perish in the attempt.  Myself, I care little whether they find the mine or not; the men there belong to Davaeorn and Rieltar, not me.  I must use this time to recollect the scattered mercenaries into something useful once again.

9th of Kythorn, 1368:  Back in Baldur's Gate, briefly, for the emergency meeting I had been expecting.  The news from the Cloakwood has predictably driven Rieltar half-mad with worry.  I admit that things have not gone anything like the way we planned, but I think we can still turn this to our advantage.  For one thing, I strongly doubt that <CHARNAME> was able to carry more than a hundred tons of iron ore out of the Cloakwood, meaning that it's still there, waiting for our barges to come pick it up, just as arranged.  The trick will be manipulating the public opinion:  I must find some way to place the blame for the iron crisis squarely on <CHARNAME>'s shoulders, as I cannot make my break with the Iron Throne until the fruit is fully ripe.  At least <CHARNAME>'s next move is obvious:  Here to Baldur's Gate to accuse the Iron Throne.  Would that I could slay them in the streets, but we must not cause an uproar, and I am needed back at the camp in any case.  I have prepared Zhalimar and his hand-picked crew to stand guard in my stead, in wait for <CHARNAME>'s next--and last--blundering step against me.

12th of Kythorn, 1368:  <CHARNAME> has finally entered Baldur's Gate, and has gotten very friendly with Scar, but has not yet made any direct move against the Iron Throne.  From the tone of his letter, Rieltar is on the verge of panic, expecting assassins to emerge from his bedclothes at any moment.  He urges me to come to the city at once, mentioning something about wanting me to be present at an important meeting in a secure location.  Something tells me the coward is scraping for any excuse to stay out of <CHARNAME>'s reach.  Happily, Tazok is now fully recovered and back to fighting strength, so he can resume his former duties while I return to the city and get things under control.

14th of Kythorn, 1368:  I have long known of Rieltar's more pacifist tendencies, but I would never have expected him to actually arrange a meeting with the Knights of the Shield to PREVENT a war that should be very profitable to him.  No one would accuse my mortal 'father' of being a charming man, but he can certainly be oily when he needs to, so I must intervene.  But secrecy and deception are crucial now:  If the Wheel of Fate is to spin freely under my hand, I must be very cunning.  I have therefore informed Rieltar that <CHARNAME>'s little mercenary band has been dispatched, and neatly replaced by a doppelganger crew as arranged.  Therefore, when they suddenly burst into the meeting, his panicky reactions will all but ensure a bloody outcome.  But too much is at stake with this to leave anything to chance:  The doppelgangers and I must be present as well, though heavily disguised.  I shall ask my acolytes to prepare something suitable.  Happily, the sect of Cyric has some old texts which will almost certainly satisfy the entry requirements into Candlekeep, and Winski and Semaj have already copied down anything of relevance.

19th of Kythorn, 1368:  Barely enough time to write, but I must not neglect my journals so.  The future dead must know of how the Lord of Murder again came to them.  Perhaps I shall hire a scribe, when time allows.  As it turns out, I did not even need to maneuver one of the Cyricist's books into <CHARNAME>'s hands, as Duke Eltan was more than willing to give my little scapegoat one of his own texts.  Just moments ago, I saw <CHARNAME> enter the walls of Candlekeep, and I expect our little drama to commence here any minute.  My self-styled father, Rieltar, is upstairs with two representatives of the Knights of the Shield.  As foreseen, he has been blocking all my attempts to escalate the border hostilities.  Terribly sorry, 'father,' but my true parentage calls and you are in my way.  On the off chance that the upcoming encounter does not immediately produce bloodshed, I shall be sure to instruct the dopplegangers in the exact manner Rieltar should die.  I think a garrote would be perfect for the task.

21st of Kythorn, 1368:  On top of the world.  With Thaldorn, Rieltar and Brunos slain, <CHARNAME> in custody for their murders, and the entire assets of the Iron Throne at my disposal, the entire city is practically at my feet, and everything is working out as Alaundo said it would.  I have announced my intention to donate everything to the war effort, and now that Silvershield is out of the way, the rumors of elevating me to Grand Duke are beginning to catch on among the populace.  The only blight on the day is the news that the message I sent to Zhalimar did not reach him in time, robbing me of six of my best and brightest.  I have dealt with the messenger accordingly, and perhaps I can arrange it so that I perform <CHARNAME>'s execution personally, thus completing the circle of revenge.~
    SAY DESC ~The Personal Diary of Sarevok

This diary looks to be important.  You should probably keep it on your person, as it could be a key piece of incriminating evidence regarding Sarevok's involvement in the iron crisis and bandit raids, as well as some rather interesting insight into his murderous heritage. Some of the more relevant entries are as follows:


21st of Nightal, 1366:  Father seems to be plotting something major, but as usual, he is not revealing any details of the plan to me.  The conversations in his study lately have tended toward the Cloakwood and its natural defenses, and pumping water from caves.  I have been able to piece together nothing from this, nor do I know the men who have been visiting him.  This will change.

11th of Ches, 1367:  Another violent dream.  I was a boy again, and a dog was barking at me, so I killed it with the dagger I found in my hand, the same bone dagger from the other dreams.  Mother started to chastise me, and I ripped out her throat.  Her blood was fresh, but I already had old blood on my hands, and my fingers had strangely turned into claws.  The dog's head came back to life; its eyes were solid black.  "Like father, like son," it said.  I felt quite calm during the dream, but when I awoke I found I had been crying.  Is this weakness?  I must expunge it.

14th of Mirtul, 1367:  The ceremony marking the completion of my Deathbringer training seemed rather anticlimactic to me, but my performance seems to have impressed Father.  He took me aside and informed me that tomorrow, he shall reveal to me what he has been plotting these past few months, and even grant me a major role in it, if his associates agree.  He assures me that it is a far-reaching plan, and I should not be disappointed with my responsibilities.  My interest is quite piqued.
Cythandria was also quite pleased with my display this morning, so much so that it took her hours to fully express her appreciation.  When we first grew close, I remember how glad I was to find someone who was not repulsed by my affinity for death, but tonight I realized that her thirst is not like mine after all:  She has no real desire to get in close and perform the deed herself, she prefers to derive her thrill vicariously.  And whether she feels the genuine rush of bloodlust as I do, or if she merely thinks of it as a way to excite her arousal, I am not sure. . . but I fear it is the latter.

15th of Mirtul, 1367: Father has finally informed me of his secret, and frankly, it sounds rather pathetic, not worth any excitement at all.  All Father has is the location of a mine concealed deep in the Cloakwood, unknown to anyone else but the virtually extinct Orothiar dwarf clan, and according to them still rich in iron ore when it was accidentally flooded years ago.  Bah.  Iron?!  I had guessed something similar, but from all of Father's caution and secrecy, I was anticipating a treasure much more glamorous than a stupid iron mine.  Where is the glorious blood-rush that awaits me?  I did not spend years of combat training just to assist in Father's counting-house.  I feel the need for a challenge much more exciting than the rabble I have been wasting my skills on.  I feel the need to finally slay something worthy of the strength I have been sensing awakening within me.

8th of Flamerule, 1367:  Today, Father introduced me to his subordinates Davaeorn and Tranzig, who have made the journey to the hidden mine and confirmed that it could be put into use once again. 
This evening, I was approached on the street by a ragged beggarly man who would not give his name, but thrust a book into my hands and said he would be back.  The book is worthless, a common third-rate account of the Time of Troubles, and in horrible condition as well; nearly every single page is torn in some way.  Yet something about the man tells me he was more than a simple lunatic.

9th of Flamerule, 1367:  This night's dream was very strange: it was back in the temple, except that every single priestess had MY face, and held an identical bone dagger.  I looked toward the altar where I had always been before, but instead of ME tied to the stone slab, it was the tattered book from yesterday.  I had a dagger too, and when I stabbed the book, it bled.  The blood, and then the book itself, dissolved into a sort of magical energy which overflowed the gutters in the altar and then evaporated into the air.  I awoke to what felt like an icy grip trying to shatter my heart.  I immediately examined the book again.  It was damaged deliberately: no two rips line up, and the only pages that were NOT torn have to do with the killing of Bhaal and his efforts to ensure his legacy.  The more I think about what this might mean, the more I hesitate to write it down, even here.

14th of Eleint, 1367:  Cormyr has instituted a ban against the Iron Throne from operating within their borders.  While this is a great blow to the Iron Throne, it is the perfect opportunity for father to approach the Throne high council with his proposal.  If things go well, we could begin the operation within the year. 
In more personal matters, my curiosity about my ancestry grows unceasingly; I simply must know if the dreams speak the truth.  I will not believe the words of phantoms without proof, but the Priest of Bhaal I confronted today gave me nothing: he was old and died quickly in my grasp.  If the words are true, I shall surely groom stronger acolytes than this.

20th of Eleint, 1367:  The ragged man has finally reappeared, this time without his disguise.  He gives the name of Winski Perorate, and confirms my suspicions: I am indeed one of the fallen Bhaal's many offspring.  He claims to have been apprenticed to a Deathstalker, and therefore knows the signs.  He has spent the past few years on the move, tracking down as many of the children as he can, but it seems that I am the most promising of them all, and he apparently intends to train me as his sole pupil.  He has already informed me that I could not have chosen a more appropriate path than that of Deathbringer.  I think I shall enjoy this very much.

28th of Eleint, 1367:  Davaeorn reports that the mines at Cloakwood have been drained and are ready for use.  This revelation should help greatly in convincing the Throne high council.  Rieltar is setting up a base in Baldur's Gate, in the mansion of a destitute noble family, and everything is running smoothly. 

19th of Marpenoth, 1367:  The Iron Throne council has agreed to support father's plan.  He has been given all the resources he needs, as well as leadership of the project.  I have expressed interest to my 'father', and as promised, he is including me within the operations along the Sword Coast.  He is sending me, as his representative, to make contact with some of the mercenary groups operating to the east.  He mentioned mother in our conversation: how I wasn't to be disloyal to him as she had.  He made it clear that I would suffer her fate if I was.  His threats are weak and hollow, and I shall listen to them for only so long. 
I am tempted to take the opportunity to make a side visit to Candlekeep on the return trip.  There are some things about my heritage that even Winski does not know, and the exact text of the prophecies of Alaundo should prove most illuminating.

30th of Marpenoth, 1367:  I met with the leaders of the Chill, and Black Talons.  I have little liking for Ardenor, commander of the Chill, but Taugosz seems to be a man of his word.  It is a good thing, as I'll have to work with these mercenaries for the full duration:  Rieltar is even supporting placing me in command of this entire wing of the operation.  But it would not do, of course, for the adopted son of an Iron Throne leader to be seen visiting the bandits, so I have chosen the half-ogre Tazok as my figurehead; his abilities and loyalty to me are very satisfactory.

3rd of Uktar, 1367:  A new dream this night.  Mother was talking to me, but as she did her face became bloated and discolored.  Her voice became weaker as she spoke to me, telling me to save her from Rieltar.  I could see the garrote cutting into her neck, but I did nothing.  It was only a dream.

8th of Uktar, 1367:  Today I returned to our newly-completed headquarters in Baldur's Gate and reported to Rieltar.  The fool still insists on calling me his son, and for now I will let him.  He assumes that I am loyal to him because he raised me.  Well, loyal I am, but only as long as he is useful.  He has indeed placed me in full command of the mercenary operations, while he supervises the doppelganger intrigues and Davaeorn oversees the mining angle.  The demonstration of the mineral poison was most impressive.

9th of Uktar, 1367:  Winksi has similarly occupied himself well during my absence, and today presented me with the location of a nearby sect of Cyricists, who have made a particular practice of researching everything they can about Bhaal, and especially his successor.  It only makes sense that Cyric would be very interested in the offspring of his fallen foe, rising to reclaim his portfolio.  Winski wants to capture one or more of their leaders and extract their knowledge from them, but I say we should shoot higher and interrogate them all.  But that requires more than just two people, so I shall begin carefully selecting followers.  Though I fully realize that my heritage should remain a general secret, especially from Rieltar, it is time that the Son of Murder had the acolytes he deserves.

14th of Uktar, 1367:  Cythandria reacted to my revelation exactly as I thought she would:  She immediately saw herself as a queen or an idol of worship, the only fitting roles for the consort of the Lord of Murder.  Only after several minutes of imagining life seated at my right hand did she think to pay me any proper homage or obeisance.  If I had the luxury of choice, I would not have to put up with this kind of attitude, but I need to establish a power base of my own, so I shall tolerate it. . . for now.  There will be time for correction later.

Feast of the Moon, 1367:  The Cyricists are ours, and we have begun pumping them for information, with Zhalimar taking over whenever other matters call me away.  I have ordered that the younger members be kept alive, except to serve as useful examples to motivate the elder priests to be more forthcoming.  What Winski is most concerned about is that some mysterious "ward of Gorion" is mentioned in the prophecies, and is said to play a major role in the succession to Bhaal's portfolio, but there is no depiction of this rune or sigil anywhere, nor does he know what its significance might be.  It is a pity that Gorion is not a more uncommon name.

17th of Nightal, 1367:  Mulahey has established himself at the mines of Nashkel, and should already be converting the kobolds to follow him as their leader.  I expect they will begin contaminating the ore soon, though it will take some time before it becomes evident on the surface.  Only a few slaves have begun to mine out the ore at Cloakwood, though once the bandit raids begin I will be sending Davaeorn a steady supply of new slaves.  I wish I could lure Davaeorn into joining my little cult, knowing that he still secretly worships Bhaal, but he has some deep distrust of me, even after I dropped hints about my true parentage.

29th of Nightal, 1367:  Tamoko has displayed surprising skill in demoralizing some of the most resistant Cyricists.  The way she slew one of the junior members, and then later quietly re-animated his corpse to attack his sleeping former comrades, was a sheer treat to watch.  I was quite surprised that she had the audacity to rouse me directly out of my bed for the latter portion, however.  Not that I needed an excuse to leave Cythandria's company:  She complains far too much.

6th of Hammer, 1368:  The Flaming Fist have finally begun to take notice of our little mercenary operation, and have dispatched several small contingents to the Coast Way to try to fend off the bandit raids.  I shall order all the men to, in the event of capture, claim Zhentish allegiance, and I shall provide them with corroborative details to make the lie more convincing.  I am sure the Zhents at Darkhold won't be pleased to know that their name has been falsely used, but we cannot have the authorities catching our scent.  Meanwhile, we have successfully infiltrated Angelo into the Flaming Fist, and I am instructing him in military strategy:  Once this new talent of his gets recognized, he will be sure to get promoted, giving us a valuable spy right under Eltan's nose.

22nd of Hammer, 1368:  More revelations from the Cyricists: after intense examination, we finally got some names and numbers.  I wonder what is so important about Saradush?  It seems Bhaal spawned literally hundreds of offspring, all over Faerun, but only twenty of these shall be of any real importance, and from them, five shall almost make the heavens themselves tremble in fear.  This is very promising.  But it seems that the head priest of Cyric is as in the dark as to this 'ward of Gorion' as we are.  Blast!  I shall have to find an opportunity to enter Candlekeep after all.

14th of Alturiak, 1368:  In Candlekeep at last, and though Winski was too ill to leave Baldur's Gate, my research has gone well.  The monks here are quite helpful.  From what I have read, it is beyond all doubt that the blood of Bhaal flows through my veins.  Alaundo's prophecies are, of course, anything but explicit, but I think I understand them.  Bhaal's children bear the marks of chaos, have power with no direction, shall feel the blood of a god within them, and shall be driven to cause death and destruction, especially among each other.  "The deaths they bring shall awaken the father, and through them he will rise."  The wording is somewhat ambiguous, but obviously this means that death wrought by the children will cause them to ascend.  Fitting, and since the father was the Lord of Murder, proving one's worth must involve an act in accordance with his portfolio.  I begin to see what I must do.  Death on a god-like scale. 

15th of Alturiak, 1368:  Winski was a fool.  "Gorion's ward" is not any sort of glyph at all, but rather a brat named <CHARNAME>, a few years younger than myself.  And Gorion himself, though even older now, is doubtless the very same man from the temple, all those long years ago.  How ironic that the face that has been etched upon my brain for most of my life has been, for all this time, living as a monk practically on my doorstep.  And while I have nothing to prove it, I believe that <CHARNAME> was that same squealing baby in the soiled diaper.  And THIS little pipsqueak is to have monumental importance in the fulfillment of MY destiny?  The very idea seems ludicrous.  I barely got more than a glimpse today, but <CHARNAME> seems nothing more than a blissfully ignorant whelp, with next to no training whatsoever.  Hardly a figure to shake the deities.  But Gorion troubles me.  He seems to have taken an interest in my readings; I must be careful to be more clandestine in my research.

16th of Alturiak, 1368:  I take my leave of Candlekeep now, and not a moment too soon, for I am sure that Gorion has perceived my heritage.  I wish I could simply kill him, but I doubt I could safely murder him within this damnable library.  One thing I am certain of: <CHARNAME> is, in actuality, one of Bhaal's brood as well.  All the markings are there, and it would explain Gorion's curiosity of my studies, as well as <CHARNAME>'s being mentioned in the prophecy.  Though there is nothing I can do now, I will have to make certain to return and kill the little brat.  It would be foolish of me to let one of my siblings live, especially one being brought up by Harpers (and I am sure that is where Gorion's allegiances lay).  And I expect that Bhaal's power would be shared among his surviving children, so obviously I must make sure that I am the last man standing.  If I am to inherit the Throne of Bhaal, I want it all for myself.

19th of Alturiak, 1368:  The last of our little Cyric cult has died, but I think we wrung everything useful from them in time.  Winski largely shares my opinion about <CHARNAME> in that the child's death is almost certainly called for, but advises me to stop short of actual murder until he can determine exactly what sort of role 'Gorion's ward' is expected to play.  Very well, I can wait.  Winski's health seems to be failing him, so he has deputized Semaj to take over the business of sniffing out any possible Bhaalspawn in the area, and luring them to the Iron Throne on the pretense of business reasons.  Those I deem a possible threat I shall kill myself, the rest I will let Semaj deal with in some way.  I have discreetly commissioned a fine suit of armor and sword, worthy of the next Lord of Murder, and have postponed my fratricidal activities until I can dress the part.

17th of Ches, 1368:  Everything proceeds well.  The ore coming from Nashkel has started to deteriorate, and the mercenaries have been doing a fine job at seizing any iron caravans on route to Baldur's Gate.  Though some of my men have been captured, the Zhent story is holding up well, so no trouble has fallen on the Iron Throne.  But I will have to be wary for Zhentish agents in the coming months. 
I am actually a bit disappointed in Rieltar:  His skill in manipulating this whole iron plot notwithstanding, he sees it as nothing more than another way to make money, and increase his own status within the Iron Throne hierarchy.  Bah!  Who cares about the petty intrigues of one pathetic mercantile organization, when one can control the armies of entire nations?  Ah, well.  His blindness is my gain.

25th of Tarsakh, 1368:  The armor is completed, and is wonderfully appropriate for the terrifying presence of a Deathbringer descended from the Lord of Murder.  I shall have to congratulate Winski for helping with the design, especially the additional enchantments awakened only by the presence of the Bhaal essence.  The sword shall not be finished for another day or two, but it seems appropriate that I should kill my first sibling with my own bare hands.  Goodbye, Colin de'Graage.  You are not one of the twenty; Alaundo never gave a damn about you, and neither do I. 

28th of Tarsakh, 1368:  The Sword of Chaos is glorious.  The time is now ripe to deal with that old codger Gorion, and his little whelp.  I will have to inform my men that I'll be gone for the next few days.  Cythandria was furious when she learned I am taking Tamoko instead of her.  Perhaps this will motivate her to support me in areas other than just the bedroom.

2nd of Mirtul, 1368:  My long-delayed revenge on the withered old man is complete.  I actually killed him a bit too quickly; I wanted enough time to look into his dying eyes and remind him of where we had met before.  Ah well, it is of no real consequence.  What a pair of prize fools he and his little puppy were, fleeing Candlekeep under cover of night, neither one of them carrying any more than a few pitiful scraps of equipment.  Semaj's agents scared them right into our ambush.  Unfortunately, the whelp got away; took off running like a terrified jackrabbit after only a single spell.  I would have told Tamoko to follow him, but between my laughter and my lust for vengeance, it slipped my mind.  Still, with the old fool gone, the young fool shall not be far behind.  From what I have seen, I would expect anyone with <CHARNAME>'s level of skill and bravery to simply get lost in the wilderness, and die of exposure after a day or two.  A fitting end for the prize pupil of the man who thought I was less important than a squealing infant.  I return to Baldur's Gate, and the list of brothers and sisters who are actually worthy of death by my hand.  Just to be on the safe side, I have contacted Semaj's little network, and added <CHARNAME>'s name to those whose deaths will be rewarded.

9th of Mirtul, 1368:  Well, well!  Not only has <CHARNAME> NOT gotten eaten by gibberlings as I expected, but has also survived the best attempts of two of Semaj's bounty hunters, fallen in with a group of adventurers, and safely met with the mayor of Nashkel!  It appears there may be a spine in there after all.  Still, it is obvious that this little war party seeks to disrupt our activities in the mines; happily, Tazok and Tranzig have been well prepared for this sort of thing, and know just what to do.

15th of Mirtul, 1368:  The loss of Nashkel was a shocking blow to us, but we can recover; at the emergency meeting, we agreed that the best solution would be to send some of our own men into Nashkel, if not into the mine itself, and corrupt as much ore as possible without getting caught.  I suggested that the most opportune time would be during transit: whether as ore-cart drivers or caravan guards, our men should easily be able to contaminate the iron, since everyone else would be watching the horizon, not the wagons, and in the event of an attack by our mercenaries, the Black Talons would already have a couple of their men planted among the enemy.  After some debate, even Davaeorn was made to see the wisdom of this.  The best part is that even if we only manage to poison SOME of the ore shipped out of Nashkel, rumors will start circulating that the town's iron is still just as tainted as before, they're just claiming that it's pure and shipping it out anyway.  Some might even say that the entire adventuring party was just a lie that Nashkel made up, so people would start buying their iron again.  I will mention this additional angle to Rieltar tomorrow.  Still, the news that <CHARNAME> is still alive, despite all odds, troubles me greatly.  I shall talk the matter over with Winski, and then strike.  Personally, if I can find the time.

24th of Mirtul, 1368:  Hellfire and damnation!  I cannot believe the dispatches, but there is no denying them.  With Tazok's camp destroyed, I shall have to establish a roaming base of operations, and supervise it myself.  Rieltar and Davaeorn have agreed to this largely because, in my new armor, I cannot be recognized and traced back to the Iron Throne.  But blast it all, in addition to the loss of men, this will take up ALL of my time, and I shall even have to recall most of the death squads that I had ordered to seek out and ambush <CHARNAME> and company.  The situation looks dire, <CHARNAME> already knows far too much.  At least their next move is predictable; Davaeorn and a crew hand-picked by Rieltar have already left to personally guard the mines.  So let <CHARNAME>'s little band follow the trail of clues if they wish.  Just let them TRY to struggle through the Cloakwood, and may they all perish in the attempt.  Myself, I care little whether they find the mine or not; the men there belong to Davaeorn and Rieltar, not me.  I must use this time to recollect the scattered mercenaries into something useful once again.

9th of Kythorn, 1368:  Back in Baldur's Gate, briefly, for the emergency meeting I had been expecting.  The news from the Cloakwood has predictably driven Rieltar half-mad with worry.  I admit that things have not gone anything like the way we planned, but I think we can still turn this to our advantage.  For one thing, I strongly doubt that <CHARNAME> was able to carry more than a hundred tons of iron ore out of the Cloakwood, meaning that it's still there, waiting for our barges to come pick it up, just as arranged.  The trick will be manipulating the public opinion:  I must find some way to place the blame for the iron crisis squarely on <CHARNAME>'s shoulders, as I cannot make my break with the Iron Throne until the fruit is fully ripe.  At least <CHARNAME>'s next move is obvious:  Here to Baldur's Gate to accuse the Iron Throne.  Would that I could slay them in the streets, but we must not cause an uproar, and I am needed back at the camp in any case.  I have prepared Zhalimar and his hand-picked crew to stand guard in my stead, in wait for <CHARNAME>'s next--and last--blundering step against me.

12th of Kythorn, 1368:  <CHARNAME> has finally entered Baldur's Gate, and has gotten very friendly with Scar, but has not yet made any direct move against the Iron Throne.  From the tone of his letter, Rieltar is on the verge of panic, expecting assassins to emerge from his bedclothes at any moment.  He urges me to come to the city at once, mentioning something about wanting me to be present at an important meeting in a secure location.  Something tells me the coward is scraping for any excuse to stay out of <CHARNAME>'s reach.  Happily, Tazok is now fully recovered and back to fighting strength, so he can resume his former duties while I return to the city and get things under control.

14th of Kythorn, 1368:  I have long known of Rieltar's more pacifist tendencies, but I would never have expected him to actually arrange a meeting with the Knights of the Shield to PREVENT a war that should be very profitable to him.  No one would accuse my mortal 'father' of being a charming man, but he can certainly be oily when he needs to, so I must intervene.  But secrecy and deception are crucial now:  If the Wheel of Fate is to spin freely under my hand, I must be very cunning.  I have therefore informed Rieltar that <CHARNAME>'s little mercenary band has been dispatched, and neatly replaced by a doppelganger crew as arranged.  Therefore, when they suddenly burst into the meeting, his panicky reactions will all but ensure a bloody outcome.  But too much is at stake with this to leave anything to chance:  The doppelgangers and I must be present as well, though heavily disguised.  I shall ask my acolytes to prepare something suitable.  Happily, the sect of Cyric has some old texts which will almost certainly satisfy the entry requirements into Candlekeep, and Winski and Semaj have already copied down anything of relevance.

19th of Kythorn, 1368:  Barely enough time to write, but I must not neglect my journals so.  The future dead must know of how the Lord of Murder again came to them.  Perhaps I shall hire a scribe, when time allows.  As it turns out, I did not even need to maneuver one of the Cyricist's books into <CHARNAME>'s hands, as Duke Eltan was more than willing to give my little scapegoat one of his own texts.  Just moments ago, I saw <CHARNAME> enter the walls of Candlekeep, and I expect our little drama to commence here any minute.  My self-styled father, Rieltar, is upstairs with two representatives of the Knights of the Shield.  As foreseen, he has been blocking all my attempts to escalate the border hostilities.  Terribly sorry, 'father,' but my true parentage calls and you are in my way.  On the off chance that the upcoming encounter does not immediately produce bloodshed, I shall be sure to instruct the dopplegangers in the exact manner Rieltar should die.  I think a garrote would be perfect for the task.

21st of Kythorn, 1368:  On top of the world.  With Thaldorn, Rieltar and Brunos slain, <CHARNAME> in custody for their murders, and the entire assets of the Iron Throne at my disposal, the entire city is practically at my feet, and everything is working out as Alaundo said it would.  I have announced my intention to donate everything to the war effort, and now that Silvershield is out of the way, the rumors of elevating me to Grand Duke are beginning to catch on among the populace.  The only blight on the day is the news that the message I sent to Zhalimar did not reach him in time, robbing me of six of my best and brightest.  I have dealt with the messenger accordingly, and perhaps I can arrange it so that I perform <CHARNAME>'s execution personally, thus completing the circle of revenge.~
    WRITE_SHORT 0x1c 0x25 //  Sets item category from Scrolls to Books
    WRITE_BYTE 0x4c 0x08 //  Sets weight to 8 lbs
    BUT_ONLY

/////////////////////////////////////////////////////////////////////////////////
//! Minor BG1/BGT Adjustments ///////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////

BEGIN ~Minor BG1/BGT Adjustments~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 70

/////////////////////
/// Include ToBEX ///
/////////////////////

OUTER_SPRINT ~TOBEX_MOD_DIRECTORY~ ~stweaks~
LOAD_TRA ~stweaks/tobex_redist/tobex.tra~
INCLUDE ~stweaks/tobex_redist/tobex.tpa~
COPY ~tobex_ini/tobexcore.ini~ ~tobex_ini/tobexcore.ini~
  REPLACE_TEXTUALLY ~Expanded Triggers=0~ ~Expanded Triggers=1~
  REPLACE_TEXTUALLY ~Enable PickpocketFailed Trigger=0~ ~Enable PickpocketFailed Trigger=1~
COPY ~tobex_ini/tobextweak.ini~ ~tobex_ini/tobextweak.ini~
  REPLACE_TEXTUALLY ~Engine:Disable Silence On Charm=0~ ~Engine:Disable Silence On Charm=1~
BUT_ONLY

/////////////////////////////////
/// Material from BG1 Fixpack ///
/////////////////////////////////

PRINT ~Processing AREA-FixDetectedAndTraplessTraps.tph~
// ----------------------------------------------------------------------------
ACTION_FOR_EACH file IN ~AR7253.ARE~ ~AR8016.ARE~ ~AR8111.ARE~ ~AR6519.ARE~ ~AR6741.ARE~ ~AR6736.ARE~ ~ARD012.ARE~ ~ARD014.ARE~ ~ARU001.ARE~ BEGIN
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%~) THEN BEGIN  //one line allows for use with totsc and vanilla files rather than duplicate blocks for each game
COPY_EXISTING_REGEXP ~%file%~ ~override~
//remove trapped status from containers that don't have a trap script
  READ_LONG  0x70 "cont_off"
  READ_SHORT 0x74 "cont_num"
  FOR(y=0;y<%cont_num%;y+=1)BEGIN
   READ_SHORT (%cont_off% + 0x30 + (%y% * 0xc0)) trapped
   READ_SHORT (%cont_off% + 0x32 + (%y% * 0xc0)) detected
   READ_ASCII (%cont_off% + 0x48 + (%y% * 0xc0)) resref
   SET "exists" = 0
   INNER_PATCH_FILE ~%resref%.bcs~ BEGIN
    SET "exists" = 1
   END
   PATCH_IF (%trapped% = 1) AND (%exists% =0) BEGIN
    WRITE_SHORT (%cont_off% + 0x30 + (%y% * 0xc0)) 0
   END
  END
//remove trapped status from doors that don't have a trap script
  READ_LONG  0xa4 "door_num"
  READ_LONG  0xa8 "door_off"
  FOR(y=0;y<%door_num%;y+=1)BEGIN
   READ_SHORT (%door_off% + 0x70 + (%y% * 0xc8)) trapped
   READ_SHORT (%door_off% + 0x72 + (%y% * 0xc8)) detected
   READ_ASCII (%door_off% + 0x80 + (%y% * 0xc8)) resref
   SET "exists" = 0
   INNER_PATCH_FILE ~%resref%.bcs~ BEGIN
    SET "exists" = 1
   END
   PATCH_IF (%trapped% = 1) AND (%exists% =0) BEGIN
    WRITE_SHORT (%door_off% + 0x70 + (%y% * 0xc8)) 0
   END
  END
BUT_ONLY
END
END
// ----------------------------------------------------------------------------
//~Make detected trapped containers undetected~
// ----------------------------------------------------------------------------
ACTION_FOR_EACH file IN ~arD000~ ~arD011~ ~arD012~ ~arD013~ ~arD014~ ~arW501~ ~arW502~ ~arW503~ ~arW504~ ~ar6736~ BEGIN
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN  //one line allows for use with totsc and vanilla files rather than duplicate blocks for each game
COPY_EXISTING_REGEXP ~%file%.are~ ~override~
 PATCH_IF (%SOURCE_SIZE% > 0xd4) BEGIN
  READ_LONG  0x70 "cont_off"
  READ_SHORT 0x74 "cont_num"
  FOR (index = 0; index < cont_num; index += 1) BEGIN
   READ_SHORT ("%cont_off%" + 0x30 + ("%index%" * 0xc0)) "trapped"
   READ_SHORT ("%cont_off%" + 0x32 + ("%index%" * 0xc0)) "detected"
/* fix detected container trap --  */
   PATCH_IF (("%trapped%" = 1) AND ("%detected%" = 1)) BEGIN
    WRITE_SHORT ("%cont_off%" + 0x32 + ("%index%" * 0xc0)) 0
   END
  END
 END
BUT_ONLY_IF_IT_CHANGES
END
END

// ----------------------------------------------------------------------------
//Make containers trapped but with no items trapless
// ----------------------------------------------------------------------------
ACTION_FOR_EACH file IN ~ar7230~ ~ar0161~ ~ar7262~ ~ar7266~ ~ar7405~ ~ar7406~ ~ar1105~ ~ar8210~ ~ar6716~ ~ar3710~ BEGIN
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN
COPY_EXISTING_REGEXP ~%file%.are~ ~override~
  READ_LONG  0x70 "cont_off"
  READ_SHORT 0x74 "cont_num"
  FOR(y=0;y<%cont_num%;y+=1)BEGIN
   READ_SHORT (%cont_off% + 0x30 + (%y% * 0xc0)) trapped
   READ_LONG  (%cont_off% + 0x44 + (%y% * 0xc0)) hasitem
   READ_ASCII (%cont_off% + 0x48 + (%y% * 0xc0)) trapscript
   PATCH_IF (%trapped% = 1) AND (%hasitem% = 0) AND (~%trapscript%~ STRING_CONTAINS_REGEXP ~^act[0-9]+~ = 0) BEGIN
    PATCH_LOG ~%SOURCE_FILE% -- Container index #%y% -- has no items and was flagged as trapped and has guard calling script. flag removed.~
    WRITE_SHORT (%cont_off% + 0x30 + (%y% * 0xc0)) 0
   END
  END
BUT_ONLY
END
END

PRINT ~Processing AREA-MinorCorrections.tph~
// ----------------------------------------------------------------------------
//remove item which can cause the game to crash
COPY_EXISTING ar3707.are override
  LAUNCH_PATCH_FUNCTION DELETE_AREA_ITEM
    STR_VAR item_to_delete = misc02
  END
BUT_ONLY

//change container type from bag to pile
ACTION_FOR_EACH abfile IN ~arW012~ ~arD013~ BEGIN
ACTION_IF (FILE_EXISTS_IN_GAME ~%abfile%.are~ ) THEN BEGIN
COPY_EXISTING ~%abfile%.are~ ~override~
 PATCH_IF (%SOURCE_SIZE% > 0xd4) BEGIN
  READ_LONG  0x70 "cont_off"
  READ_SHORT 0x74 "cont_num"
  FOR (index = 0; index < cont_num; index += 1) BEGIN
   READ_SHORT (%cont_off% + (%index% * 0xc0) + 0x24) cont_type
   PATCH_IF (%cont_type% = 1) BEGIN  //if it is bag
    WRITE_SHORT (%cont_off% + (%index% * 0xc0) + 0x24) 4 //change to pile
   END
  END
 END
BUT_ONLY
END
END

//actor positions
ACTION_DEFINE_ARRAY arefile BEGIN ar7245 ar7217 ar6703 ar7200  ar3710 ar6720 END
ACTION_DEFINE_ARRAY oldXoff BEGIN    595    559    619   2183     452    306 END
ACTION_DEFINE_ARRAY oldYoff BEGIN    511    270    512   1799     474    232 END
ACTION_DEFINE_ARRAY newXoff BEGIN    575    543    NA    NA       447    303 END
ACTION_DEFINE_ARRAY newYoff BEGIN    517    260    517   1800     NA     NA  END
OUTER_SET num_array = 6
OUTER_FOR (idx = 0; idx < %num_array%; idx += 1) BEGIN
 OUTER_SPRINT file $arefile("%idx%")
 OUTER_SET OXoff = $oldXoff("%idx%")
 OUTER_SET OYoff = $oldYoff("%idx%")
 ACTION_IF (IS_AN_INT $newXoff("%idx%") ) BEGIN
  OUTER_SET NXoff = $newXoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NXoff = %OXoff%
 END
 ACTION_IF (IS_AN_INT $newYoff("%idx%") ) BEGIN
  OUTER_SET NYoff = $newYoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NYoff = %OYoff%
 END
 ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN
  COPY_EXISTING ~%file%.are~ override
   READ_LONG 0x54 act_off
   READ_SHORT 0x58 act_cnt
   FOR (i = 0; i < %act_cnt%; i += 1) BEGIN
    READ_SHORT ((%i% * 0x110) + %act_off% + 0x20) xoff
    READ_SHORT ((%i% * 0x110) + %act_off% + 0x22) yoff
    PATCH_IF (xoff = OXoff ) AND (yoff = OYoff ) BEGIN //actor spawn point
     PATCH_IF (VARIABLE_IS_SET %NXoff%) AND (IS_AN_INT %NXoff%) BEGIN
      PATCH_LOG ~%file%.are -- replaced old X offset: %xoff% with new X offset: %NXoff%~
      WRITE_SHORT ((%i% * 0x110) + %act_off% + 0x20) NXoff
      WRITE_SHORT ((%i% * 0x110) + %act_off% + 0x24) NXoff
     END
     PATCH_IF (VARIABLE_IS_SET %NYoff%) AND (IS_AN_INT %NYoff%) BEGIN
      PATCH_LOG ~%file%.are -- replaced old Y offset: %yoff% with new Y offset: %NYoff%~
      WRITE_SHORT ((%i% * 0x110) + %act_off% + 0x22) NYoff
      WRITE_SHORT ((%i% * 0x110) + %act_off% + 0x26) NYoff
     END
    END
   END
  BUT_ONLY
 END
END

//container access points
ACTION_DEFINE_ARRAY arefile BEGIN ar6757 arW503 ar8017 ar7253 ar9913 ar9911 ar9909 ar9907 ar9901 ar9798 ar3301 END
ACTION_DEFINE_ARRAY oldXoff BEGIN    541    274    404   1157    225    225    225    225    225   1108    370 END
ACTION_DEFINE_ARRAY oldYoff BEGIN    668    467    308    528    199    199    199    199    199   1425    183 END
ACTION_DEFINE_ARRAY newXoff BEGIN    544    238    415   1222    204    204    204    204    204   1139    334 END
ACTION_DEFINE_ARRAY newYoff BEGIN     NA    496    270    557     NA     NA     NA     NA     NA   1420     NA END
OUTER_SET num_array = 11
OUTER_FOR (idx = 0; idx < %num_array%; idx += 1) BEGIN
 OUTER_SPRINT file $arefile("%idx%")
 OUTER_SET OXoff = $oldXoff("%idx%")
 OUTER_SET OYoff = $oldYoff("%idx%")
 ACTION_IF (IS_AN_INT $newXoff("%idx%") ) BEGIN
  OUTER_SET NXoff = $newXoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NXoff = %OXoff%
 END
 ACTION_IF (IS_AN_INT $newYoff("%idx%") ) BEGIN
  OUTER_SET NYoff = $newYoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NYoff = %OYoff%
 END
 ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN
  COPY_EXISTING ~%file%.are~ override
   READ_LONG 0x70 con_off
   READ_SHORT 0x74 con_cnt
   FOR (i = 0; i < con_cnt; i += 1) BEGIN
    READ_SHORT (i * 0xc0 + con_off + 0x20) xoff
    READ_SHORT (i * 0xc0 + con_off + 0x22) yoff
    PATCH_IF (xoff = %OXoff%) AND (yoff = %OYoff%) BEGIN //container trap point
     PATCH_IF (VARIABLE_IS_SET %NXoff%) AND (IS_AN_INT %NXoff%) BEGIN
      PATCH_LOG ~%file%.are -- replaced old X offset: %xoff% with new X offset: %NXoff%~
      WRITE_SHORT (i * 0xc0 + con_off + 0x20) %NXoff%
     END
     PATCH_IF (VARIABLE_IS_SET %NYoff%) AND (IS_AN_INT %NYoff%) BEGIN
      PATCH_LOG ~%file%.are -- replaced old Y offset: %yoff% with new Y offset: %NYoff%~
      WRITE_SHORT (i * 0xc0 + con_off + 0x22) %NYoff%
     END
    END
   END
  BUT_ONLY
 END
END

//container trap points (i.e. guard spawn points)
ACTION_DEFINE_ARRAY arefile BEGIN ar6757 ar6709 ar3705 ar3805 arA006 arA007 arA009 arA010 arA011 arA012 arA015 arA016 arA018 arA018 arA020 arA021 ar7208 ar7216 ar7230 ar7243 ar7255 ar7255 ar7255 ar7256 ar7258 ar7260 ar7266 ar7266 ar7270 ar7403 ar7403 ar7606 ar7608 ar7611 ar7618 ar7707 ar7711 ar7717 ar7810 ar8003 ar8003 ar8003 ar8011 ar8105 ar8107 ar8204 ar8215 arU006 arU006  ar3805 END
ACTION_DEFINE_ARRAY oldXoff BEGIN    468    468    404    212    276    276    212    468    212    276    532    312    345    341    232    276    916    700    612    335    316    321    327    276    212    212    717    728    212    212    436    724    404    262    276    468    468    468    724    262    270    267    468    468   1108    276    212    212    340     276 END
ACTION_DEFINE_ARRAY oldYoff BEGIN    564    180    372    244    180    308    308    180    308    308    180    324    271    277    242    308    884    476   1134    390    327    341    320    308    308    308    311    313    308    372    276    372    340    371    308    180    180    180    372    269    268    270    500    180    308    180    308    308    308     244 END
ACTION_DEFINE_ARRAY newXoff BEGIN    341    410    134    275    503    405    512    424    512    424    276    492    407    332    492    405    960    831    320    633    487    487    487    369    501    276    497    497    276    504    504    538    418    332    373    433    406    397    570    497    497    497    766    439    465    493    511    426    426     275 END
ACTION_DEFINE_ARRAY newYoff BEGIN    614    361    337    329    463    252    194    351    194    322    200    478    407    332    478    252    785   1058   1284    480    454    454    454    241    180    200    166    166    200    189    189    563    177    489    241    356    337    331    444    462    462    462    485    358   1117    469    190    320    320     317 END
OUTER_SET num_array = 50
OUTER_FOR (idx = 0; idx < %num_array%; idx += 1) BEGIN
 OUTER_SPRINT file $arefile("%idx%")
 OUTER_SET OXoff = $oldXoff("%idx%")
 OUTER_SET OYoff = $oldYoff("%idx%")
 ACTION_IF (IS_AN_INT $newXoff("%idx%") ) BEGIN
  OUTER_SET NXoff = $newXoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NXoff = %OXoff%
 END
 ACTION_IF (IS_AN_INT $newYoff("%idx%") ) BEGIN
  OUTER_SET NYoff = $newYoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NYoff = %OYoff%
 END
 ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN
  COPY_EXISTING ~%file%.are~ override
   READ_LONG 0x70 con_off
   READ_SHORT 0x74 con_cnt
   FOR (i = 0; i < con_cnt; i += 1) BEGIN
    READ_SHORT (i * 0xc0 + con_off + 0x34) xoff
    READ_SHORT (i * 0xc0 + con_off + 0x36) yoff
    PATCH_IF (xoff = %OXoff%) AND (yoff = %OYoff%) BEGIN //container trap point
     PATCH_IF (VARIABLE_IS_SET %NXoff%) AND (IS_AN_INT %NXoff%) BEGIN
      PATCH_LOG ~%file%.are -- replaced old X offset: %xoff% with new X offset: %NXoff%~
      WRITE_SHORT (i * 0xc0 + con_off + 0x34) %NXoff%
     END
     PATCH_IF (VARIABLE_IS_SET %NYoff%) AND (IS_AN_INT %NYoff%) BEGIN
      PATCH_LOG ~%file%.are -- replaced old Y offset: %yoff% with new Y offset: %NYoff%~
      WRITE_SHORT (i * 0xc0 + con_off + 0x36) %NYoff%
     END
    END
   END
  BUT_ONLY
 END
END

//reduce lock difficulty from 100 to 90 
ACTION_FOR_EACH file IN ~arA018~ ~ar7204~ ~ar7208~ ~ar7402~ ~ar6543~ ~ar3710~ BEGIN
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN
 COPY_EXISTING ~%file%.are~ override
  READ_LONG  0x70 cont_off
  READ_SHORT 0x74 cont_num
  FOR(y=0;y<%cont_num%;y+=1)BEGIN
   READ_SHORT (%cont_off% + 0x26 + (%y% * 0xc0)) lockdiff
   READ_LONG  (%cont_off% + 0x28 + (%y% * 0xc0)) flags
   READ_LONG  (%cont_off% + 0x44 + (%y% * 0xc0)) hasitem
   PATCH_IF (%flags% BAND 0b00000001) AND (%lockdiff% > 99) BEGIN
    WRITE_SHORT (%cont_off% + 0x26 + (%y% * 0xc0)) 90
   END
  END
 BUT_ONLY
END
END

//turn traps on that were off
ACTION_FOR_EACH file IN ~ar7221~ ~ar7253~ ~arD004~ ~ar3805~ BEGIN
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN
 COPY_EXISTING ~%file%.are~ ~override~
  READ_LONG  0x70 "cont_off"
  READ_SHORT 0x74 "cont_num"
  FOR(y=0;y<%cont_num%;y+=1)BEGIN
   READ_LONG  (%cont_off% + 0x44 + (%y% * 0xc0)) hasitem
   READ_SHORT (%cont_off% + 0x30 + (%y% * 0xc0)) trapped
   READ_ASCII (%cont_off% + 0x48 + (%y% * 0xc0)) trapscript
   PATCH_IF (FILE_EXISTS_IN_GAME ~%trapscript%.bcs~) AND (%trapped% = 0) AND (%hasitem% >0) BEGIN
    WRITE_SHORT (%cont_off% + 0x30 + (%y% * 0xc0)) 1
    PATCH_LOG ~%SOURCE_FILE% -- Container index #%y% -- has items & had trap value: %trapped% -- now has trap value: 1~
   END
  END
BUT_ONLY
END
END

ACTION_IF (GAME_IS ~bgt~) BEGIN
// ----------------------------------------------------------------------------
// AR0300 (renamed AR7400): Door 1 to the Counting House set as locked as described by Jacil
// door labeled Door0307 is locked in vanilla and not locked in totsc -- lock it to be consistent?
COPY_EXISTING ~ar7400.are~ ~override~
 READ_LONG 0x00a4 ~doornum~
 READ_LONG 0x00a8 ~dooroff~
 FOR(x=0;x<%doornum%;x+=1)BEGIN
  READ_ASCII (%dooroff% + (200*%x%)) ~doorname~
//  PATCH_PRINT ~Door#: %doornum%  -- has name: %doorname%~
  PATCH_IF (~Door0307~ STRING_EQUAL_CASE ~%doorname%~) BEGIN
   READ_LONG (%dooroff% + (200*%x%)+0x0028) ~flags~
   WRITE_LONG (%dooroff% + (200*%x%)+0x0028) (%flags% BOR 0b0000000000010)
   SET x=%doornum%
  END
 END
BUT_ONLY_IF_IT_CHANGES
// ----------------------------------------------------------------------------
//AR0511 (renamed ARD011): Trap 4 added flag Detectable trap; Trap 15 corrected to Proximity trigger, was Info trigger;
//Corrected undroppable Lard Shield (SHLD18) to a droppable one (SHLD15)
//dudley -- Change Item 3 in Container 8 from HELM13.ITM to HELM10.ITM.
COPY_EXISTING ~arD011.are~ ~override~
 READ_SHORT 0x005a ~regionnum~
 READ_LONG 0x005c ~regionoff~
 FOR(x1=0;x1<%regionnum%;x1+=1)BEGIN
  READ_ASCII (%regionoff% + (0xc4*%x1%)) ~regionname~ (5)
  PATCH_IF (~Trap4~ STRING_EQUAL_CASE ~%regionname%~) BEGIN
   READ_LONG (%regionoff% + (0xc4*%x1%)+0x0060) ~flags~
   WRITE_LONG (%regionoff% + (0xc4*%x1%)+0x0060) (%flags% BOR 0b1000)
   SET x1=%regionnum%
  END
 END
 FOR(x2=0;x2<%regionnum%;x2+=1)BEGIN
  READ_ASCII (%regionoff% + (0xc4*%x2%)) ~regionname~ (7)
  PATCH_IF (~Trap 15~ STRING_EQUAL_CASE ~%regionname%~) BEGIN
   WRITE_SHORT (%regionoff% + (0xc4*%x2%)+0x0020) 0
   SET x2=%regionnum%
  END
 END
 READ_SHORT 0x0076 ~itemnum~
 READ_LONG 0x0078 ~itemoff~
 FOR(x3=0;x3<%itemnum%;x3+=1)BEGIN
  READ_ASCII (%itemoff% + (%x3%*0x14)) ~itemname~
  PATCH_IF (~shld18~ STRING_EQUAL_CASE ~%itemname%~) BEGIN
   WRITE_ASCII (%itemoff% + (%x3%*0x14)) ~shld15~ (8)
   SET x3=%itemnum%
  END
 END
 FOR(x4=0;x4<%itemnum%;x4+=1)BEGIN
  READ_ASCII (%itemoff% + (%x4%*0x14)) ~itemname~
  PATCH_IF (~helm13~ STRING_EQUAL_CASE ~%itemname%~) BEGIN
   WRITE_ASCII (%itemoff% + (%x4%*0x14)) ~helm10~ (8)
   SET x4=%itemnum%
  END
 END
BUT_ONLY_IF_IT_CHANGES
END

PRINT ~Processing AREA-ContainerAccesPoints.tph~
//container access points
ACTION_DEFINE_ARRAY arefile BEGIN ar6517 ar6530 ar6518 ar6543 ar6543 ar6543 ar6508 ar6509 ar6509 ar6509 ar6509 ar6511 ar6511 ar6512 ar6512 ar6512 ar6512 ar6514 ar6514 ar6802 ar6802 ar6802 ar6802 ar6802 ar6803 ar6803 ar6803 ar6803 ar6803 ar7101 ar6700 ar6700 ar6700 ar6700 ar6700 ar6700 ar6757 ar6703 ar6720 ar6721 ar6721 ar6732 ar6753 ar6753 ar6753 ar6753 ar6726 ar6714 ar6714 ar6714 ar3705 ar9902 ar9906 ar9908 ar9910 ar9912 ar9914 arA101 ar8701 ar8602 ar8602 ar8602 ar8602 ar8602 arA004 arA004 arA013 arA013 arA015 arA015 arA018 arA018 ar7200 ar7200 ar7200 ar7200 ar7200 ar7200 ar7200 ar7200 ar7200 ar7200 ar7202 ar7202 ar7202 ar7202 ar7204 ar7205 ar7205 ar7208 ar7209 ar7210 ar7210 ar7210 ar7210 ar7214 ar7214 ar7214 ar7218 ar7218 ar7221 ar7235 ar7238 ar7260 ar7260 ar7261 ar7262 ar7270 ar7270 ar7270 ar7300 ar7300 ar7300 ar7300 ar7300 ar7400 ar7400 ar7400 ar7400 ar7400 ar7400 ar7400 ar7400 ar7400 ar7400 ar7403 ar7404 ar7404 ar7404 ar7404 ar7404 ar7407 ar7408 ar7408 ar7600 ar7603 ar7607 ar7611 ar7611 ar7611 ar7613 ar7614 ar7614 ar7614 ar7700 ar7705 ar7710 ar7710 ar7716 ar7716 ar7716 ar7719 ar7725 ar7800 ar7802 ar7802 ar7809 ar7809 ar7814 ar7814 ar8000 ar8001 ar8002 ar8002 ar8011 ar8012 ar8012 ar8017 ar8100 ar8100 ar8100 ar8100 ar8100 ar8101 ar8101 ar8104 ar8104 ar8107 ar8107 ar8107 ar8107 ar8108 ar8108 ar8108 ar8114 ar8114 ar8115 ar8200 ar8201 ar8201 ar8201 ar8201 ar8202 ar8202 ar8203 ar8203 ar8207 ar8207 ar8207 ar8207 ar8209 ar8209 ar8217 ar8217 arU001 arU003 arU003 arU003 arU005 arU005 arU005 arU006 arU006 arU006 arU007 arU007 arU007 ar0512 arD012 arD012 arD012 arD012 arD012 arD012 END
ACTION_DEFINE_ARRAY oldXoff BEGIN    360    360    207    939   1475   1604   1569   1682    648    927   1335    995   1279    155    651    806   1531    905   1349   1055   1040    965    887   1321    236   1044   1043    754    434    522   3296   1825   3069    970   3879   3076    303    437    243    442    663    234    251    357    450    695    235    228    467    513    641    243    243    243    243    243    243   1120    156   2376   2078   1313   2288   2136    432    546    228    467    228    467    432    546   1906   3997   3842   2270   2275   3614    535    571    611    437    432    534    574   1597    649    112    436   1036    707    702    808    745    958    734   1197   1275    574    249    687    322    288    228    467    348    348    228    467    513    385   2019   2921   3232   4046   2028   1884   1789     68    347    527    588    393    402   1198    436    255    535    434    626    508    530    486    915   3556    300    878    191    118    287    699    288    370    766   2944    234    228    467    228    467    513    853    786   1745    228    467    378    789    228    467   3836    530    486    915    356    449    537    569   1286   1168   2181   3035    699    157    530    228    467    951   1108   1475   1604    971    735    640    228    467    715   1121   1310   1609    717   1019    193    575    725    667    387    274    353    577    228    467    228    467    348    257    378    789    228    467    513    228    467    513    228    467    513    691   1363    732    521    407    290   1985 END
ACTION_DEFINE_ARRAY oldYoff BEGIN    419    419    256    323    503    519   1460   1354    906   1062   1352   1341   1542    647   1024    183    791    250    872    849    337    286    225    532    622    851    344    382    473    202    873   1444   1523   1907   2587   3198    202    628    250    125    279    323    323    573    509    254    323    323     90    139    262    222    222    222    222    222    222    587    249   1460    837    620    382    251    133    216    323     90    323     90    133    216   3166   1686    967   1756   2206   1702   2137   2141   2145   2048   1356   1067   1102    189    596    215    142    502    662    855    779    825    683    517    263    737    221    128    574    237    332    323     90    695    695    323     90    139    862    687   2958   2383   2140   1853   2195   2413   3032   3029   2525   2445   1811   1738    963    356    322    376    267    200    197    754    768    352   3093    540    597    247    274    450    953    695    659    498    691    689    323     90    323     90    139    355    506   1510    323     90    272    305    323     90    356    754    768    352    692    508    379    164   1605   1657   1991   2337   2698    623    755    323     90    316    332    503    519    410    439    677    323     90    178   3326    382    522    978    947    428    432    440    724    243    328    533    376    323     90    323     90    695    318    272    305    323     90    139    323     60    139    323     60    139   1218   2130   1232   1086    998   1075   1456 END
ACTION_DEFINE_ARRAY newXoff BEGIN    NA     NA     208    937   1471   1603   1567   1679    656    928   1336    996   NA      154    652    832   1530    895   1343   1051   1045    964    879   1309     NA   1043   1042    752    431    520   3295   1823   3068    969   3878   3071    302    431    242    431    654    233     NA    355    447    687    234     NA    462    510    640    239    239    239    239    239    239     NA    161   2367   2077   1312   2287   2135    431    543    227    462     NA    462    431    543   1905   4000   3839   2272   2274   3613    527     NA    610     NA    431    527    572   1595    656     NA    435   1037    703    704    807    744    957    736   1196   1280     NA     NA    688    321    303     NA    462    347    347     NA    462    510    383   2015   2914   3231   4048   2032   1883   1792     63     NA    528     NA    400    401   1183    431    254    533    431    625    512    529     NA    911   3555    304    880    192    117    288    704    287    369     NA   2943    237     NA    462     NA    462    510    847    783   1743     NA    462    379    783     NA    462   3837    529    485    911     NA    447     NA    568   1279   1167   2174   3040    687    156     NA     NA    462    944   1107   1471   1608    976    734    637     NA    462    714   1119   1309   1608    720   1018    191    576    724    672    382    271    350    574     NA    462     NA    462    347    255    377    783     NA    462    510     NA    462    510     NA    462    510    687   1359     NA    528    416    305   1983 END
ACTION_DEFINE_ARRAY newYoff BEGIN    420    420    NA     324    506    528   1461     NA    905     NA   1356   1344   1548    648   1032    206    792    248     NA    852    348    288    232     NA    624    852    348    384    480    204    876   1446   1524   1908   2593   3204    204     NA    252    121    275    324    324    576    510    255    324    324     96     NA    264    221    221    221    221    221    221    588     NA   1462    840    624    383    252    134    217    324     96    324     96    134    219   3168     NA    968   1758   2208   1704     NA   2148   2148   2052   1368     NA   1105    192    600    228    144    504     NA     NA    780    828    684     NA    264    738    228    132     NA    240    299    324     96    696    696    324     96     NA    863    688   2964   2384   2139   1860   2196     NA   3035   3036     NA   2449   1815   1740    973    355    324    371    279    204    198    756    767    351   3096     NA     NA     NA    276    451    955    696    660    504     NA    700    324     96    324     96    140    358     NA     NA    324     96    276    307    324     96    360    756    767    353    696    509    384    168   1595   1658   1992   2340   2706    624    756    324     96    324    336    504    528     NA    444    671    324     96    180     NA    384    528    979    948    429    444    444     NA    244    329    540    384    324     96    326     96    697    319    276    302    324     96     NA    324     96     NA    324     96     NA   1220   2133   1236     NA   1000   1081   1457 END
OUTER_SET num_array = 224
OUTER_FOR (idx = 0; idx < %num_array%; idx += 1) BEGIN
 OUTER_SPRINT file $arefile("%idx%")
 OUTER_SET OXoff = $oldXoff("%idx%")
 OUTER_SET OYoff = $oldYoff("%idx%")
 ACTION_IF (IS_AN_INT $newXoff("%idx%") ) BEGIN
  OUTER_SET NXoff = $newXoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NXoff = %OXoff%
 END
 ACTION_IF (IS_AN_INT $newYoff("%idx%") ) BEGIN
  OUTER_SET NYoff = $newYoff("%idx%")
 END ELSE BEGIN
  OUTER_SET NYoff = %OYoff%
 END
 ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.are~) THEN BEGIN
  COPY_EXISTING ~%file%.are~ override
   READ_LONG 0x70 con_off
   READ_SHORT 0x74 con_cnt
   FOR (i = 0; i < con_cnt; i += 1) BEGIN
    READ_SHORT (i * 0xc0 + con_off + 0x20) xoff
    READ_SHORT (i * 0xc0 + con_off + 0x22) yoff
    PATCH_IF (xoff = %OXoff%) AND (yoff = %OYoff%) BEGIN //container trap point
     PATCH_IF (VARIABLE_IS_SET %NXoff%) AND (IS_AN_INT %NXoff%) BEGIN
      PATCH_LOG ~%file%.are -- replaced old X offset: %xoff% with new X offset: %NXoff%~
      WRITE_SHORT (i * 0xc0 + con_off + 0x20) %NXoff%
     END
     PATCH_IF (VARIABLE_IS_SET %NYoff%) AND (IS_AN_INT %NYoff%) BEGIN
      WRITE_SHORT (i * 0xc0 + con_off + 0x22) %NYoff%
      PATCH_LOG ~%file%.are -- replaced old Y offset: %yoff% with new Y offset: %NYoff%~
     END
    END
   END
  BUT_ONLY
 END
END

PRINT ~Processing DIALOG-BasicCorrections.tph~
// ----------------------------------------------------------------------------
//Three Old Kegs Noblewoman Minor Fix
<<<<<<<< inlined/nobw8.d
REPLACE_TRANS_ACTION nobw8 BEGIN 19 20 END BEGIN 0 END ~GiveItem("MISC20",LastTalkedToBy)~ ~GiveItemCreate("MISC20",LastTalkedToBy())~
>>>>>>>>
COMPILE ~inlined/nobw8.d~
// ----------------------------------------------------------------------------
// The Revenant spams dialog during combat -- set some variables to prevent it..
// non-dudley & non-baldurdash
<<<<<<<< revent3change.d
ADD_STATE_TRIGGER reven3 0 ~Global("ab_BGF_RevenantHelp","GLOBAL",0)~
ADD_TRANS_ACTION reven3 BEGIN 0 END BEGIN END ~SetGlobal("ab_BGF_RevenantHelp","GLOBAL",1)~
ADD_STATE_TRIGGER reven3 1 ~Global("HelpHentold","GLOBAL",1)~
ADD_TRANS_ACTION reven3 BEGIN 1 END BEGIN END ~SetGlobal("HelpHentold","GLOBAL",2)~
>>>>>>>>
COMPILE ~revent3change.d~
// ----------------------------------------------------------------------------
// The man with the golden pants doesn't give the tip to 18 charisma or better -- now he does
<<<<<<<< inlined/nobl9.d
//following line makes him give the tip to high charisma gabbers
REPLACE_ACTION_TEXT nobl9 ~GivePartyGold(2)~ ~GiveGoldForce(2)~
//add triggers to certain transactions
ADD_TRANS_TRIGGER nobl9 0 ~HasItem("MISC47",Myself)~ DO 2 3
>>>>>>>>
COMPILE ~inlined/nobl9.d~
// ----------------------------------------------------------------------------
// a guard doesn't go hostile as should
<<<<<<<< t-iron10.d
REPLACE_ACTION_TEXT iron10
~CreateCreature("IRONGU",[140.1555])~
~CreateCreature("IRONGU",[140.1555])
Enemy()~
>>>>>>>>
COMPILE ~t-iron10.d~
// ----------------------------------------------------------------------------
<<<<<<<< scarchanges.d
ADD_TRANS_ACTION ~SCAR~ BEGIN 17 END BEGIN 0 END ~GiveGoldForce(2000)~ UNLESS ~GiveGoldForce(2000)~
REPLACE_TRANS_ACTION SCAR
BEGIN 35 END
BEGIN 0 END
~AddexperienceParty(2500)~
~AddexperienceParty(2000)~
>>>>>>>>
COMPILE ~scarchanges.d~

PRINT ~Processing CREATURES-BasicCorrections.tph~
// ----------------------------------------------------------------------------
// Change item assignments so correct items are in slots
// ----------------------------------------------------------------------------
COPY_EXISTING ANDRIS.CRE OVERRIDE   // Andris: CLCK12 (Knave's Robe)
              MARCEL.CRE OVERRIDE   // Marcellus: CLCK13 (Traveller's Robe)
              SHANDAL2.CRE OVERRIDE // Shandalar: CLCK16 (Cloak of the Neutral Archmagi)
 PATCH_IF (SOURCE_SIZE > 0x2d4) BEGIN
  READ_LONG  0x2b8 "slot_off" ELSE 0
  READ_LONG  0x2bc "itm_off" ELSE 0
  READ_LONG  0x2c0 "itm_num" ELSE 0
  FOR (index = 0 ; index < itm_num ; index = index + 1) BEGIN
    READ_ASCII ("%itm_off%" + (0x14 * "%index%")) "item"
    PATCH_IF ("%item%" STRING_COMPARE_CASE "clck12" = 0) OR
             ("%item%" STRING_COMPARE_CASE "clck13" = 0) OR
             ("%item%" STRING_COMPARE_CASE "clck16" = 0) BEGIN
      WRITE_SHORT ("%slot_off%" + 0x02) "%index%" // puts in armor slot
      WRITE_SHORT ("%slot_off%" + 0x22) 0xffff    // removes entry from cloak slot
    END
  END
 END
BUT_ONLY_IF_IT_CHANGES

PRINT ~Processing CREATURES-MilochsPatches.tph~
// ----------------------------------------------------------------------------

//Alignment fixes
ACTION_FOR_EACH tcre IN ~nadine~ ~perdue~ ~phanda~ ~priilmu~ ~sleepdw~ ~sleephal~ BEGIN //Lawful Good (Dwarves, Halflings, Priest of Ilmater, Phandalyn)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x11 //Alignment
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~amnis3~ ~deltan2~ ~galile~ ~karan~ ~karan3~ ~knightsk~ ~monktu1~ ~monktu10~ ~monktu11~ ~monktu12~ ~monktu13~ ~monktu14~ ~monktu15~ ~monktu16~ ~monktu17~ ~monktu18~ ~monktu19~ ~monktu2~ ~monktu3~ ~monktu4~ ~monktu5~ ~monktu7~ ~monktu8~ ~monktu9~ ~monktu20~ ~pallon~ ~reevor~ ~reevor2~ BEGIN //Lawful Neutral (Monks, Reevor, Soldiers)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x12 //Alignment
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~baruk~ ~droth~ ~geltik~ ~glart~ ~hakt~ ~ihobgob~ ~malkax~ ~tersus~ ~teven~ ~winski2~ ~zekar~ BEGIN //Lawful Evil (Hobgoblins, Ogre Magi)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x13 //Alignment
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~halffg~ ~halfg3~ ~halfg4~ ~halfg5~ ~halfg6~ ~halfgu~ ~harbor~ ~zhurlo~ BEGIN //Neutral Good (Halfling Thieves)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x21 //Alignment
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~ashen~ ~attslim~ ~avarice~ ~barslim~ ~bat_in~ ~begbax_d~ ~beggbax~ ~bellam~ ~borin~ ~bouncer~ ~boyba1_a~ ~boybax_a~ ~boybax_b~ ~brevli~ ~cauter~ ~chase~ ~chherd~ ~chicke~ ~chicker~ ~childulg~ ~connol~ ~corpse1~ ~corpse2~ ~d2fue~ ~d2isl~ ~darryl~ ~dialogmo~ ~digger~ ~dopdop~ ~dopdur~ ~dopdur1~ ~dopdur2~ ~dopdur3~ ~dopfue~ ~dopisl~ ~dopkie~ ~drunk~ ~dursword~ ~erik~ ~euric~ ~farm~ ~farm3~ ~farm4~ ~farmer~ ~fcook2~ ~fcook3~ ~fear~ ~fecook~ ~feloni~ ~fenten~ ~fgolem~ ~foresh~ ~ftowba_c~ ~ftowbasc~ ~ftowbasn~ ~ftowbax~ ~ftowbesc~ ~ftowbex~ ~ftowfrsc~ ~ftowubx~ ~ftowwi_c~ ~ftwbax_a~ ~ftwbax_b~ ~ftwbax_c~ ~ftwbax_d~ ~ftwbax_e~ ~gerde~ ~ghorak~ ~girba3_a~ ~girbax_a~ ~girbax_b~ ~girbax_c~ ~girbax_d~ ~girbax_e~ ~golinv~ ~greywo~ ~gurke~ ~halfmiri~ ~halftr~ ~hecito~ ~hephis~ ~hersch~ ~housg6~ ~hulrik~ ~jondal~ ~jondal3~ ~jopi~ ~kerrac~ ~keshee~ ~kolvar~ ~kovera~ ~krumm~ ~lachlu~ ~lahl~ ~lothan~ ~love~ ~lovem~ ~lucky~ ~lussel~ ~mcook~ ~mcook2~ ~mcook3~ ~mcook4~ ~mcook5~ ~mtbe3~ ~mtbe9~ ~mtob7~ ~mtob9~ ~mtowba_a~ ~mtowba_b~ ~mtowba_c~ ~mtowba_d~ ~mtowba_e~ ~mtowbasc~ ~mtowbasn~ ~mtowbast~ ~mtowbax~ ~mtowbe~ ~mtowbe_a~ ~mtowbe_b~ ~mtowbe_c~ ~mtowbe_d~ ~mtowbe_e~ ~mtowbesn~ ~mtowbest~ ~mtowbex~ ~mtowfr~ ~mtowfr_a~ ~mtowfr_b~ ~mtowfr_c~ ~mtowfr_d~ ~mtowfr_e~ ~mtowfrsc~ ~mtowfrst~ ~mtown2~ ~mtown3~ ~mtown4~ ~mtown5~ ~mtowna~ ~mtowna_a~ ~mtowna_b~ ~mtowna_c~ ~mtowna_d~ ~mtownasc~ ~mtownast~ ~mtowub_a~ ~mtowub_b~ ~mtowub_c~ ~mtowub_d~ ~mtowub_e~ ~mtowubsc~ ~mtowubx~ ~mtowwi~ ~mtowwi_a~ ~mtowwi_b~ ~mtowwi_c~ ~mtowwi_d~ ~mtowwi_e~ ~mtwbax_a~ ~mtwbax_b~ ~mtwbax_c~ ~mtwbax_d~ ~mtwbax_e~ ~mtwslim~ ~mtwslim2~ ~mtwslim3~ ~nikola~ ~nobbax_a~ ~nobbax_b~ ~nobbax_c~ ~nobbax_d~ ~nobbax_e~ ~noblba_a~ ~noblba_b~ ~noblba_c~ ~noblba_d~ ~noblba_e~ ~noblpa~ ~noblpa1~ ~noblpa2~ ~noblpa3~ ~noblpa4~ ~noblpa5~ ~nosfer~ ~oberan~ ~ocelli~ ~oogiew~ ~petrin~ ~pheirk~ ~pnashk~ ~prat~ ~pride~ ~proslay~ ~prsbax_a~ ~prsbax_b~ ~prsbax_c~ ~quinn~ ~reevor3~ ~regina~ ~rodnim~ ~sailnew~ ~samuel~ ~shep~ ~skelet02~ ~skelet03~ ~sleepfat~ ~smuggl~ ~spengil~ ~squirr~ ~surrey~ ~tartus~ ~tiber~ ~tick~ ~voleta~ BEGIN //Neutral (Commoners, Nobles etc.)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x22 //Alignment
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~gantol1~ ~karlat~ BEGIN //Neutral Evil (Gantolandan, Karlat)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x23 //Alignment
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~ender~ ~norale~ ~sleepel~ BEGIN //Chaotic Good (Elves)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x31 //Alignment
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~britik~ ~destus~ ~garkla~ ~gnoll~ ~gnoll_a~ ~gnoll_b~ ~gnoll_c~ ~gnoll_d~ ~gnoll_e~ ~gnoll5~ ~gnoll5a~ ~gnolld~ ~gnollper~ ~gnollsu~ ~hack~ ~ingot~ ~ixvart~ ~nexlit~ ~ogre~ ~ogre02~ ~ogreco~ ~oopah~ ~oopah2~ ~plyogre~ ~pumber2~ ~pumberl~ ~xvart~ ~xvart01~ ~xvart_a~ ~xvart_b~ ~xvart_c~ ~xvart2~ ~xvarth~ ~xvartsu~ BEGIN //Chaotic Evil (Bassilus, Gnolls, Ogres, Priestess of Umberlee, Xvarts)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x27b 0x33 //Alignment
      END
    BUT_ONLY
  END
END

//Race, class and gender fixes
ACTION_IF FILE_EXISTS_IN_GAME ~tanar.cre~ BEGIN //Aec'Letec
  COPY_EXISTING ~tanar.cre~ ~override~
    PATCH_IF SOURCE_SIZE > 0x71 BEGIN
      WRITE_BYTE 0x272 121 //Race (demonic)
    END
  BUT_ONLY
END

ACTION_IF FILE_EXISTS_IN_GAME ~ashiru.cre~ BEGIN //Ashirukuru
  COPY_EXISTING ~ashiru.cre~ ~override~
    PATCH_IF SOURCE_SIZE > 0x71 BEGIN
      WRITE_BYTE 0x237 2 //Sex (female)
      WRITE_BYTE 0x272 133 //Race (spectre)
      WRITE_BYTE 0x275 2 //Gender (female)
    END
  BUT_ONLY
END

ACTION_FOR_EACH tcre IN ~cat~ ~catp~ BEGIN //Cats
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 137 //Race (cat)
        WRITE_BYTE 0x273 155 //Class (cat)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~amaran~ ~druid3~ ~izefia~ ~takiyah~ BEGIN //Druids
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x273 11 //Class (druid)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~sailal~ ~sleepdw~ ~tarnor~ BEGIN //Dwarves
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 4 //Race (dwarf)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~borda~ ~cordyr~ ~mordai~ ~sleepel~ BEGIN //Elves
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 2 //Race (elf)
      END
    BUT_ONLY
  END
END

ACTION_IF FILE_EXISTS_IN_GAME ~fear.cre~ BEGIN //Fear
  COPY_EXISTING ~fear.cre~ ~override~
    PATCH_IF SOURCE_SIZE > 0x71 BEGIN
      WRITE_BYTE 0x272 108 //Race (ghoul)
      WRITE_BYTE 0x273 117 //Class (ghoul_revenant)
    END
  BUT_ONLY
END

ACTION_FOR_EACH tcre IN ~cow~ ~cowh~ ~crew2~ ~crew3~ ~crew6~ ~d2isl~ ~delain~ ~delain2~ ~dopisl~ ~farthi~ ~ftowub~ ~ftowub_a~ ~ftowub_b~ ~ftowub_c~ ~ftowub_d~ ~ftowub_e~ ~ftowwi~ ~ftowwi_a~ ~ftowwi_b~ ~ftowwi_c~ ~ftowwi_d~ ~ftowwi_e~ ~isla~ ~kaish2~ ~kaisha~ ~kryla~ ~pallon~ ~solia1~ ~voleta~ BEGIN //Females
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x237 2 //Sex (female)
        WRITE_BYTE 0x275 2 //Gender (female)
      END
    BUT_ONLY
  END
END

COPY_EXISTING ~korax.cre~ ~override~ //Korax the Ghoul
  PATCH_IF SOURCE_SIZE > 0x71 BEGIN
    WRITE_BYTE 0x272 108 //Race (ghoul)
  END
BUT_ONLY

ACTION_FOR_EACH tcre IN ~gibber~ ~gibber2~ BEGIN //Gibberlings
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
      WRITE_BYTE 0x272 109 //Race (gibberling)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~gnoll02~ ~gnoll03~ ~gnoll3~ ~gnoll5~ ~gnoll5a~ BEGIN //Gnolls
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 110 //Race (gnoll)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~brevli~ ~mutami~ ~quinn~ ~tellan~ BEGIN //Gnomes
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 6 //Race (gnome)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~bgbishop~ ~bgking~ ~bgknight~ ~bgpawn~ ~bgrook~ BEGIN //Golems - Clay (Chess Pieces)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 144 //Race (golem)
        WRITE_BYTE 0x273 185 //Class (golem_clay)
      END
    BUT_ONLY
  END
END

ACTION_IF FILE_EXISTS_IN_GAME ~bgqueen.cre~ BEGIN //Golem - Clay (Queen)
  COPY_EXISTING ~bgqueen.cre~ ~override~
    PATCH_IF SOURCE_SIZE > 0x71 BEGIN
      WRITE_BYTE 0x237 2 //Sex (female)
      WRITE_BYTE 0x272 144 //Race (golem)
      WRITE_BYTE 0x273 185 //Class (golem_clay)
      WRITE_BYTE 0x275 2 //Gender (female)
    END
  BUT_ONLY
END

ACTION_FOR_EACH tcre IN ~duplica1~ ~fgolem~ ~golemf~ ~golemf2~ BEGIN //Golems - Flesh
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 144 //Race (golem)
        WRITE_BYTE 0x273 183 //Class (golem_flesh)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~avarice~ ~avaricem~ ~battho~ ~doomdur~ ~doomgu~ ~doomsa~ ~dumfue~ ~dumkie~ ~helmho~ ~pride~ ~pridem~ BEGIN //Golems - Iron (Helmed Horrors)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x237 1 //Sex (male)
        WRITE_BYTE 0x272 144 //Race (golem)
        WRITE_BYTE 0x273 182 //Class (golem_iron)
        WRITE_BYTE 0x275 4 //Gender (neither)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~dumisl~ ~love~ ~lovem~ BEGIN //Golems - Iron (Helmed Horrors, Female)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x237 2 //Sex (female)
        WRITE_BYTE 0x272 144 //Race (golem)
        WRITE_BYTE 0x273 182 //Class (golem_iron)
        WRITE_BYTE 0x275 2 //Gender (female)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~stonec~ ~stoned~ ~stonedl~ ~stonedw~ ~stoneg~ BEGIN //Golems - Stone
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 144 //Race (golem)
        WRITE_BYTE 0x273 184 //Class (golem_stone)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~arlin~ ~attslim~ ~bayard~ ~cuchol~ ~cythan~ ~digger~ ~drelik~ ~farluc~ ~narcil~ ~shaldr~ ~bgshank~ ~tenya~ ~tenya2~ ~thieff~ ~ulf~ ~wiven~ BEGIN //Half-Elves
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 3 //Race (half-elf)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~alvanh~ ~nader~ ~nelik~ ~sailfin~ ~sleephal~ BEGIN //Halflings
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 5 //Race (halfling)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~baruk~ ~bhobgob~ ~bullrush~ ~geltik~ ~glart~ ~hakt~ ~hobelite~ ~hobgo5~ ~hobgoa_a~ ~hobgoa_b~ ~hobgoa_c~ ~hobgoa_d~ ~hobgoa_e~ ~hobgob~ ~hobgob_a~ ~hobgob_b~ ~hobgob_c~ ~hobgob_d~ ~hobgob_e~ ~hobgoba~ ~hobgobc~ ~hobgzhur~ ~hobjoia~ ~ihobgob~ ~malkax~ ~tersus~ ~zargal~ ~zekar~ BEGIN //Hobgoblins
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 111 //Race (hobgoblin)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~fenrus~ BEGIN //Humans
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 1 //Race (human)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~blane~ ~bran~ ~dushai~ ~farthi~ ~joia~ ~jopi~ ~merch4~ ~mtbe7~ ~mtob3~ ~nantri~ BEGIN //Innocents
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x273 155 //Class (innocent)
      END
    BUT_ONLY
  END
END

ACTION_IF FILE_EXISTS_IN_GAME ~kirinh.cre~ BEGIN //Kirinhale
  COPY_EXISTING ~kirinh.cre~ ~override~
    PATCH_IF SOURCE_SIZE > 0x71 BEGIN
      WRITE_BYTE 0x237 2 //Sex (female)
      WRITE_BYTE 0x272 121 //Race (demonic)
      WRITE_BYTE 0x275 2 //Gender (female)
    END
  BUT_ONLY
END

COPY_EXISTING ~droth.cre~ ~override~ //Droth (Ogre Mage)
  PATCH_IF SOURCE_SIZE > 0x71 BEGIN
    WRITE_BYTE 0x272 113 //Race (ogre)
  END
BUT_ONLY

ACTION_FOR_EACH tcre IN ~rat~ ~rat2~ ~squirr~ BEGIN //Rodents
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 151 //Race (rabbit)
        WRITE_BYTE 0x273 199 //Class (food_creature)
      END
    BUT_ONLY
  END
END

COPY_EXISTING ~jellgr.cre~ ~override~ //Slime - Gray Ooze
  PATCH_IF SOURCE_SIZE > 0x71 BEGIN
    WRITE_BYTE 0x272 119 //Race (slime)
    WRITE_BYTE 0x273 153 //Class (grey_ooze)
  END
BUT_ONLY

ACTION_FOR_EACH tcre IN ~jellmu~ ~jellmul~ ~jellspa~ ~jellymu~ BEGIN //Slimes - Mustard Jellies
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 119 //Race (slime)
        WRITE_BYTE 0x273 151 //Class (mustard_jelly)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~jellygr~ ~jellygr2~ BEGIN //Slimes - Green
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 119 //Race (slime)
        WRITE_BYTE 0x273 154 //Class (green_slime)
      END
    BUT_ONLY
  END
END

COPY_EXISTING ~schlum.cre~ ~override~ //Slime - Schlumpsha
  PATCH_IF SOURCE_SIZE > 0x71 BEGIN
    WRITE_BYTE 0x272 119 //Race (slime)
    WRITE_BYTE 0x273 150 //Class (olive_slime)
  END
BUT_ONLY

ACTION_FOR_EACH tcre IN ~bgknight1~ ~daitel~ ~knight2~ ~knight3~ ~knight4~ ~knight5~ ~knight6~ BEGIN //Spectres
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 133 //Race (spectre)
        WRITE_BYTE 0x273 171 //Class (spectre)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~durlagt~ ~isla~ BEGIN //Spectres (Innocent)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 133 //Race (spectre)
      END
    BUT_ONLY
  END
END

COPY_EXISTING ~centeo.cre~ ~override~ //Centeol the Spider Queen
  PATCH_IF SOURCE_SIZE > 0x71 BEGIN
    WRITE_BYTE 0x272 116 //Race (spider)
    WRITE_BYTE 0x273 189 //Class (spider_centeol)
  END
BUT_ONLY

COPY_EXISTING ~stalke.cre~ ~override~ //Stalker
  PATCH_IF SOURCE_SIZE > 0x71 BEGIN
    WRITE_BYTE 0x272 136 //Race (mist)
  END
BUT_ONLY

ACTION_FOR_EACH tcre IN ~achen~ ~cailan~ ~faizah~ ~rance~ ~vail~ BEGIN //Statues
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 149 //Race (statue)
      END
    BUT_ONLY
  END
END

ACTION_IF FILE_EXISTS_IN_GAME ~dursword.cre~ BEGIN //Durlag's Pride (Sword)
  COPY_EXISTING ~dursword.cre~ ~override~
    PATCH_IF SOURCE_SIZE > 0x71 BEGIN
      WRITE_BYTE 0x272 201 //Race (sword)
      WRITE_BYTE 0x273 201 //Class (long_sword)
    END
  BUT_ONLY
END

ACTION_FOR_EACH tcre IN ~baresh~ ~baresh2~ ~barwlf~ BEGIN //Baresh (Werewolf)
  ACTION_IF FILE_EXISTS_IN_GAME ~barwlf.cre~ BEGIN
    COPY_EXISTING ~barwlf.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 122 //Race (lycanthrope)
        WRITE_BYTE 0x273 157 //Class (werewolf)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~marale~ ~marale2~ BEGIN //Maralee (Werewolf)
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x237 2 //Sex (female)
        WRITE_BYTE 0x272 122 //Race (lycanthrope)
        WRITE_BYTE 0x273 155 //Class (innocent)
        WRITE_BYTE 0x275 2 //Gender (female)
      END
    BUT_ONLY
  END
END

ACTION_FOR_EACH tcre IN ~jondalw~ ~wolfwe~ BEGIN //Wolfweres
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 122 //Race (lycanthrope)
        WRITE_BYTE 0x273 158 //Class (wolfwere)
      END
    BUT_ONLY
  END
END

COPY_EXISTING ~destus.cre~ ~override~ //Destus Gurn (Xvart)
  PATCH_IF SOURCE_SIZE > 0x71 BEGIN
    WRITE_BYTE 0x272 112 //Race (kobold)
    WRITE_BYTE 0x273 124 //Class (kobold_xvart)
  END
BUT_ONLY

ACTION_FOR_EACH tcre IN ~sewerf2~ ~zombie~ ~zombie_a~ ~zombie_b~ ~zombie_c~ ~zombie_d~ ~zombie_e~ ~zombieb~ ~zombiew~ BEGIN //Zombies
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_BYTE 0x272 148 //Race (zombie)
        WRITE_BYTE 0x273 198 //Class (zombie_normal)
      END
    BUT_ONLY
  END
END

PRINT ~Processing ITEMS-BasicCorrections.tph~
// ----------------------------------------------------------------------------
//~Fix incorrect item type~
// ----------------------------------------------------------------------------
COPY_EXISTING ~arow13.itm~ ~override~
 PATCH_IF (%SOURCE_SIZE% > 0x70) BEGIN                    //avoid bad files
  WRITE_SHORT 0x1c 5  // sets to arrow rather than misc/book
 END
BUT_ONLY_IF_IT_CHANGES

PRINT ~Processing ISSUES-VariousScriptWorkByMiloch.tph~
// ----------------------------------------------------------------------------
//Ensure attacked/hostile non-combatants run away if they can/should
ACTION_FOR_EACH tcre IN ~ardrou~ ~fenrus~ ~petrin~ ~therel~ ~triado~ ~wirthi~ BEGIN
  ACTION_IF FILE_EXISTS_IN_GAME ~%tcre%.cre~ BEGIN
    COPY_EXISTING ~%tcre%.cre~ ~override~
      PATCH_IF SOURCE_SIZE > 0x71 BEGIN
        WRITE_ASCII 0x268 ~wtrunsgt~ #8 //Default script
        PATCH_LOG ~%SOURCE_FILE% - assigned wtrunsgt to the default script slot~
      END
    BUT_ONLY
  END
END

//Halfling enforcers go hostile where relevant
<<<<<<<< t-halfen.d
ADD_TRANS_ACTION halfen BEGIN 0 END BEGIN 2 END ~Shout(99) Enemy()~
ADD_TRANS_ACTION halfen BEGIN 1 END BEGIN 0 END ~Shout(99) Enemy()~
>>>>>>>>
COMPILE ~t-halfen.d~

//Make sure guards only initiate dialogue if character is visible
COPY_EXISTING ~amnise.bcs~  ~override~ //Amnish Soldier
  DECOMPILE_AND_PATCH BEGIN
    COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~STATE_IMPROVEDINVISIBILITY~ tsp1
    PATCH_IF (tsp1 < 1) BEGIN
      REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~NumTimesTalkedTo(0)~ ~NumTimesTalkedTo(0) See([PC]) !StateCheck(LastSeenBy(),STATE_INVISIBLE) !StateCheck(LastSeenBy(),STATE_IMPROVEDINVISIBILITY)~
      PATCH_LOG ~%SOURCE_FILE% - added additional checks to not talk to invisible~
    END
  END
BUT_ONLY

COPY_EXISTING ~monken.bcs~ ~override~ //Candlekeep Watcher
  DECOMPILE_AND_PATCH BEGIN
    COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~STATE_IMPROVEDINVISIBILITY~ tsp1
    PATCH_IF (tsp1 < 1) BEGIN
      REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~NumTimesTalkedTo(0)~ ~NumTimesTalkedTo(0) See([PC]) !StateCheck(LastSeenBy(),STATE_INVISIBLE) !StateCheck(LastSeenBy(),STATE_IMPROVEDINVISIBILITY)~
      PATCH_LOG ~%SOURCE_FILE% - added additional checks to not talk to invisible~
    END
  END
BUT_ONLY

//Cloakwood Mines Guard infinite summoning fix
<<<<<<<< t-iron10.d
ADD_TRANS_ACTION iron10 BEGIN 0 END BEGIN 2 END ~Enemy()~
ADD_TRANS_ACTION iron10 BEGIN 1 END BEGIN 0 END ~Enemy()~
REPLACE_ACTION_TEXT iron10
  ~CreateCreature("IRONGU",\[140.1555\])~
  ~CreateCreature("IRONGU",[140.1555]) Enemy()~
>>>>>>>>
COMPILE ~t-iron10.d~

//Assign steal failure scripts where missing
<<<<<<<< t-maltz.baf
IF
  StealFailed([0])
THEN
  RESPONSE #100
    Wait(3)
    CreateCreature("FLAMEN",[425.362],0)
    CreateCreature("FLAMEN2",[400.370],0)
    CreateCreature("FLAMEN2",[435.340],0)
    Enemy()
END
>>>>>>>>
COMPILE ~t-maltz.baf~  //Steal failure script

COPY_EXISTING ~maltz.cre~ ~override~ //Maltz (AR0803)
  WRITE_ASCII 0x260 ~t-maltz~ #8 //General script
BUT_ONLY

COPY_EXISTING ~lucky.cre~  ~override~ //Lucky Aello (AR0810)
              ~shop01.cre~ ~override~ //Storekeep (AR0304)
  WRITE_ASCII 0x260 ~shop03~ #8 //General script
BUT_ONLY

COPY_EXISTING ~innke2.cre~  ~override~ //Winthrop (AR2616)
              ~winthr2.cre~ ~override~ //Winthrop (AR2629)
  WRITE_ASCII 0x260 ~innkeep~ #8 //General script
BUT_ONLY

PRINT ~Processing ISSUES-NoTalkHostile.tph~
// ----------------------------------------------------------------------------
//those who initate only do so if not hostile
ACTION_FOR_EACH file IN ~initdlg~ ~initdlg2~ ~initdlg3~ ~initdlgc~ ~initneb~ ~initobe~ ~initrev~ BEGIN
ACTION_IF (FILE_EXISTS_IN_GAME ~%file%.bcs~) THEN BEGIN
COPY_EXISTING ~%file%.bcs~ override
 DECOMPILE_AND_PATCH BEGIN
  COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~!Allegiance(Myself,ENEMY)~ tsp1
  PATCH_IF (tsp1 < 1) BEGIN
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~See([PC])~ ~See([PC]) !Allegiance(Myself,ENEMY)~
  END
 END
BUT_ONLY
END
END
COPY_EXISTING initmain.bcs override
 DECOMPILE_AND_PATCH BEGIN
  COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~!Allegiance(Myself,ENEMY)~ tsp1
  PATCH_IF (tsp1 < 1) BEGIN
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~See(Player1)~ ~See(Player1) !Allegiance(Myself,ENEMY)~
  END
 END
BUT_ONLY
ACTION_IF (FILE_EXISTS_IN_GAME ~initinv2.bcs~) THEN BEGIN
COPY_EXISTING initinv2.bcs override
 DECOMPILE_AND_PATCH BEGIN
  COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~!Allegiance(Myself,ENEMY)~ tsp1
  PATCH_IF (tsp1 < 1) BEGIN
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~Detect([PC])~ ~Detect([PC]) !Allegiance(Myself,ENEMY)~
  END
 END
BUT_ONLY
END
//adjust imoen to not talk when she is hostile
COPY_EXISTING bgimoen.bcs override
DECOMPILE_AND_PATCH BEGIN
  COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~!Allegiance(Myself,ENEMY)~ tsp1
  PATCH_IF (tsp1 < 1) BEGIN
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~Global("TalkedToGorion","GLOBAL",0)~ ~Global("TalkedToGorion","GLOBAL",0) !Allegiance(Myself,ENEMY)~
  END
END
BUT_ONLY

PRINT ~Processing SCRIPTS-StealFailureGuardSpawns.tph~
// ----------------------------------------------------------------------------
// guard spawn locations for steal failure scripts
// move the guards to the entrance if the spawn location is off.
ACTION_FOR_EACH tbcs IN ~innkeep~ ~merch2~ ~merch5~ ~merch6~ ~shop03~ ~shop04~ ~shop05~ ~shop06~ ~shopkn~ BEGIN
 ACTION_IF FILE_EXISTS_IN_GAME ~%tbcs%.bcs~ BEGIN
  COPY_EXISTING ~%tbcs%.bcs~ ~override~
   DECOMPILE_AND_PATCH BEGIN
    COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("WATCHN",[554.516],0)+CreateCreature("WATCHN2",[554.516],0)~ tsp1
    PATCH_IF (tsp1 < 1) BEGIN
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("WATCHN",[535.425],0)~ ~CreateCreature("WATCHN",[554.516],0)~ // Moved to the entrance.
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("WATCHN2",[535.425],0)~ ~CreateCreature("WATCHN2",[554.516],0)~
    END
    COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("AMNISE",[262.326],0)+CreateCreature("AMNISE2",[262.326],0)~ tsp2
    PATCH_IF (tsp2 < 1) BEGIN
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("AMNISE",[390.329],0)~ ~CreateCreature("AMNISE",[262.326],0)~ // Moved to the entrance.
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("AMNISE2",[390.329],0)~ ~CreateCreature("AMNISE2",[262.326],0)~
    END
    COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[678.391],0)+CreateCreature("FLAMEN2",[678.391],0)~ tsp3
    PATCH_IF (tsp3 < 1) BEGIN
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[694.372],0)~ ~CreateCreature("FLAMEN",[678.391],0)~ // Moved to the entrance.
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN2",[694.372],0)~ ~CreateCreature("FLAMEN2",[678.391],0)~
    END
    COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[558.462],0)+CreateCreature("FLAMEN2",[558.462],0)~ tsp4
    PATCH_IF (tsp4 < 1) BEGIN
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[597.442],0)~ ~CreateCreature("FLAMEN",[558.462],0)~ // Moved to the entrance.
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN2",[597.442],0)~ ~CreateCreature("FLAMEN2",[558.462],0)~
    END
    COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("AMNISE2",[223.407],0)+CreateCreature("AMNISE2",[223.407],0)~ tsp5
    PATCH_IF (tsp5 < 1) BEGIN
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("AMNISE",[335.396],0)~ ~CreateCreature("AMNISE",[223.407],0)~ // Moved to the entrance.
     REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("AMNISE2",[335.396],0)~ ~CreateCreature("AMNISE2",[223.407],0)~
    END
   END
  BUT_ONLY
 END
END
COPY_EXISTING ~shop07.bcs~ ~override~
 DECOMPILE_AND_PATCH BEGIN
  COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[558.462],0)+CreateCreature("FLAMEN2",[558.462],0)~ tsp1
  PATCH_IF (tsp1 < 1) BEGIN
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[694.372],0)~ ~CreateCreature("FLAMEN",[558.462],0)~ // Moved to the entrance.
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN2",[694.372],0)~ ~CreateCreature("FLAMEN2",[558.462],0)~
  END
 END
BUT_ONLY
COPY_EXISTING ~shop08.bcs~ ~override~
 DECOMPILE_AND_PATCH BEGIN
  COUNT_REGEXP_INSTANCES CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[678.391],0)+CreateCreature("FLAMEN2",[678.391],0)~ tsp1
  PATCH_IF (tsp1 < 1) BEGIN
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN",[597.442],0)~ ~CreateCreature("FLAMEN",[678.391],0)~ // Moved to the entrance.
   REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~CreateCreature("FLAMEN2",[597.442],0)~ ~CreateCreature("FLAMEN2",[678.391],0)~
  END
 END
BUT_ONLY

PRINT ~Processing ISSUES-YeslickKickoutLoopFix.tph~
// ----------------------------------------------------------------------------
// Prevent the Yeslick kickout loop
//~Fix Yeslick kickout looping issue~
COPY_EXISTING ~yeslick.bcs~ ~override~
  DECOMPILE_BCS_TO_BAF
   REPLACE_TEXTUALLY EXACT_MATCH ~GlobalTimerExpired("Yeslick","GLOBAL")~ ~GlobalTimerExpired("Yeslick","GLOBAL") !Global("MineFlood","GLOBAL",2)~
  COMPILE_BAF_TO_BCS
BUT_ONLY_IF_IT_CHANGES
<<<<<<<< .../d-inlined/dlg-changes.d
REPLACE_TRIGGER_TEXT ~yeslij~ ~False()~ ~GlobalTimerExpired("Yeslick","GLOBAL")
Global("MineFlood","GLOBAL",1)~
ADD_TRANS_ACTION ~yeslij~ BEGIN 3 END BEGIN END ~SetGlobal("MineFlood","GLOBAL",2)~
>>>>>>>>
COMPILE ~.../d-inlined/dlg-changes.d~

PRINT ~Processing ISSUES-MonksSpeakOfDeadOnlyWhenDead.tph~
// ----------------------------------------------------------------------------
// Monks will appear and speak if you leave the building without killing them -- now they won't
// dudley - DV assignment only
COPY_EXISTING ~carbos.cre~ ~override~   // Carbos (Candlekeep, Tutorial)
              ~shank.cre~ ~override~    // Shank (Candlekeep, Tutorial)
 PATCH_IF (SOURCE_SIZE > 0x2d4) BEGIN
  WRITE_EVALUATED_ASCII 0x280 ~%SOURCE_RES%~ #18 // dv = 18 bytes
 END
BUT_ONLY_IF_IT_CHANGES
COPY_EXISTING ~ar0015.bcs~ ~override~
 DECOMPILE_BCS_TO_BAF
  REPLACE_TEXTUALLY EXACT_MATCH ~Global("carbos","GLOBAL",1)~ ~Global("carbos","GLOBAL",1)
Dead("shank")~
  REPLACE_TEXTUALLY EXACT_MATCH ~Global("shank","GLOBAL",1)~ ~Global("shank","GLOBAL",1)
Dead("carbos")~
 COMPILE_BAF_TO_BCS
BUT_ONLY_IF_IT_CHANGES

PRINT ~Processing ISSUES-ScarNoGoBye.tph~
// ----------------------------------------------------------------------------
/* scar.bcs this is what makes scar disappear if the duke was spoken to
IF
Global("SHITNUTS","GLOBAL",1)
THEN
RESPONSE #100
  SetGlobal("ScarMission","GLOBAL",20)
  DestroySelf()
END */
//we need to change this to keep him around
/*
value 5 is when player quits or finishes scars quests
value 6 is when player has been asked to see the duke but refused
value 8 is when player has refused scars quests outright from the beginning
these are valid points in which to have Scar disappear should the player go ahead and talk to the Duke
else Scar stays so that the player can finish or quit Scars quests
*/
<<<<<<<< scarextension.baf
IF
   Global("SHITNUTS","GLOBAL",1)
   Global("ScarMission","GLOBAL",6)
THEN
   RESPONSE #100
         SetGlobal("ScarMission","GLOBAL",20)
         DestroySelf()
END
IF
   Global("SHITNUTS","GLOBAL",1)
   Global("ScarMission","GLOBAL",8)
THEN
   RESPONSE #100
         SetGlobal("ScarMission","GLOBAL",20)
         DestroySelf()
END
>>>>>>>>
COPY_EXISTING scar.bcs override
 DECOMPILE_BCS_TO_BAF
  REPLACE_TEXTUALLY ~Global("SHITNUTS","GLOBAL",1)~ ~Global("SHITNUTS","GLOBAL",1) Global("ScarMission","GLOBAL",5) ~
  PATCH_LOG ~%SOURCE_FILE% - Added ScarMission var check to existing block & added two additional blocks~
 COMPILE_BAF_TO_BCS
BUT_ONLY
EXTEND_BOTTOM scar.bcs scarextension.baf

PRINT ~Processing ISSUES-ToTSC-CountingHouseConflicts.tph~
// ----------------------------------------------------------------------------
//Dudley patch -- Counting House, AR7407 and AR7408 -
// ----------------------------------------------------------------------------
//both area scripts conflict with the dialogue of Ulf and Kieres respectively such that if you end up in a fight with Ulf,
//he triggers an action that tries to turn the guards hostile (who are upstairs from him) and if you fight with Kieres,
//he turns the crewmates hostile (who are downstairs from him).
//It would seem most likely that the guards should guard the lower floor and the crewmates are with their captain.
//If there is any doubt the captain calls to his "mates" for help.
ACTION_FOR_EACH file IN ~crew1~ ~crew2~ ~crew3~ ~crew4~ ~crew5~ ~crew6~ ~crew7~ BEGIN
 COPY_EXISTING ~%file%.cre~ ~override~
  WRITE_ASCII 0x280 ~~ (32) //removed old
  WRITE_ASCIIE 0x280 ~%SOURCE_RES%~ (5)  //assign new
 BUT_ONLY_IF_IT_CHANGES
END
COPY_EXISTING ar7408.bcs override
 DECOMPILE_BCS_TO_BAF
  REPLACE_TEXTUALLY EXACT_MATCH ~LEAGGU~ ~CREW~
 COMPILE_BAF_TO_BCS
BUT_ONLY_IF_IT_CHANGES
COPY_EXISTING ar7407.bcs override
 DECOMPILE_BCS_TO_BAF
  REPLACE_TEXTUALLY EXACT_MATCH ~CREW~ ~LEAGGU~
 COMPILE_BAF_TO_BCS
BUT_ONLY_IF_IT_CHANGES


/////////////////////////////////////
/// Eliminate reference to Helmet ///
/////////////////////////////////////

STRING_SET 20696 ~Critical Hit Averted~

///////////////////////////////////////
/// Eliminate reference to monsters ///
///////////////////////////////////////

STRING_SET 16501 ~You cannot save at this time... Enemies are about.~

/////////////////////////////
/// Correct BGT name typo ///
/////////////////////////////

STRING_SET 12238 ~Galken~
STRING_SET 12283 ~Galken~

//////////////////////////////////////
/// Restored unused NPC BG1 sounds ///
//////////////////////////////////////

COPY_EXISTING ~DELSVIR.CRE~ ~override~
 SAY INITIAL_MEETING ~Blast it thrice over!  I am through with it I am so!  'Tis no livin' left here none!~ [DELSV01]
 SAY DAMAGE ~~ [DELSV03]
 SAY DYING ~~ [DELSV04]
 SAY SELECT_COMMON1 ~WHAT?!  What and what now?!~ [DELSV02]
BUT_ONLY

COPY_EXISTING ~GANDOL.CRE~ ~override~
 SAY INITIAL_MEETING ~Well met, traveler.  Gandolar Luckyfoot, at your disposal.~ [GANDL01]
 SAY DAMAGE ~~ [GANDL03]
 SAY DYING ~~ [GANDL04]
 SAY SELECT_COMMON1 ~Gullykin is our pride and joy.  Treat her well.~ [GANDL02]
BUT_ONLY

COPY_EXISTING ~GELLAN.CRE~ ~override~
 SAY DAMAGE ~~ [GELLN03]
 SAY DYING ~~ [GELLN04]
BUT_ONLY

COPY_EXISTING 	~HUSAM.CRE~ ~override~				// There is one alternate sound for DYING already in Infinity Sounds but this one sounds way better
		~HUSAM2.CRE~ ~override~
 SAY DYING ~~ [HUSAM12]
BUT_ONLY

COPY_EXISTING ~RAGEFA.CRE~ ~override~
 SAY INITIAL_MEETING ~Now know thee well I cannot let thee leave.  We are meant to be together, whether ye know it or not.~ [RAGEF01]
 SAY DAMAGE ~~ [RAGEF03]
 SAY DYING ~~ [RAGEF04]
 SAY SELECT_COMMON1 ~Love is blind, deaf, and ever ever so dumb!~ [RAGEF02]
BUT_ONLY

COPY_EXISTING ~SILKE.CRE~ ~override~
 SAY SELECT_COMMON1 ~I am a musician, not a chatter box.~ [SILKE02]
BUT_ONLY

///////////////////////////////
/// Thieves' Guild revision ///
///////////////////////////////

COPY 		~stweaks/bcs/initnik.bcs~ 	~override~
COPY 		~stweaks/cre/thiefg2.cre~	~override~

COPY_EXISTING	~AR7248.ARE~	~override~
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Rogue~ = 1) BEGIN
        WRITE_SHORT (i * 0x110 + act_off + 0x20) 336
        WRITE_SHORT (i * 0x110 + act_off + 0x22) 171
        WRITE_SHORT (i * 0x110 + act_off + 0x24) 336
        WRITE_SHORT (i * 0x110 + act_off + 0x26) 171
	WRITE_SHORT (i * 0x110 + act_off + 0x34) 2	
      END
    END
  END
BUT_ONLY

COPY_EXISTING	~AR7250.ARE~	~override~
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Rogue~ = 1) BEGIN
        WRITE_SHORT (i * 0x110 + act_off + 0x20) 538
        WRITE_SHORT (i * 0x110 + act_off + 0x22) 257
        WRITE_SHORT (i * 0x110 + act_off + 0x24) 538
        WRITE_SHORT (i * 0x110 + act_off + 0x26) 257
	WRITE_SHORT (i * 0x110 + act_off + 0x34) 3	
        WRITE_ASCII (i * 0x110 + act_off + 0x60) ~None~			#8
      END
    END
  END
BUT_ONLY

COPY_EXISTING	~AR7251.ARE~	~override~
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Rogue~ = 1) BEGIN
        WRITE_SHORT (i * 0x110 + act_off + 0x20) 288
        WRITE_SHORT (i * 0x110 + act_off + 0x22) 142
        WRITE_SHORT (i * 0x110 + act_off + 0x24) 288
        WRITE_SHORT (i * 0x110 + act_off + 0x26) 142
	WRITE_SHORT (i * 0x110 + act_off + 0x34) 0
        WRITE_ASCII (i * 0x110 + act_off + 0x60) ~None~			#8
      END
    END
  END
BUT_ONLY

COPY_EXISTING	~AR7252.ARE~	~override~
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Rogue~ = 1) BEGIN
        WRITE_SHORT (i * 0x110 + act_off + 0x20) 517
        WRITE_SHORT (i * 0x110 + act_off + 0x22) 250
        WRITE_SHORT (i * 0x110 + act_off + 0x24) 517
        WRITE_SHORT (i * 0x110 + act_off + 0x26) 250
	WRITE_SHORT (i * 0x110 + act_off + 0x34) 1	
        WRITE_ASCII (i * 0x110 + act_off + 0x60) ~None~			#8
      END
    END
  END
BUT_ONLY

COPY_EXISTING	~niklos.cre~	~override~
	WRITE_ASCII SCRIPT_OVERRIDE	~INITNIK~	#8
	WRITE_ASCII DEATHVAR		~NIKLOS~	#8
BUT_ONLY

COMPILE		~stweaks\baf\nikcut.baf~

COPY_EXISTING	~blackl.cre~	~override~
	WRITE_ASCII DEATHVAR		~BLACKL~	#8
BUT_ONLY

COPY_EXISTING	~alatos.cre~	~override~
	WRITE_LONG	0x14	5000
	WRITE_SHORT	0x46	10
	WRITE_SHORT	0x48	10
	WRITE_BYTE	0x52	13
	WRITE_BYTE	0x54	10
	WRITE_BYTE	0x55	8
	WRITE_BYTE	0x56	9
	WRITE_BYTE	0x57	13
	WRITE_BYTE	0x58	9
	WRITE_BYTE	0x68	100
	WRITE_BYTE	0x238	11
	WRITE_BYTE	0x23a	14
	WRITE_BYTE	0x23b	15
	WRITE_BYTE	0x23c	17
	WRITE_BYTE	0x23d	10
	WRITE_BYTE	0x23e	17
	REPLACE_CRE_ITEM		~LEAT05~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
	WRITE_ASCII DEATHVAR		~ALATOS~	#8
BUT_ONLY

COPY_EXISTING	~resar.cre~	~override~
	WRITE_ASCII SCRIPT_CLASS 	~MAGE5~		#8
	ADD_CRE_ITEM			~CLCK12~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
	ADD_MEMORIZED_SPELL ~SPWI119~ #0 ~wizard~ (3)
	ADD_MEMORIZED_SPELL ~SPWI205~ #1 ~wizard~ (1)
	ADD_MEMORIZED_SPELL ~SPWI211~ #1 ~wizard~ (1)
	ADD_MEMORIZED_SPELL ~SPWI212~ #1 ~wizard~ (1)
	ADD_MEMORIZED_SPELL ~SPWI308~ #2 ~wizard~ (1)
	ADD_MEMORIZED_SPELL ~SPWI309~ #2 ~wizard~ (1)
	ADD_MEMORIZED_SPELL ~SPWI401~ #3 ~wizard~ (1)
BUT_ONLY

COPY_EXISTING 	~thief.cre~ 	~override~	  
		~thiefm.cre~	~override~
		~thieff.cre~ 	~override~
	WRITE_BYTE	0x68	60
	WRITE_ASCII SCRIPT_OVERRIDE	~None~		#8
	WRITE_ASCII SCRIPT_CLASS 	~THIEF4~	#8
	ADD_CRE_ITEM			~BOW05~	 	#0 	#0 	#0 	~NONE~ 	~WEAPON~ 	TWOHANDED
	ADD_CRE_ITEM			~AROW01~ 	#20 	#0 	#0 	~NONE~ 	~QUIVER~
	REPLACE_CRE_ITEM		~LEAT04~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
BUT_ONLY

COPY_EXISTING 	~NARLEN.BCS~ 	~override~
	DECOMPILE_AND_PATCH BEGIN
	REPLACE_TEXTUALLY	~Global("TalkedToNarlen","GLOBAL",0)~				~Global("TalkedToNarlen","GLOBAL",0)
Global("BG_AttackedThieves","GLOBAL",0)~
END
BUT_ONLY

COPY_EXISTING 	~THIEF.BCS~ 	~override~
	REPLACE_BCS_BLOCK	~stweaks/baf/thiefo1.baf~	~stweaks/baf/thiefn1.baf~
	REPLACE_BCS_BLOCK	~stweaks/baf/thiefo2.baf~	~stweaks/baf/thiefn2.baf~
BUT_ONLY

EXTEND_BOTTOM 	~THIEF.BCS~	~stweaks/baf/thiefn3.baf~

COPY_EXISTING 	~thiefg.cre~ 	~override~
	WRITE_ASCII SCRIPT_OVERRIDE	~THIEFG~	#8
	WRITE_ASCII SCRIPT_CLASS 	~None~		#8
	WRITE_ASCII SCRIPT_RACE		~None~		#8
	WRITE_ASCII SCRIPT_GENERAL 	~None~		#8
	WRITE_ASCII SCRIPT_DEFAULT 	~None~		#8
	WRITE_ASCII DEATHVAR		~THIEFG~	#8
BUT_ONLY

COPY_EXISTING 	~THIEFG.BCS~ 	~override~
	REPLACE_BCS_BLOCK	~stweaks/baf/thiefgo1.baf~	~stweaks/baf/thiefgn1.baf~
BUT_ONLY

EXTEND_BOTTOM 	~THIEFG.BCS~	~stweaks/baf/thiefgn2.baf~

EXTEND_TOP 	~AR7248.BCS~ 	~stweaks/baf/ar7248a.baf~
EXTEND_TOP	~AR7250.BCS~ 	~stweaks/baf/ar7250a.baf~
EXTEND_TOP 	~AR7251.BCS~ 	~stweaks/baf/ar7251a.baf~
EXTEND_TOP 	~AR7252.BCS~ 	~stweaks/baf/ar7252a.baf~
EXTEND_TOP 	~AR7253.BCS~ 	~stweaks/baf/ar7253a.baf~
EXTEND_BOTTOM	~AR7800.BCS~ 	~stweaks/baf/ar7800a.baf~

<<<<<<<< stweaks-inlined/#gthiefg.d
REPLACE THIEFG
IF ~AreaCheck("AR7248")~ THEN BEGIN 0 // from:
  SAY @43 /* ~You there! What are ye doing in 'dis place? You better git outta here, 'less of course you know the password.~ */
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN REPLY @44 /* ~Password? Why would I need a password? What in the Nine Hells are you talking about?~ */ GOTO 1
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @45 /* ~Ya, I know the password.~ */ GOTO 2
END
IF ~~ THEN BEGIN 1 // from: 0.0
  SAY @46 /* ~Yer in the wrong place, fella. I'd git out while yer still able. I might not be able to stop a buncha well-armed adventurers, but if you cause any trouble in the guild, don't be expecting to walk out in one piece.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning1","LOCALS",12)
SetGlobal("WarningGiven1","GLOBAL",1)~ EXIT
END
IF ~~ THEN BEGIN 2 // from: 0.1
  SAY @47 /* ~Well, if you know the password, then spill it.~ */
  IF ~~ THEN REPLY @48 /* ~Darkwell~ */ GOTO 3
  IF ~~ THEN REPLY @49 /* ~Ravenscar~ */ GOTO 3
  IF ~~ THEN REPLY @50 /* ~Mask~ */ GOTO 3
  IF ~~ THEN REPLY @51 /* ~Fafhrd~ */ GOTO 4
  IF ~~ THEN REPLY @52 /* ~Bodi~ */ GOTO 3
  IF ~~ THEN REPLY @53 /* ~Mercury~ */ GOTO 3
  IF ~~ THEN REPLY @54 /* ~Shadow~ */ GOTO 3
END
IF ~~ THEN BEGIN 3 // from: 2.6 2.5 2.4 2.2 2.1 2.0
  SAY @55 /* ~Wrong answer. Git outta here fast 'fore ya get hurt.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning1","LOCALS",12)
SetGlobal("WarningGiven1","GLOBAL",3)
SetGlobal("KnownPassword","GLOBAL",0)~ EXIT
END
IF ~~ THEN BEGIN 4 // from: 2.3
  SAY @57 /* ~That's right, fella. Ya can go in now.~ */
  IF ~AreaCheck("AR7248")~ THEN DO ~SetGlobal("SaidPassword","LOCALS",1)
SetDialog("Thiefm")
MoveToPoint([330.202])
Face(2)
~ EXIT
  IF ~AreaCheck("AR7250")~ THEN DO ~SetGlobal("SaidPassword","LOCALS",1)
SetDialog("Thiefm")
MoveToPoint([469.269])
Face(3)
~ EXIT
  IF ~AreaCheck("AR7251")~ THEN DO ~SetGlobal("SaidPassword","LOCALS",1)
SetDialog("Thiefm")
MoveToPoint([274.171])
Face(0)
~ EXIT
  IF ~AreaCheck("AR7252")~ THEN DO ~SetGlobal("SaidPassword","LOCALS",1)
SetDialog("Thiefm")
MoveToPoint([500.290])
Face(3)
~ EXIT
END
END

APPEND THIEFG
IF WEIGHT #-1 ~AreaCheck("AR7248")
NumTimesTalkedToGT(0)
Global("WarningGiven1","GLOBAL",5)~ THEN BEGIN thiefg1 // from:
  SAY @90 /* Back here? I told ye to scram! */
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @91 /* ~Wait! I know the password.~ */ GOTO 2
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN DO ~SetGlobalTimer("ThiefGuardWarning1","LOCALS",12)
SetGlobal("WarningGiven1","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7248")
NumTimesTalkedToGT(0)
Global("WarningGiven1","GLOBAL",2)~ THEN BEGIN thiefg2 // from:
  SAY @89 /* ~Enough with yer loiterin'! Git!~ */
  IF ~~ THEN DO ~SetGlobalTimer("ThiefGuardWarning1","LOCALS",12)
SetGlobal("WarningGiven1","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7248")
NumTimesTalkedToGT(0)
Global("WarningGiven1","GLOBAL",4)~ THEN BEGIN thiefg3 // from:
  SAY @56 /* ~Yer asking for it, fella!~ */
  IF ~~ THEN DO ~SetGlobal("AlarmShout","GLOBAL",99)
SetGlobal("Hostile","LOCALS",2)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7250")
NumTimesTalkedToGT(0)
Global("WarningGiven2","GLOBAL",5)~ THEN BEGIN thiefg4 // from:
  SAY @90 /* Back here? I told ye to scram! */
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @91 /* ~Wait! I know the password.~ */ GOTO 2
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN DO ~SetGlobalTimer("ThiefGuardWarning2","LOCALS",12)
SetGlobal("WarningGiven2","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7250")
NumTimesTalkedToGT(0)
Global("WarningGiven2","GLOBAL",2)~ THEN BEGIN thiefg5 // from:
  SAY @89 /* ~Enough with yer loiterin'! Git!~ */
  IF ~~ THEN DO ~SetGlobalTimer("ThiefGuardWarning2","LOCALS",12)
SetGlobal("WarningGiven2","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7250")
NumTimesTalkedToGT(0)
Global("WarningGiven2","GLOBAL",4)~ THEN BEGIN thiefg6 // from:
  SAY @56 /* ~Yer asking for it, fella!~ */
  IF ~~ THEN DO ~SetGlobal("AlarmShout","GLOBAL",99)
SetGlobal("Hostile","LOCALS",2)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7251")
NumTimesTalkedToGT(0)
Global("WarningGiven3","GLOBAL",5)~ THEN BEGIN thiefg7 // from:
  SAY @90 /* Back here? I told ye to scram! */
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @91 /* ~Wait! I know the password.~ */ GOTO 2
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN DO ~SetGlobalTimer("ThiefGuardWarning3","LOCALS",12)
SetGlobal("WarningGiven3","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7251")
NumTimesTalkedToGT(0)
Global("WarningGiven3","GLOBAL",2)~ THEN BEGIN thiefg8 // from:
  SAY @89 /* ~Enough with yer loiterin'! Git!~ */
  IF ~~ THEN DO ~SetGlobalTimer("ThiefGuardWarning3","LOCALS",12)
SetGlobal("WarningGiven3","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7251")
NumTimesTalkedToGT(0)
Global("WarningGiven3","GLOBAL",4)~ THEN BEGIN thiefg9 // from:
  SAY @56 /* ~Yer asking for it, fella!~ */
  IF ~~ THEN DO ~SetGlobal("AlarmShout","GLOBAL",99)
SetGlobal("Hostile","LOCALS",2)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7252")
NumTimesTalkedToGT(0)
Global("WarningGiven4","GLOBAL",5)~ THEN BEGIN thiefg10 // from:
  SAY @90 /* Back here? I told ye to scram! */
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @91 /* ~Wait! I know the password.~ */ GOTO 2
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN DO ~SetGlobalTimer("ThiefGuardWarning4","LOCALS",12)
SetGlobal("WarningGiven4","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7252")
NumTimesTalkedToGT(0)
Global("WarningGiven4","GLOBAL",2)~ THEN BEGIN thiefg11 // from:
  SAY @89 /* ~Enough with yer loiterin'! Git!~ */
  IF ~~ THEN DO ~SetGlobalTimer("ThiefGuardWarning4","LOCALS",12)
SetGlobal("WarningGiven4","GLOBAL",3)~ EXIT
END
IF WEIGHT #-1 ~AreaCheck("AR7252")
NumTimesTalkedToGT(0)
Global("WarningGiven4","GLOBAL",4)~ THEN BEGIN thiefg12 // from:
  SAY @56 /* ~Yer asking for it, fella!~ */
  IF ~~ THEN DO ~SetGlobal("AlarmShout","GLOBAL",99)
SetGlobal("Hostile","LOCALS",2)~ EXIT
END
IF ~AreaCheck("AR7250")~ THEN BEGIN thiefg13 // from:
  SAY @43 /* ~You there! What are ye doing in 'dis place? You better git outta here, 'less of course you know the password.~ */
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN REPLY @44 /* ~Password? Why would I need a password? What in the Nine Hells are you talking about?~ */ GOTO thiefg14
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @45 /* ~Ya, I know the password.~ */ GOTO thiefg15
END
IF ~~ THEN BEGIN thiefg14 // from: thiefg13.0
  SAY @46 /* ~Yer in the wrong place, fella. I'd git out while yer still able. I might not be able to stop a buncha well-armed adventurers, but if you cause any trouble in the guild, don't be expecting to walk out in one piece.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning2","LOCALS",12)
SetGlobal("WarningGiven2","GLOBAL",1)~ EXIT
END
IF ~~ THEN BEGIN thiefg15 // from: thiefg13.1
  SAY @47 /* ~Well, if you know the password, then spill it.~ */
  IF ~~ THEN REPLY @48 /* ~Darkwell~ */ GOTO thiefg16
  IF ~~ THEN REPLY @49 /* ~Ravenscar~ */ GOTO thiefg16
  IF ~~ THEN REPLY @50 /* ~Mask~ */ GOTO thiefg16
  IF ~~ THEN REPLY @51 /* ~Fafhrd~ */ GOTO 4
  IF ~~ THEN REPLY @52 /* ~Bodi~ */ GOTO thiefg16
  IF ~~ THEN REPLY @53 /* ~Mercury~ */ GOTO thiefg16
  IF ~~ THEN REPLY @54 /* ~Shadow~ */ GOTO thiefg16
END
IF ~~ THEN BEGIN thiefg16 // from: thiefg15.6 thiefg15.5 thiefg15.4 thiefg15.2 thiefg15.1 thiefg15.0
  SAY @55 /* ~Wrong answer. Git outta here fast 'fore ya get hurt.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning2","LOCALS",12)
SetGlobal("WarningGiven2","GLOBAL",3)~ EXIT
END
IF ~AreaCheck("AR7251")~ THEN BEGIN thiefg17 // from:
  SAY @43 /* ~You there! What are ye doing in 'dis place? You better git outta here, 'less of course you know the password.~ */
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN REPLY @44 /* ~Password? Why would I need a password? What in the Nine Hells are you talking about?~ */ GOTO thiefg18
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @45 /* ~Ya, I know the password.~ */ GOTO thiefg19
END
IF ~~ THEN BEGIN thiefg18 // from: thiefg17.0
  SAY @46 /* ~Yer in the wrong place, fella. I'd git out while yer still able. I might not be able to stop a buncha well-armed adventurers, but if you cause any trouble in the guild, don't be expecting to walk out in one piece.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning3","LOCALS",12)
SetGlobal("WarningGiven3","GLOBAL",1)~ EXIT
END
IF ~~ THEN BEGIN thiefg19 // from: thiefg17.1
  SAY @47 /* ~Well, if you know the password, then spill it.~ */
  IF ~~ THEN REPLY @48 /* ~Darkwell~ */ GOTO thiefg20
  IF ~~ THEN REPLY @49 /* ~Ravenscar~ */ GOTO thiefg20
  IF ~~ THEN REPLY @50 /* ~Mask~ */ GOTO thiefg20
  IF ~~ THEN REPLY @51 /* ~Fafhrd~ */ GOTO 4
  IF ~~ THEN REPLY @52 /* ~Bodi~ */ GOTO thiefg20
  IF ~~ THEN REPLY @53 /* ~Mercury~ */ GOTO thiefg20
  IF ~~ THEN REPLY @54 /* ~Shadow~ */ GOTO thiefg20
END
IF ~~ THEN BEGIN thiefg20 // from: thiefg19.6 thiefg19.5 thiefg19.4 thiefg19.2 thiefg19.1 thiefg19.0
  SAY @55 /* ~Wrong answer. Git outta here fast 'fore ya get hurt.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning3","LOCALS",12)
SetGlobal("WarningGiven3","GLOBAL",3)~ EXIT
END
IF ~AreaCheck("AR7252")~ THEN BEGIN thiefg21 // from:
  SAY @43 /* ~You there! What are ye doing in 'dis place? You better git outta here, 'less of course you know the password.~ */
  IF ~Global("KnownPassword","GLOBAL",0)~ THEN REPLY @44 /* ~Password? Why would I need a password? What in the Nine Hells are you talking about?~ */ GOTO thiefg22
  IF ~Global("KnownPassword","GLOBAL",1)~ THEN REPLY @45 /* ~Ya, I know the password.~ */ GOTO thiefg23
END
IF ~~ THEN BEGIN thiefg22 // from: thiefg21.0
  SAY @46 /* ~Yer in the wrong place, fella. I'd git out while yer still able. I might not be able to stop a buncha well-armed adventurers, but if you cause any trouble in the guild, don't be expecting to walk out in one piece.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning4","LOCALS",12)
SetGlobal("WarningGiven4","GLOBAL",1)~ EXIT
END
IF ~~ THEN BEGIN thiefg23 // from: thiefg21.1
  SAY @47 /* ~Well, if you know the password, then spill it.~ */
  IF ~~ THEN REPLY @48 /* ~Darkwell~ */ GOTO thiefg24
  IF ~~ THEN REPLY @49 /* ~Ravenscar~ */ GOTO thiefg24
  IF ~~ THEN REPLY @50 /* ~Mask~ */ GOTO thiefg24
  IF ~~ THEN REPLY @51 /* ~Fafhrd~ */ GOTO 4
  IF ~~ THEN REPLY @52 /* ~Bodi~ */ GOTO thiefg24
  IF ~~ THEN REPLY @53 /* ~Mercury~ */ GOTO thiefg24
  IF ~~ THEN REPLY @54 /* ~Shadow~ */ GOTO thiefg24
END
IF ~~ THEN BEGIN thiefg24 // from: thiefg23.6 thiefg23.5 thiefg23.4 thiefg23.2 thiefg23.1 thiefg23.0
  SAY @55 /* ~Wrong answer. Git outta here fast 'fore ya get hurt.~ */
  IF ~~ THEN DO	~SetGlobalTimer("ThiefGuardWarning4","LOCALS",12)
SetGlobal("WarningGiven4","GLOBAL",3)~ EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gthiefg.d~

<<<<<<<< stweaks-inlined/#gdenkod.d
REPLACE DENKOD
IF ~  True()~ THEN BEGIN 0 // from:
  SAY @95 /* ~What is this?! It seems like everyone's crashing in on the Thieves' Guild these days. First that huge armored guy, and now you! You better tell me what you're here about, and right quick, or you're in a lot of trouble!~ */
  IF ~Exists("BLACKL")
!Dead("BLACKL")~ THEN REPLY @96 /* ~We're tracking down Sarevok... the huge armored guy. Where did he go?~ */ GOTO 1
  IF ~Exists("BLACKL")
!Dead("BLACKL")~ THEN REPLY @97 /* ~Out of our way, thief! We have important matters to solve, and don't have time to waste on you!~ */ GOTO 2
  IF ~OR(2)!Exists("BLACKL")
Dead("BLACKL")~ THEN REPLY @96 /* ~We're tracking down Sarevok... the huge armored guy. Where did he go?~ */ GOTO denkod1
  IF ~OR(2)!Exists("BLACKL")
Dead("BLACKL")~ THEN REPLY @97 /* ~Out of our way, thief! We have important matters to solve, and don't have time to waste on you!~ */ GOTO denkod2
END
IF ~~ THEN BEGIN 1 // from: 0.0
  SAY @98 /* ~He went down the stairs right over there. He was sure in a hurry. If you're going after the guy, it'd probably be good of you to get a little more prepared than you look. Down there's the thief warrens, and they're really dangerous. Go talk to Black Lily over in the store room by the stairs. She'll give you some good prices on equipment. I even hear that she sells some magic stuff.~ */
  IF ~~ THEN EXIT
END
IF ~~ THEN BEGIN 2 // from: 0.1
  SAY @99 /* ~No need to be rude! If yer "important task" is finding that big armored guy, then he went right down the stairs to the east. He and his friend were sure in a hurry. If I were you though, I'd first stock up on equipment. Those are the thief warrens down the stairs, and they ain't no place any sane man would care to go. Go talk to Black Lily in the store room by the stairs. She has lots of items for sale, even magic if you have the money.~ */
  IF ~~ THEN EXIT
END
END

APPEND DENKOD
IF ~~ THEN BEGIN denkod1 // from: 0.2
  SAY @100 /* ~He went down the stairs right over there. He was sure in a hurry. If you're going after the guy, it'd probably be good of you to get a little more prepared than you look. Down there's the thief warrens, and they're really dangerous.~ */
  IF ~~ THEN EXIT
END
IF ~~ THEN BEGIN denkod2 // from: 0.3
  SAY @101 /* ~No need to be rude! If yer "important task" is finding that big armored guy, then he went right down the stairs to the east. He and his friend were sure in a hurry. If I were you though, I'd first stock up on equipment. Those are the thief warrens down the stairs, and they ain't no place any sane man would care to go.~ */
  IF ~~ THEN EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gdenkod.d~

<<<<<<<< stweaks-inlined/#gniklos.d
REPLACE NIKLOS
IF ~NumTimesTalkedTo(0)~ /* Triggers after states #: 9 even though they appear after this state */ THEN BEGIN 0 // from:
  SAY @60 /* ~'Ere, stop a moment. I've got a word or two ye need to hear.~ */
  IF ~~ THEN GOTO 1
END
IF ~~ THEN BEGIN 1 // from: 0.0
  SAY @61 /* ~Aye, you're a fine group o' mercenaries, are you? Leastwise that's the word on the street, that you do the odd job here an' there? I've a boss who'd like to have a word with you if you can spare the time. He don't ask fer free though, and here be 50 gold just to hear me out.~ */
  IF ~~ THEN REPLY @62 /* ~Move along, stranger. I've no time to dawdle with you.~ */ GOTO 3
  IF ~~ THEN REPLY @63 /* ~50 gold just to listen? A fair deal, lead on.~ */ DO ~GivePartyGold(50)~ GOTO 8
  IF ~~ THEN REPLY @64 /* ~50 gold may get one ear, but I've another to support as well.~ */ GOTO 2
END
IF ~~ THEN BEGIN 2 // from: 1.2
  SAY @65 /* ~The gold be a gift o' my employer. Do you not think it right rude to ask fer more without even speaking to him? No more from me, so follow or don't.~ */
  IF ~~ THEN REPLY @63 /* ~50 gold just to listen? A fair deal, lead on.~ */ DO ~GivePartyGold(50)~ GOTO 8
  IF ~~ THEN REPLY @66 /* ~Move along, stranger. I've no time to dawdle with you.~ */ GOTO 3
  IF ~~ THEN REPLY @67 /* ~I'll follow, I'll follow. No need to get snippy.~ */ DO ~GivePartyGold(50)~ GOTO 8
END
IF ~~ THEN BEGIN 3 // from: 2.1 1.0
  SAY @93 /* ~Disappointing. I'll leave you to your quiet little stroll then.~ */
  IF ~~ THEN DO ~SetGlobal("NiklosRefused","GLOBAL",1)~ EXIT
END
IF ~Global("TalkedToAlatos","GLOBAL",0)
Global("BG_AttackedThieves","GLOBAL",0)
GlobalTimerExpired("MeetAlatos","GLOBAL")~ THEN BEGIN 4 // from:
  SAY @68 /* ~Best be keeping a low profile about yourself, you tardy fool. Weren't no small insult to my boss, you taking that 50 gold and then missin' the meeting. Not a good career move to earn the ire o' the master of the thieves' guild. I'd be advising you to stay clear of any dark corners.~ */
  IF ~~ THEN DO ~SetGlobal("BG_AttackedThieves","GLOBAL",1)
MoveToPointNoInterrupt([4413.1070])
DestroySelf()~ EXIT
END
IF ~Global("NiklosRefused","GLOBAL",1)~ THEN BEGIN 5 // from:
  SAY @69 /* ~'Ere be my intrepid lay-abouts again. Have ye time enough fer a visit now?~ */
  IF ~~ THEN REPLY @70 /* ~My apologies for keeping you waiting. Lead on.~ */ DO ~GivePartyGold(50)~ GOTO 8
  IF ~~ THEN REPLY @71 /* ~I've no more interest in you now than before. Keep your 50 gold back and leave me be.~ */ GOTO 7
  IF ~~ THEN REPLY @72 /* ~Your 50 gold does indeed hire my ear, but only for a moment. Begone, lest I throw in a fist free of charge.~ */ GOTO 6
END
IF ~~ THEN BEGIN 6 // from: 5.2
  SAY @73 /* ~You're a right confusing individual, the way you invite trouble. Rest assured, you'll be hearing about this again. A friendly warning: stay out o' dark alleys.~ */
  IF ~~ THEN DO ~SetGlobal("BG_AttackedThieves","GLOBAL",1)
GivePartyGold(50)
MoveToPointNoInterrupt([1439.1313])
OpenDoor("DOOR0151")
MoveToPointNoInterrupt([1456.1262])
DestroySelf()~ SOLVED_JOURNAL @94 /* ~A job for Alatos.

A youngster named Niklos approached me on the street and gave me 50 gold just to speak with his master. I declined.~ */ EXIT
END
IF ~~ THEN BEGIN 7 // from: 5.1
  SAY @74 /* ~I'll keep the gold, but it don't mean much. Not having the courtesy to even meet with my employer is an insult he'll not soon forget. He didn't become master o' the thieves' guild by suffering ignorance from the likes of you.~ */
  IF ~~ THEN DO ~SetGlobal("BG_AttackedThieves","GLOBAL",1)
MoveToPointNoInterrupt([1439.1313])
OpenDoor("DOOR0151")
MoveToPointNoInterrupt([1456.1262])
DestroySelf()~ SOLVED_JOURNAL @94 /* ~A job for Alatos.

A youngster named Niklos approached me on the street and gave me 50 gold just to speak with his master. I declined.~ */ EXIT
END
IF ~~ THEN BEGIN 8 // from: 5.0 2.2 2.0 1.1
  SAY @58 /* ~A wise choice o' action. Now just follow me, an' I'll show ya the way ta the Guild. If yer asked the password, it's "Fafhrd." When yer in the guild, just look fer the man named Alatos "Ravenscar" Thuibuld.~ */
  IF ~~ THEN DO ~SetGlobal("KnownPassword","GLOBAL",1)
SetGlobal("ShowWay","LOCALS",1)
SetGlobalTimer("MeetAlatos","GLOBAL",THREE_HOURS)
ClearAllActions()
StartCutSceneMode()
StartCutScene("NIKCUT")~ UNSOLVED_JOURNAL @59 /* ~A job for Alatos.

A youngster named Niklos gave me 50 gold to meet with his master. I am to follow him to a nondescript building, and use "Fafhrd" as a password.~ */ EXIT
END
IF ~Global("Chapter","GLOBAL",8)
Global("BG_AttackedThieves","GLOBAL",0)~ THEN BEGIN 10 // from:
  SAY @75 /* ~'Ere there! What are you doing back in the "Gate?" Every night-walker in town be keeping a low-end profile, what with the guards putting force behind their swords. Not safe to wander; not safe at all. Alatos has gone deep under, so as not to be warmin' a bunk in the jailhouse... or worse! Lost most our number, we have. Stay if you wish, but here be no more safe than the street outside.~ */
  IF ~~ THEN DO ~MoveToPointNoInterrupt([414.669])
DestroySelf()~ EXIT
END
IF ~Global("BG_AttackedThieves","GLOBAL",1)~ THEN BEGIN 11 // from:
  SAY @76 /* ~I'd watch my shadow if I was you!~ */
  IF ~~ THEN DO ~MoveToPointNoInterrupt([4413.1070])
DestroySelf()~ EXIT
END
END
APPEND ~NIKLOS~
IF WEIGHT #-1 ~Global("BG_AttackedThieves","GLOBAL",0)
GlobalTimerNotExpired("MeetAlatos","GLOBAL")
Global("ShowWay","LOCALS",1)~ THEN BEGIN niklos1
  SAY @102 /* You'd better not keep my boss waiting... */
  IF ~~ THEN EXIT
END
END
SET_WEIGHT ~niklos~ 9 	#1
SET_WEIGHT ~niklos~ 4 	#2 
SET_WEIGHT ~niklos~ 10	#3	 
SET_WEIGHT ~niklos~ 11 	#4
SET_WEIGHT ~niklos~ 5	#5
SET_WEIGHT ~niklos~ 0	#6
>>>>>>>>
COMPILE ~stweaks-inlined/#gniklos.d~

<<<<<<<< stweaks-inlined/#gthiefm.d
REPLACE THIEFM
IF WEIGHT #0 ~  RandomNum(7,1)
~ THEN BEGIN 0 // from:
  SAY @77 /* ~Pickin' pockets ain't as profitable as it once was. It's nearly enough to drive a man to honest work.~ */
  IF ~~ THEN EXIT
END
IF WEIGHT #1 ~  RandomNum(7,2)
~ THEN BEGIN 1 // from:
  SAY @78 /* ~I got no time for your flim-flams and jawings. Leave me to my pickings.~ */
  IF ~~ THEN EXIT
END
IF WEIGHT #2 ~  RandomNum(7,3)
~ THEN BEGIN 2 // from:
  SAY @79 /* ~Locals don't have the scratch to feed my fingers like the merchants from afar. You'd think the routing banditry would have some professional courtesy for their city-sinning cousins and let a mark or two through.~ */
  IF ~~ THEN EXIT
END
IF WEIGHT #3 ~  RandomNum(7,4)
~ THEN BEGIN 3 // from:
  SAY @80 /* ~Normally I don't give the hairs on a sweet rat's patoot about local concerns, but now I canna even buy a new set of picks because of the iron shortage.~ */
  IF ~~ THEN EXIT
END
IF WEIGHT #4 ~  RandomNum(7,5)
~ THEN BEGIN 4 // from:
  SAY @81 /* ~You've an unfamiliar mug, so ye must be new to town, eh? Well, take a long walk sea-wise! T'ain't enough lootings for the sneaksmen already here, so keep yer hands in your own pockets and we'll get along just spanky dandy.~ */
  IF ~~ THEN EXIT
END
IF WEIGHT #6 /* Triggers after states #: 6 even though they appear after this state */
~  RandomNum(7,7)
~ THEN BEGIN 5 // from:
  SAY @82 /* ~I swears she dropped her purse an' I just picked it up for her! I never di... Wait a sec. You're no guard, just a nosey ne'er-do-well interrupting my pickings! Off! Lest I pin you floor-wise!~ */
  IF ~~ THEN EXIT
END
IF WEIGHT #5 ~  RandomNum(7,6)
~ THEN BEGIN 6 // from:
  SAY @83 /* ~'Ere friend, you'll put me off my game interrupting me like this. I've nothing to tell you that you can't learn for yourself, so leave me to my sneaking.~ */
  IF ~~ THEN EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gthiefm.d~

<<<<<<<< stweaks-inlined/#gthieff.d
REPLACE THIEFF
IF ~  RandomNum(5,1)
~ THEN BEGIN 0 // from:
  SAY @84 /* ~I've no interest in talkin' to the likes of you, lest you loosen the strings of your purse a bit. Then I'll be happy to chat, and to lighten the heavy load you are burdened with.~ */
  IF ~~ THEN EXIT
END
IF ~  RandomNum(5,2)
~ THEN BEGIN 1 // from:
  SAY @85 /* ~If you don't mind, I've nobles to mark and lighten.~ */
  IF ~~ THEN EXIT
END
IF ~  RandomNum(5,3)
~ THEN BEGIN 2 // from:
  SAY @86 /* ~You'll be face my fist if you get in the way of me earning my rightful take on the street today!~ */
  IF ~~ THEN EXIT
END
IF ~  RandomNum(5,4)
~ THEN BEGIN 3 // from:
  SAY @87 /* ~I've made a bit o' extra scratch from the pedestrian prey today, but I don't think I've much to say that you haven't heard before.~ */
  IF ~~ THEN EXIT
END
IF ~  RandomNum(5,5)
~ THEN BEGIN 4 // from:
  SAY @88 /* ~If you are quite through drawing attention to me, I should like to make for some shadows now. Hard to blend with an unsuspecting crowd when the likes of you come barging up.~ */
  IF ~~ THEN EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gthieff.d~

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Sensible rooms quality for BG Inns																																															    ///
/// Red Sheaf (INN3357), Feldepost's Inn (INN3351), Friendly Arm inn (FRIEND.STO), Candlekeep Inn (INN2616), Tavern (TAV0721), Splurging Sturgeon (INN0103), Blade&Star (INN0105), Helm&Cloak (INN0116), Three Old Kegs (INN0119), Elfsong Tavern (INN0705), Ulgoth's Beard Store and Inn (ULGOTH), Tavern (TAV1215), Blushing Mermaid (TAV0114), Nashkel Inn (INN4801), Burning Wizard (INN3307), Jovial Juggler (INN3304) ///
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

COPY_EXISTING 	~inn3357.sto~ 	~override~			
 WRITE_BYTE 0x5c (THIS BOR 0b00000001)	// Peasant
 WRITE_BYTE 0x5c (THIS BAND 0b11110001)	// These two lines could be chained together as: WRITE_BYTE 0x5c (THIS & 0b11110001) | 0b00000001
BUT_ONLY

COPY_EXISTING 	~tav0721.sto~ 	~override~
		~ulgoth.sto~ 	~override~
		~tav1215.sto~	~override~
		~inn4801.sto~ 	~override~
		~inn3307.sto~ 	~override~
 WRITE_BYTE 0x5c (THIS BOR 0b00000011)	// Peasant and Merchant
 WRITE_BYTE 0x5c (THIS BAND 0b11110011)
BUT_ONLY

COPY_EXISTING 	~tav0705.sto~ 	~override~
		~tav0114.sto~	~override~
		~inn3304.sto~ 	~override~
		~inn2616.sto~	~override~
 WRITE_BYTE 0x5c (THIS BOR 0b00000010)	// Merchant
 WRITE_BYTE 0x5c (THIS BAND 0b11110010)
BUT_ONLY

COPY_EXISTING 	~inn0103.sto~ 	~override~
		~inn0105.sto~ 	~override~
 WRITE_BYTE 0x5c (THIS BOR 0b00000110)	// Merchant and Noble
 WRITE_BYTE 0x5c (THIS BAND 0b11110110)
BUT_ONLY

COPY_EXISTING 	~inn3351.sto~ 	~override~
		~inn0116.sto~ 	~override~
		~inn0119.sto~ 	~override~
 WRITE_BYTE 0x5c (THIS BOR 0b00001100)	// Noble and Royal
 WRITE_BYTE 0x5c (THIS BAND 0b11111100)
BUT_ONLY

COPY_EXISTING	 ~friend.sto~ 	~override~
 WRITE_BYTE 0x5c (THIS BOR 0b00000111)	// Peasant, Merchant and Noble
 WRITE_BYTE 0x5c (THIS BAND 0b11110111)
BUT_ONLY

////////////////////////////////////////
/// Fix wrong vertices AR6527-AR6532 ///
////////////////////////////////////////

COPY_EXISTING ~AR6527.ARE~  ~override~
PATCH_IF (SOURCE_SIZE > 0x11b) BEGIN  // checking for valid ARE resource
 trignum = (0 - 1)
 READ_SHORT 0x5a trig_cnt
 READ_LONG 0x5c trig_off
    FOR (i = 0; i < trig_cnt; i += 1) BEGIN
      READ_ASCII (i * 0xc4 + trig_off) trig_name (32) NULL
      PATCH_IF (~%trig_name%~ STRING_EQUAL_CASE ~Door6500~ = 1) BEGIN
        trignum = i
      END
    END
    PATCH_IF trignum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = trignum
        STR_VAR fj_structure_type = region
      END
    END
 LPF ADD_AREA_REGION_TRIGGER 
	INT_VAR
		ab_RT_Type = 2
		ab_RT_BbLX = 171
		ab_RT_BbLY = 346
		ab_RT_BbHX = 260
		ab_RT_BbHY = 459
		ab_RT_VxPr = 6
		ab_RT_CuId = 30
		ab_RT_Vx_X_0 = 260
		ab_RT_Vx_X_1 = 171
		ab_RT_Vx_X_2 = 171
		ab_RT_Vx_X_3 = 226
		ab_RT_Vx_X_4 = 234
		ab_RT_Vx_X_5 = 260
		ab_RT_Vx_Y_0 = 363
		ab_RT_Vx_Y_1 = 346
		ab_RT_Vx_Y_2 = 459
		ab_RT_Vx_Y_3 = 459
		ab_RT_Vx_Y_4 = 459
		ab_RT_Vx_Y_5 = 418
	STR_VAR
		ab_RT_Name = "Door6500"
		ab_RT_Dest = "AR6526"
		ab_RT_EntN = "Exit6502"
 END
END
BUT_ONLY

COPY_EXISTING ~AR6528.ARE~  ~override~
PATCH_IF (SOURCE_SIZE > 0x11b) BEGIN  // checking for valid ARE resource
 trignum = (0 - 1)
 READ_SHORT 0x5a trig_cnt
 READ_LONG 0x5c trig_off
    FOR (i = 0; i < trig_cnt; i += 1) BEGIN
      READ_ASCII (i * 0xc4 + trig_off) trig_name (32) NULL
      PATCH_IF (~%trig_name%~ STRING_EQUAL_CASE ~Door6500~ = 1) BEGIN
        trignum = i
      END
    END
    PATCH_IF trignum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = trignum
        STR_VAR fj_structure_type = region
      END
    END
 LPF ADD_AREA_REGION_TRIGGER 
	INT_VAR
		ab_RT_Type = 2
		ab_RT_BbLX = 68
		ab_RT_BbLY = 275
		ab_RT_BbHX = 156
		ab_RT_BbHY = 426
		ab_RT_VxPr = 6
		ab_RT_CuId = 30
		ab_RT_Vx_X_0 = 156
		ab_RT_Vx_X_1 = 108
		ab_RT_Vx_X_2 = 77
		ab_RT_Vx_X_3 = 68
		ab_RT_Vx_X_4 = 118
		ab_RT_Vx_X_5 = 135
		ab_RT_Vx_Y_0 = 342
		ab_RT_Vx_Y_1 = 275
		ab_RT_Vx_Y_2 = 337
		ab_RT_Vx_Y_3 = 356
		ab_RT_Vx_Y_4 = 426
		ab_RT_Vx_Y_5 = 402
	STR_VAR
		ab_RT_Name = "Door6500"
		ab_RT_Dest = "AR6526"
		ab_RT_EntN = "Exit6506"
 END
END
BUT_ONLY

COPY_EXISTING ~AR6529.ARE~  ~override~
PATCH_IF (SOURCE_SIZE > 0x11b) BEGIN  // checking for valid ARE resource
 trignum = (0 - 1)
 READ_SHORT 0x5a trig_cnt
 READ_LONG 0x5c trig_off
    FOR (i = 0; i < trig_cnt; i += 1) BEGIN
      READ_ASCII (i * 0xc4 + trig_off) trig_name (32) NULL
      PATCH_IF (~%trig_name%~ STRING_EQUAL_CASE ~Door6500~ = 1) BEGIN
        trignum = i
      END
    END
    PATCH_IF trignum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = trignum
        STR_VAR fj_structure_type = region
      END
    END
 LPF ADD_AREA_REGION_TRIGGER 
	INT_VAR
		ab_RT_Type = 2
		ab_RT_BbLX = 547
		ab_RT_BbLY = 451
		ab_RT_BbHX = 680
		ab_RT_BbHY = 576
		ab_RT_VxPr = 4
		ab_RT_CuId = 30
		ab_RT_Vx_X_0 = 547
		ab_RT_Vx_X_1 = 627
		ab_RT_Vx_X_2 = 680
		ab_RT_Vx_X_3 = 600
		ab_RT_Vx_Y_0 = 500
		ab_RT_Vx_Y_1 = 451
		ab_RT_Vx_Y_2 = 520
		ab_RT_Vx_Y_3 = 576
	STR_VAR
		ab_RT_Name = "Door6500"
		ab_RT_Dest = "AR6526"
		ab_RT_EntN = "Exit6516"
 END
END
BUT_ONLY

COPY_EXISTING ~AR6529.ARE~  ~override~
PATCH_IF (SOURCE_SIZE > 0x11b) BEGIN  // checking for valid ARE resource
 trignum = (0 - 1)
 READ_SHORT 0x5a trig_cnt
 READ_LONG 0x5c trig_off
    FOR (i = 0; i < trig_cnt; i += 1) BEGIN
      READ_ASCII (i * 0xc4 + trig_off) trig_name (32) NULL
      PATCH_IF (~%trig_name%~ STRING_EQUAL_CASE ~Door6517~ = 1) BEGIN
        trignum = i
      END
    END
    PATCH_IF trignum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = trignum
        STR_VAR fj_structure_type = region
      END
    END
 LPF ADD_AREA_REGION_TRIGGER 
	INT_VAR
		ab_RT_Type = 2
		ab_RT_BbLX = 303
		ab_RT_BbLY = 199
		ab_RT_BbHX = 406
		ab_RT_BbHY = 327
		ab_RT_VxPr = 5
		ab_RT_CuId = 28
		ab_RT_Vx_X_0 = 406
		ab_RT_Vx_X_1 = 357
		ab_RT_Vx_X_2 = 303
		ab_RT_Vx_X_3 = 319
		ab_RT_Vx_X_4 = 353
		ab_RT_Vx_Y_0 = 301
		ab_RT_Vx_Y_1 = 327
		ab_RT_Vx_Y_2 = 227
		ab_RT_Vx_Y_3 = 199
		ab_RT_Vx_Y_4 = 199
	STR_VAR
		ab_RT_Name = "Door6517"
		ab_RT_Dest = "AR6530"
		ab_RT_EntN = "Exit6516"
 END
END
BUT_ONLY

COPY_EXISTING ~AR6530.ARE~  ~override~
PATCH_IF (SOURCE_SIZE > 0x11b) BEGIN  // checking for valid ARE resource
 trignum = (0 - 1)
 READ_SHORT 0x5a trig_cnt
 READ_LONG 0x5c trig_off
    FOR (i = 0; i < trig_cnt; i += 1) BEGIN
      READ_ASCII (i * 0xc4 + trig_off) trig_name (32) NULL
      PATCH_IF (~%trig_name%~ STRING_EQUAL_CASE ~Door6516~ = 1) BEGIN
        trignum = i
      END
    END
    PATCH_IF trignum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = trignum
        STR_VAR fj_structure_type = region
      END
    END
 LPF ADD_AREA_REGION_TRIGGER 
	INT_VAR
		ab_RT_Type = 2
		ab_RT_BbLX = 243
		ab_RT_BbLY = 220
		ab_RT_BbHX = 340
		ab_RT_BbHY = 313
		ab_RT_VxPr = 4
		ab_RT_CuId = 28
		ab_RT_Vx_X_0 = 309
		ab_RT_Vx_X_1 = 340
		ab_RT_Vx_X_2 = 296
		ab_RT_Vx_X_3 = 243
		ab_RT_Vx_Y_0 = 313
		ab_RT_Vx_Y_1 = 290
		ab_RT_Vx_Y_2 = 220
		ab_RT_Vx_Y_3 = 245
	STR_VAR
		ab_RT_Name = "Door6516"
		ab_RT_Dest = "AR6529"
		ab_RT_EntN = "Exit6517"
 END
END
BUT_ONLY

COPY_EXISTING ~AR6532.ARE~  ~override~
PATCH_IF (SOURCE_SIZE > 0x11b) BEGIN  // checking for valid ARE resource
 trignum = (0 - 1)
 READ_SHORT 0x5a trig_cnt
 READ_LONG 0x5c trig_off
    FOR (i = 0; i < trig_cnt; i += 1) BEGIN
      READ_ASCII (i * 0xc4 + trig_off) trig_name (32) NULL
      PATCH_IF (~%trig_name%~ STRING_EQUAL_CASE ~Door6500~ = 1) BEGIN
        trignum = i
      END
    END
    PATCH_IF trignum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = trignum
        STR_VAR fj_structure_type = region
      END
    END
 LPF ADD_AREA_REGION_TRIGGER 
	INT_VAR
		ab_RT_Type = 2
		ab_RT_BbLX = 211
		ab_RT_BbLY = 303
		ab_RT_BbHX = 291
		ab_RT_BbHY = 382
		ab_RT_VxPr = 4
		ab_RT_CuId = 30
		ab_RT_Vx_X_0 = 291
		ab_RT_Vx_X_1 = 291
		ab_RT_Vx_X_2 = 211
		ab_RT_Vx_X_3 = 211
		ab_RT_Vx_Y_0 = 323
		ab_RT_Vx_Y_1 = 382
		ab_RT_Vx_Y_2 = 382
		ab_RT_Vx_Y_3 = 303
	STR_VAR
		ab_RT_Name = "Door6500"
		ab_RT_Dest = "AR6526"
		ab_RT_EntN = "Exit6507"
 END
END
BUT_ONLY

////////////////////////////////////////
/// Korax has some duplicate actions ///
////////////////////////////////////////

<<<<<<<< stweaks-inlined/#gkorax.d
REPLACE_TRANS_ACTION ~KORAX~ BEGIN 0 END BEGIN 0 END ~Enemy()~ ~~
REPLACE_TRANS_ACTION ~KORAX~ BEGIN 0 END BEGIN 1 END ~EscapeAreaDestroy(90)~ ~~
>>>>>>>>
COMPILE ~stweaks-inlined/#gkorax.d~

///////////////////////////////////////////////
/// Give rotten potions their original look ///
///////////////////////////////////////////////

COPY_EXISTING ~potn23.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~IPOTN14~ // inventory icon
 END
BUT_ONLY

COPY_EXISTING ~potn25.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~IPOTN08~ // inventory icon
 END
BUT_ONLY

COPY_EXISTING ~potn32.itm~ ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  WRITE_ASCII 0x3a ~IPOTN20~ // inventory icon
 END
BUT_ONLY

////////////////////////////////////////////
/// Remove Noblewoman from Nashkel Manor ///
////////////////////////////////////////////

COPY_EXISTING ~%nml2%.are~ override
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    actnum = (0 - 1)
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Noblewoman~ = 1) BEGIN
        actnum = i
      END
    END
    PATCH_IF actnum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = actnum
        STR_VAR fj_structure_type = actor
      END
    END
  END
BUT_ONLY

//////////////////////////////////
/// Fix Ye Old Inn panic scene ///
//////////////////////////////////

<<<<<<<< stweaks-inlined/#gbarsl.d
REPLACE_ACTION_TEXT ~BARSLIM~ ~ActionOverride("MTWSLIM",EscapeAreaDestroy(90))~ ~MoveToPointNoInterrupt([600.465])
DestroySelf()~
REPLACE_ACTION_TEXT ~BARSLIM~ ~ActionOverride("MTWSLIM2",EscapeAreaDestroy(90))~ ~~
REPLACE_ACTION_TEXT ~BARSLIM~ ~ActionOverride("MTWSLIM3",EscapeAreaDestroy(90))~ ~~
>>>>>>>>
COMPILE ~stweaks-inlined/#gbarsl.d~

EXTEND_TOP ~ar8013.bcs~ ~stweaks/baf/ar8013a.baf~

COPY_EXISTING ~mtwslim.cre~ ~override/mtwslim.cre~
 SAY NAME1 @4
 SAY NAME2 @4
BUT_ONLY

//////////////////////////////
/// Fix Ramazith and Abela ///
//////////////////////////////

COPY ~stweaks/bcs/initdis.bcs~ override

// Dead versions of Abela 
COPY_EXISTING ~abela.cre~ ~override/abelabod.cre~
    READ_LONG 0x10 creflags
	WRITE_LONG 0x10 (creflags BOR BIT2)
	WRITE_LONG 0x20 BIT11 // Set STATE_DEAD
	WRITE_SHORT 0x24 0 // Set HP = 0
	WRITE_ASCIIE DEATHVAR	~DEAbela~ #32
	WRITE_ASCIIE DIALOG	~~ #8

COPY_EXISTING ~AR7226.ARE~ ~override~
LPF ALTER_AREA_ACTOR INT_VAR orient = 7 STR_VAR actor_name = "Abela the Nymph" END
LPF ALTER_AREA_ACTOR INT_VAR orient = 15 STR_VAR actor_name = "Ragefast"END
BUT_ONLY

COPY_EXISTING ~AR7300.ARE~ ~override~
 LPF ALTER_AREA_DOOR INT_VAR lock_difficulty = 100 door_hp = 100 STR_VAR door_name = "DOOR0137" door_script = "DR0137" door_key = "MISC68" END
BUT_ONLY

COPY_EXISTING ~AR7600.ARE~ ~override~
 LPF ALTER_AREA_DOOR INT_VAR lock_difficulty = 100 door_hp = 100 STR_VAR door_name = "DOOR0126" door_script = "DR0126" END
BUT_ONLY

COPY_EXISTING ~AR7237.BCS~ ~override~
 DECOMPILE_AND_PATCH BEGIN
 REPLACE_TEXTUALLY	~CreateCreature("RAMAZI",\[328\.234\],0)~	~CreateCreature("RAMAZI",[264.285],0)~
END
BUT_ONLY

COPY_EXISTING ~AR7238.BCS~ ~override~
 DECOMPILE_AND_PATCH BEGIN
 REPLACE_TEXTUALLY	~Global("RamazithMove","GLOBAL",2)~	~Global("RamazithMove","GLOBAL",3)~
 REPLACE_TEXTUALLY	~CreateCreature("RAMAZI",\[0\.0\],0)~	~SetGlobal("RamazithMove","GLOBAL",99)
CreateCreature("RAMAZI",[190.186],14)~
END
BUT_ONLY

EXTEND_TOP 	~AR7237.BCS~ 	~stweaks/baf/ar7237a.baf~
EXTEND_TOP 	~AR7238.BCS~ 	~stweaks/baf/ar7238a.baf~
EXTEND_TOP 	~DR0126.BCS~ 	~stweaks/baf/door0126.baf~
EXTEND_TOP 	~DR0137.BCS~ 	~stweaks/baf/door0137.baf~
EXTEND_BOTTOM 	~RAMAZITH.BCS~	~stweaks/baf/ramaz.baf~

COPY_EXISTING ~RAMAZI.CRE~ ~override~
 ADD_CRE_ITEM ~MISC68~ #0 #0 #0 ~UNDROPPABLE~ ~INV~
BUT_ONLY

COPY_EXISTING ~RAGEFA.CRE~ ~override~
 WRITE_ASCII SCRIPT_OVERRIDE ~INITDIS~
BUT_ONLY

<<<<<<<<...\inlined\#gabela.d
ADD_STATE_TRIGGER ~abela~ 5 ~GlobalLT("HelpRamazith","GLOBAL",3)~
REPLACE_ACTION_TEXT_PROCESS ~ABELA~ ~EscapeAreaDestroy(90)~ ~EraseJournalEntry(@222)
EraseJournalEntry(@223)
EraseJournalEntry(@224)
EraseJournalEntry(@225)
Kill(Myself)~
>>>>>>>>
COMPILE ~...\inlined\#gabela.d~

<<<<<<<<...\inlined\#gramazi.d
REPLACE_TRIGGER_TEXT ~RAMAZI~ ~True()~ ~Global("RamazithHome","LOCALS",3)~
REPLACE_ACTION_TEXT ~RAMAZI~ ~SetGlobal("RamazithMove","GLOBAL",1)[^!]*EscapeAreaDestroy(90)~ ~SetGlobal("RamazithMove","GLOBAL",1)
SetCursorState(TRUE)
MoveToPointNoInterrupt([3575.1463])
Face(10)
Wait(1)
OpenDoor("DOOR0137")
Wait(1)
MoveToPointNoInterrupt([3591.1427])
SetCursorState(FALSE)
DestroySelf()~
REPLACE_ACTION_TEXT ~RAMAZI~ ~TakePartyItem("MISC68")~ ~~
REPLACE_ACTION_TEXT ~RAMAZI~ ~DestroyItem("MISC68")~ ~~
REPLACE_ACTION_TEXT ~RAMAZI~ ~CreateCreature("ABELA",\[260\.170\],0)~ ~~
REPLACE_ACTION_TEXT ~RAMAZI~ ~ActionOverride("Abela",Dialog\(ue\)?(\[PC\]))~ ~SetCursorState(TRUE)
Wait(1)
SetCursorState(FALSE)
ActionOverride("Abela",Dialogue([PC]))~
REPLACE_ACTION_TEXT ~RAMAZI~ ~SetGlobal("HelpRamazith","GLOBAL",3)~ ~SetGlobalTimer("AbelaRamazith","GLOBAL",TEN_DAYS)~
REPLACE_ACTION_TEXT ~RAMAZI~ ~ForceSpell(LastTalkedToBy(Myself),WIZARD_LIGHTNING_BOLT)[^!]*SetGlobal("RamazithMove","GLOBAL",2)[^!]*EscapeAreaDestroy(90)~ ~SetCursorState(TRUE)
ForceSpell(LastTalkedToBy(Myself),WIZARD_MELF_ACID_ARROW)
Wait(2)
SetSequence(2)
CreateVisualEffectObject("SPDIMNDR",Myself)
CreateVisualEffectObject("SPDIMNDR","Abela")
Wait(2)
SetGlobal("RamazithMove","GLOBAL",2)
SetCursorState(FALSE)~
REPLACE_TRANS_ACTION ~RAMAZI~ BEGIN 15 END BEGIN 5 END ~SetGlobalTimer("Ramazith","GLOBAL",5)~ ~SetGlobal("RamazithHome","LOCALS",3)
SetGlobalTimer("Ramazith","GLOBAL",5)~
ADD_TRANS_TRIGGER ~RAMAZI~ 7 ~False()~ DO 2
ADD_TRANS_TRIGGER ~RAMAZI~ 8 ~False()~ DO 0
ADD_TRANS_ACTION ~RAMAZI~ BEGIN 14 END BEGIN 0 END ~ActionOverride("Abela",MoveToPointNoInterrupt([81.221]))
Wait(1)
ActionOverride("Abela",Face(15))
SetGlobal("HelpRamazith","GLOBAL",3)~
ADD_STATE_TRIGGER ~RAMAZI~ 15 ~Global("HelpRamazith","GLOBAL",3)~
ALTER_TRANS RAMAZI BEGIN 11 END BEGIN 0 END 
BEGIN "ACTION"
~SetCursorState(TRUE)
ForceSpell(LastTalkedToBy(Myself),WIZARD_MELF_ACID_ARROW)
Wait(1)
ForceSpell(Myself,DRYAD_TELEPORT)
Wait(2)
SetGlobal("RamazithMove","GLOBAL",2)
SetCursorState(FALSE)~
END
ALTER_TRANS RAMAZI BEGIN 14 END BEGIN 0 END 
BEGIN "EPILOGUE"
~EXIT~
END
>>>>>>>>
COMPILE ~...\inlined\#gramazi.d~

/////////////////////////////////////////////////////
/// Fix Delorna, Helshara, Ithmeera and Shandalar ///
/////////////////////////////////////////////////////

COPY_EXISTING ~%nml4%.are~ override
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    actnum = (0 - 1)
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Servant~ = 1) BEGIN
        actnum = i
      END
    END
    PATCH_IF actnum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = actnum
        STR_VAR fj_structure_type = actor
      END
    END
  END
BUT_ONLY

COPY_EXISTING ~%nml3%.are~ override
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
      LPF fj_are_structure
   	INT_VAR
   	fj_loc_x          = 537
    	fj_loc_y          = 467
    	fj_dest_x         = 537
    	fj_dest_y         = 467
    	fj_animation      = 0xC900 // peasant
    	fj_orientation    = 10     // NE
    	STR_VAR
    	fj_structure_type = actor
    	fj_name           = Servant
    	fj_cre_resref     = servan
      END
  END
BUT_ONLY

COPY_EXISTING ~AR7245.ARE~ override
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Ithmeera~ = 1) BEGIN
        WRITE_SHORT (i * 0x110 + act_off + 0x20) 548
        WRITE_SHORT (i * 0x110 + act_off + 0x22) 507
        WRITE_SHORT (i * 0x110 + act_off + 0x24) 548
        WRITE_SHORT (i * 0x110 + act_off + 0x26) 507
	WRITE_SHORT (i * 0x110 + act_off + 0x34) 7	
      END
    END
  END
BUT_ONLY

COPY_EXISTING ~delorna.bcs~ override
DECOMPILE_AND_PATCH BEGIN
REPLACE_TEXTUALLY ~Heard("Delorna",1)~ ~Heard("Ithmeera",1)~
END
BUT_ONLY

<<<<<<<< stweaks-inlined/#ghelsha.baf
IF
	Die()
THEN
	RESPONSE #100
		Shout(2)
END

IF
	Global("ITHMSURR","GLOBAL",1)
	Allegiance(Myself,ENEMY)
THEN
	RESPONSE #100
		DisplayStringHead(Myself,@40)
		ChangeEnemyAlly(Myself,NEUTRAL)
		MoveToPointNoInterrupt([417.355])
		EscapeArea()
END
>>>>>>>>
EXTEND_BOTTOM ~HELSHARA.BCS~ ~stweaks-inlined/#ghelsha.baf~

<<<<<<<< stweaks-inlined/#gdelor.baf
IF
	Die()
THEN
	RESPONSE #100
		Shout(2)
END

IF
	Global("ITHMSURR","GLOBAL",1)
	Allegiance(Myself,ENEMY)
THEN
	RESPONSE #100
		DisplayStringHead(Myself,@40)
		ChangeEnemyAlly(Myself,NEUTRAL)
		MoveToPointNoInterrupt([417.355])
		EscapeArea()
END
>>>>>>>>
EXTEND_BOTTOM ~DELORNA.BCS~ ~stweaks-inlined/#gdelor.baf~

COPY_EXISTING ~ithmeera.bcs~ override
DECOMPILE_AND_PATCH BEGIN
REPLACE_TEXTUALLY ~Heard("Helshara",2)~ ~Heard([ANYONE],2)~
REPLACE_TEXTUALLY ~\Dialog\(ue\)?(\[PC\])~ ~StartDialogueNoSet([PC])~
END
BUT_ONLY

<<<<<<<< stweaks-inlined/#githmee.d
REPLACE ITHMEE
IF ~~ THEN BEGIN 5 // from:
  SAY @15 /* ~Certainly you do not know the daughters of Shandalar, to think that gold would change our alliance!~ */
  IF ~~ THEN GOTO 4
END
IF ~Dead("Helshara")~ THEN BEGIN 6 // from:
  SAY @107 /* ~No! Monster, take the blasted trinkets! Helshara...~ */
  IF ~~ THEN DO ~SetGlobal("ITHMSURR","GLOBAL",1)
MoveToPointNoInterrupt([392.374])
Face(14)
Wait(1)
DisplayStringHead(Myself,@108)
Wait(1)
EscapeArea()~ EXIT
END
END
APPEND ~ITHMEE~
IF WEIGHT #-1 ~Dead("Delorna")~ THEN BEGIN ithmeera1
  SAY @16 /* No! Monster, take the blasted trinkets! Delorna... */
  IF ~~ THEN DO ~SetGlobal("ITHMSURR","GLOBAL",1)
MoveToPointNoInterrupt([392.374])
Face(14)
Wait(1)
DisplayStringHead(Myself,@108)
Wait(1)
EscapeArea()~ EXIT
END
END
REPLACE_TRANS_ACTION ~ithmee~ BEGIN 4 END BEGIN 0 END ~CreateCreature("GUARD",\[0.0\],0)~ ~~
ADD_TRANS_ACTION ~ithmee~ BEGIN 4 END BEGIN 0 END ~ActionOverride("DELORNA",ChangeAIScript("",0))
CreateCreature("GUARD",[440.358],14)
CreateCreature("GUARD",[414.374],14)~
>>>>>>>>
COMPILE ~stweaks-inlined/#githmee.d~

<<<<<<<< stweaks-inlined/#ghelsha.d
ADD_TRANS_ACTION ~helsha~ BEGIN 4 5 END BEGIN 0 END ~ActionOverride("DELORNA",ChangeAIScript("",0))~
>>>>>>>>
COMPILE ~stweaks-inlined/#ghelsha.d~

<<<<<<<< stweaks-inlined/#gdelorn.d
ADD_TRANS_ACTION ~delorn~ BEGIN 2 5 END BEGIN 0 END ~ActionOverride("HELSHARA",ChangeAIScript("",0))~
>>>>>>>>
COMPILE ~stweaks-inlined/#gdelorn.d~

<<<<<<<< stweaks-inlined/#gshanda.d
APPEND ~SHANDAL2~
IF WEIGHT #2 ~Global("KillDaughter","GLOBAL",1)
PartyHasItem("CLCK22")
!Dead("Ithmeera")~ THEN BEGIN shanda8
  SAY @38 /* You return. I cannot say I am totally pleased with that, but you have done me a service, nonetheless. You may live, but we are still not square and fair. Cross my path again and the death of my daughter will be the fuel that drives my anger! You wouldn't like me when I'm angry. For now, I am satisfied, but only for now. Begone. */
  IF ~~ THEN DO ~EraseJournalEntry(@18)
TakePartyItem("CLCK22")
TakePartyItem("MISC2H")
AddexperienceParty(500)
ForceSpell(Myself,DRYAD_TELEPORT)
~ SOLVED_JOURNAL @39 /* ~Retrieve Shandalar's cloak.

I retrieved Shandalar's cloak from what seemed to be an icy prison.  I certainly do not want to go back there again, as it sends chills down my spine.  I should count myself lucky that he gave me a wardstone to find my way back to Ulgoth's Beard.  I would not want to encounter him in the future, lest he enact further punishment for the death of his daughter.  I am glad to see the back of him, his cloak, and that icy prison.~ */ EXIT
END
IF WEIGHT #3 ~NumTimesTalkedTo(0)
!Dead("Ithmeera")
OR(2)
Dead("Delorna")
Dead("Helshara")~ THEN BEGIN shanda1
  SAY @17 /* I know you... oh yes, don't think I don't... You, who dare to show your face here! */
  IF ~~ THEN REPLY @19 /* ~You have me at a disadvantage, sir. You claim to know me, but I am not acquainted with you.~ */ GOTO shanda2
  IF ~~ THEN REPLY @20 /* ~You sound a little too threatening for my liking! Watch your tone, and identify yourself!~ */ GOTO shanda3
  IF ~~ THEN REPLY @21 /* ~And you would be... who, exactly? I can't say I've had the pleasure.~ */ GOTO shanda4
END
IF ~~ THEN BEGIN shanda2
  SAY @22 /* ~Spare me your false pretensions and manners, I see through them as I see through light and day! And save your disgusting innocence and ignorance! You know me well and true, though we have not met in person to personal manner. My name, most foul whelp, is Shandalar! Yes, I see the dim lights of recognition in your eyes. Like a bolt from the sky, though I get ahead of myself. You did slaughter that which I held most dear! For Shaaaaame!~ */
  IF ~~ THEN REPLY @25 /* ~Shandalar... Shandalar... no, it doesn't ring any bells for me. Perhaps if you told me what it is I'm supposed to have done?~ */ GOTO shanda4
  IF ~~ THEN REPLY @26 /* ~Shandalar, eh? If you have an accusation, make it quick! I have no tolerance for innuendo or veiled threats!~ */ GOTO shanda3
  IF ~~ THEN REPLY @27 /* ~State your case plain and save us both some time. I have done many things, your accusations fall amidst many.~ */ GOTO shanda4
END
IF ~~ THEN BEGIN shanda3
  SAY @23 /* ~I expected such bravado from you... such is the mind of they that would prove their mettle by slaughtering one simple child! You have participated in the murder of the daughter of Shandalar and, surprisingly enough, I consider that a verrrrry naughty act. What have you to say for yourself in defense? State why I should not make interesting little noisemakers from your vertebrae and sell them to bugbear children!~ */
  IF ~~ THEN REPLY @28 /* ~Your daughter was more than one "simple child." She and her sisters were in Oberon's Estate because you thought them able to defend themselves. If you did not wish to risk losing her, you should have guarded the Halruuan skyship components yourself.~ */ GOTO shanda6
  IF ~~ THEN REPLY @29 /* ~I still have no idea who you are. You must have me confused with someone else entirely. I have done nothing against you or your children. Honest.~ */ GOTO shanda5
  IF ~~ THEN REPLY @30 /* ~I shall tell you why: because it was a matter of business and nothing personal. I was hired to prevent a deal that you orchestrated, and was forced to remove the opposition.~ */ GOTO shanda7
END
IF ~~ THEN BEGIN shanda4
  SAY @24 /* ~You will not insult me so! That you cannot remember the incident is doubly infuriating! To have snuffed out the light of my life and not even recall the deed is the height of indignity! Shandalar accuses, and you WILL admit!~ */
  IF ~~ THEN REPLY @31 /* ~I grow weary of this, old man. You had best change your tone before I get angry!~ */ GOTO shanda3
  IF ~~ THEN REPLY @32 /* ~Shandalar...? Oh dear... Shandalar of Ulgoth's Beard? Shandalar that makes his home in a Halruaan skyship? Shandalar that charged his daughters to guard the components of such a skyship pending their sale? I've... uh... never heard of you... or your daughters.~ */ GOTO shanda5
  IF ~~ THEN REPLY @33 /* ~Shandalar? I know of you. You were to sell the components of a skyship and I prevented it. Granted I did so at the cost of your daughter's life, but you were the one that charged her and her sister with the task of guarding the items I sought. Why put them in harm's way if you were not prepared to lose them?~ */ GOTO shanda6
  IF ~~ THEN REPLY @34/* ~I know you. I was involved in the killing of your daughter in Baldur's Gate. Regrettable, but business is business.~ */ GOTO shanda7
END
IF ~~ THEN BEGIN shanda5
  SAY @35 /* ~Your pitiful attempts and lies are as transparent to me as the nature of existence... no wait, that's still fairly opaque... but YOU, you I see clearly for I see true! Do you really believe that one versed in magic such as I could not identify those responsible for the deaths of his children? You have a long road of repentance ahead of you, and no one is offering a ride! I send you! I send you on a pitiable errand! The means of your return will be found if you look, but do not expect the way to be easy! If you do well, I may yet decide not to invert your faces! Away, away, AWAY! And bring me back a lovely souvenir! A cloak perhaps!~ */
  IF ~~ THEN DO ~SetGlobal("KillDaughter","GLOBAL",1)
GiveItem("MISC2H",LastTalkedToBy)
ActionOverride(Player1,LeaveAreaLUAPanic("ARU008","",[553.492],12))
ActionOverride(Player1,LeaveAreaLUA("ARU008","",[553.492],12))
ActionOverride(Player2,LeaveAreaLUA("ARU008","",[512.496],12))
ActionOverride(Player3,LeaveAreaLUA("ARU008","",[473.497],12))
ActionOverride(Player4,LeaveAreaLUA("ARU008","",[441.489],12))
ActionOverride(Player5,LeaveAreaLUA("ARU008","",[398.486],12))
ActionOverride(Player6,LeaveAreaLUA("ARU008","",[354.469],12))
~ UNSOLVED_JOURNAL @18 /* ~Retrieve Shandalar's cloak.

It seems that my dealings with the Thieves' Guild have not gone unnoticed: Shandalar, who had three daughters protecting components of a skyship, has lured me into punishment for the death of one of them.  He has teleported me to a mysterious, chilly island in the middle of a desolate ocean!  Shandalar mentioned a cloak that I had to find.  Such a piece of clothing might be the key out of this accursed place.  I will have to keep my eyes peeled for it.~ */ EXIT
END
IF ~~ THEN BEGIN shanda6
  SAY @36 /* ~Your argument falls short of becoming a reason not to kill you! I suppose it is my fault and not the thief's if I am burgled in my home? After all, it is not his fault that I amassed wealth and dared to "display" it in mine home. In a mob rule you might have a chance, but I am but a mob of one! Shandalar spits at you and condemns with the same breath! You will perform a duty to me as part of penance, and if you succeed you will be a measure closer to repayment! I send you! I send you and you may not return without a lovely souvenir! A cloak perhaps!~ */
  IF ~~ THEN DO ~SetGlobal("KillDaughter","GLOBAL",1)
GiveItem("MISC2H",LastTalkedToBy)
ActionOverride(Player1,LeaveAreaLUAPanic("ARU008","",[553.492],12))
ActionOverride(Player1,LeaveAreaLUA("ARU008","",[553.492],12))
ActionOverride(Player2,LeaveAreaLUA("ARU008","",[512.496],12))
ActionOverride(Player3,LeaveAreaLUA("ARU008","",[473.497],12))
ActionOverride(Player4,LeaveAreaLUA("ARU008","",[441.489],12))
ActionOverride(Player5,LeaveAreaLUA("ARU008","",[398.486],12))
ActionOverride(Player6,LeaveAreaLUA("ARU008","",[354.469],12))
~ UNSOLVED_JOURNAL @18 /* ~Retrieve Shandalar's cloak.

It seems that my dealings with the Thieves' Guild have not gone unnoticed: Shandalar, who had three daughters protecting components of a skyship, has lured me into punishment for the death of one of them.  He has teleported me to a mysterious, chilly island in the middle of a desolate ocean!  Shandalar mentioned a cloak that I had to find.  Such a piece of clothing might be the key out of this accursed place.  I will have to keep my eyes peeled for it.~ */ EXIT
END
IF ~~ THEN BEGIN shanda7
  SAY @37 /* ~There, you see? Was that so hard to admit? I'm sure you will agree it is better to maintain a level of honesty in all of one's dealings. Now that that is out of the way, I have a task that you WILL perform. Oh, you are still to be punished, but you will have the satisfaction of knowing that you purged your conscience ahead of time. Much more rehabilitating. You are to do me a service. I will send you where you must go, and you must return with the item I need. A simple cloak is your target, but do NOT wear it! You have already abused too much of what is mine. Go now!~ */
  IF ~~ THEN DO ~SetGlobal("KillDaughter","GLOBAL",1)
GiveItem("MISC2H",LastTalkedToBy)
ActionOverride(Player1,LeaveAreaLUAPanic("ARU008","",[553.492],12))
ActionOverride(Player1,LeaveAreaLUA("ARU008","",[553.492],12))
ActionOverride(Player2,LeaveAreaLUA("ARU008","",[512.496],12))
ActionOverride(Player3,LeaveAreaLUA("ARU008","",[473.497],12))
ActionOverride(Player4,LeaveAreaLUA("ARU008","",[441.489],12))
ActionOverride(Player5,LeaveAreaLUA("ARU008","",[398.486],12))
ActionOverride(Player6,LeaveAreaLUA("ARU008","",[354.469],12))
~ UNSOLVED_JOURNAL @18 /* ~Retrieve Shandalar's cloak.

It seems that my dealings with the Thieves' Guild have not gone unnoticed: Shandalar, who had three daughters protecting components of a skyship, has lured me into punishment for the death of one of them.  He has teleported me to a mysterious, chilly island in the middle of a desolate ocean!  Shandalar mentioned a cloak that I had to find.  Such a piece of clothing might be the key out of this accursed place.  I will have to keep my eyes peeled for it.~ */ EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gshanda.d~

COPY_EXISTING ~amnscene.bcs~ ~override~
DECOMPILE_AND_PATCH BEGIN
 REPLACE_TEXTUALLY ~Wait(3)~ ~EraseJournalEntry(@18)
Wait(3)~
END
BUT_ONLY

COPY_EXISTING ~ARAM00.bcs~ ~override~
  DECOMPILE_AND_PATCH BEGIN
  REPLACE_TEXTUALLY ~ChangeEnemyAlly("BPIMOEN",GOODCUTOFF)~ ~EraseJournalEntry(@39)
ChangeEnemyAlly("BPIMOEN",GOODCUTOFF)~
END
BUT_ONLY

//////////////////////////////////////////
/// Varci/Lothander fixes/improvements ///
//////////////////////////////////////////

// Entering and leaving the Diviner's tent will require the entire party

COPY_EXISTING 	~ar7700.are~ ~override~
 LPF ALTER_AREA_REGION INT_VAR flag_party_required = 1 STR_VAR region_name = "DOOR7726" END
BUT_ONLY

COPY_EXISTING 	~ar7726.are~ ~override~
 LPF ALTER_AREA_REGION INT_VAR "flag_party_required" = 1 STR_VAR region_name = "DOOR7700" END
BUT_ONLY

// Jalantha Mistmyr Pickpocket Exploit Fix
 											
<<<<<<<< stweaks-inlined/#jalantboybodycheck.baf
IF
	!Global("BOYBODY","GLOBAL",1)
	Dead("Jalantha")
	PartyHasItem("misc54")
THEN
	RESPONSE #100
		SetGlobal("BOYBODY","GLOBAL",1)
END
>>>>>>>>
COPY_EXISTING ~ar7609.are~ ~override~
 WRITE_ASCII 0x94 ~ar7609~
 EXTEND_BOTTOM ~ar7609.bcs~ ~stweaks-inlined/#jalantboybodycheck.baf~


// Make the body in Jalantha's inventory unstealable and remove redundant INITDLG script

COPY_EXISTING ~jalant.cre~ ~override~
 READ_LONG 700 ~itm_loc~
 READ_LONG 704 ~itm_num~
 FOR (y = 0; y < %itm_num%; y = y + 1) BEGIN
  READ_ASCII %itm_loc% ~itm_name~
  PATCH_IF (~MISC54~ STRING_EQUAL_CASE ~%itm_name%~) BEGIN
   READ_LONG (%itm_loc% + 16) ~flag~
   PATCH_IF !(%flag% = 2) BEGIN
    WRITE_LONG (%itm_loc% + 16) 2
   END
  END
  SET itm_loc = (%itm_loc% + 20)
 END
 WRITE_ASCII SCRIPT_CLASS ~None~ #8
BUT_ONLY

// Varci should leave after 10 days 

<<<<<<<< stweaks-inlined/#gvarci.baf
IF
	GlobalTimerExpired("Varci","GLOBAL")
THEN
	RESPONSE #100
		ActionOverride("Varci",EscapeArea())
END
>>>>>>>>
EXTEND_BOTTOM ~ar7600.bcs~ ~stweaks-inlined/#gvarci.baf~

// Remove Varci if quest failed, initiate dialogue if successful, spawn Tremain

<<<<<<<< stweaks-inlined/#gar7617.baf
IF
	Global("TremainMove","GLOBAL",3)
	!Exists("Tremain")
	Exists("varci")
THEN
	RESPONSE #100
		ActionOverride("Varci",Dialogue([PC]))
END

IF
	Global("TremainMove","GLOBAL",6)
	!Exists("Tremain")
	Exists("varci")
THEN
	RESPONSE #100
		ActionOverride("Varci",DestroySelf())
		CreateCreature("TREMAI",[413.334],14)
		ActionOverride("Tremain",SetNumTimesTalkedTo(1))
END

IF
	Global("TremainMove","GLOBAL",99)
	!Exists("Tremain")
THEN
	RESPONSE #100
		CreateCreature("TREMAI",[413.334],14)
		ActionOverride("Tremain",SetNumTimesTalkedTo(1))
END

IF
	Global("TremainMove","GLOBAL",4)
	!Exists("varci")
THEN
	RESPONSE #100
		SetGlobal("TremainMove","GLOBAL",99)
		ActionOverride(Player1,LeaveAreaLUAPanic("AR7600","",[924.715],14)) 
		ActionOverride(Player1,LeaveAreaLUA("AR7600","",[924.715],14)) 
		ActionOverride(Player2,LeaveAreaLUA("AR7600","",[924.715],14)) 
		ActionOverride(Player3,LeaveAreaLUA("AR7600","",[924.715],14)) 
		ActionOverride(Player4,LeaveAreaLUA("AR7600","",[924.715],14)) 
		ActionOverride(Player5,LeaveAreaLUA("AR7600","",[924.715],14)) 
		ActionOverride(Player6,LeaveAreaLUA("AR7600","",[924.715],14))
END
>>>>>>>>
EXTEND_BOTTOM ~ar7617.bcs~ ~stweaks-inlined/#gar7617.baf~

<<<<<<<< stweaks-inlined/#gar7618.baf
IF
	Global("TremainMove","GLOBAL",6)
	!Exists("varci")
THEN
	RESPONSE #100
		CreateCreature("varci",[416.351],8)
		ActionOverride("varci",SetNumTimesTalkedTo(1))
END

IF
	Global("TremainMove","GLOBAL",99)
	!Exists("varci")
	!Exists("Casson")
THEN
	RESPONSE #100
		CreateCreature("varci",[416.351],13)
		ActionOverride("varci",SetNumTimesTalkedTo(1))
		CreateCreature("casson",[468.355],4)
END
>>>>>>>>
EXTEND_BOTTOM ~ar7618.bcs~ ~stweaks-inlined/#gar7618.baf~

<<<<<<<< stweaks-inlined/#gvarci.d
ADD_STATE_TRIGGER varci 9 ~Global("HelpTremain","GLOBAL",2)~
REPLACE_ACTION_TEXT varci ~EscapeArea()~ ~~
ADD_STATE_TRIGGER varci 10 ~Global("TremainMove","GLOBAL",5)~
REPLACE_ACTION_TEXT varci ~AddexperienceParty(5000)~ ~AddexperienceParty(5000) EscapeArea()~
ADD_TRANS_ACTION varci BEGIN 9 END BEGIN END ~SetGlobal("HelpTremain","GLOBAL",1) SetGlobal("HelpVarci","GLOBAL",3) ActionOverride(Player1,LeaveAreaLUAPanic("AR7600","",[924.715],14)) ActionOverride(Player1,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player2,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player3,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player4,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player5,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player6,LeaveAreaLUA("AR7600","",[924.715],14))~
ALTER_TRANS varci BEGIN 9 END BEGIN 0 END BEGIN "UNSOLVED_JOURNAL" ~@247~ END
ALTER_TRANS varci BEGIN 10 END BEGIN 0 END BEGIN "SOLVED_JOURNAL" ~@250~ END
ALTER_TRANS varci BEGIN 10 END BEGIN 0 END BEGIN "ACTION" ~SetGlobal("TremainMove","GLOBAL",6) EraseJournalEntry(@247) EraseJournalEntry(@248) EraseJournalEntry(@249) EraseJournalEntry(@251) EraseJournalEntry(@252) EraseJournalEntry(@253) ActionOverride(Player1,LeaveAreaLUAPanic("AR7600","",[924.715],14)) ActionOverride(Player1,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player2,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player3,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player4,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player5,LeaveAreaLUA("AR7600","",[924.715],14)) ActionOverride(Player6,LeaveAreaLUA("AR7600","",[924.715],14))~ END
ALTER_TRANS varci BEGIN 11 END BEGIN 0 END BEGIN "ACTION" ~SetCursorState(TRUE) SetGlobal("TremainMove","GLOBAL",4) GiveGoldForce(2000) GiveItem("SHLD07",LastTalkedToBy) AddexperienceParty(5000) EraseJournalEntry(@247) EraseJournalEntry(@248) EraseJournalEntry(@249) EraseJournalEntry(@251) EraseJournalEntry(@252) EraseJournalEntry(@253) MoveToPoint([269.267]) SetCursorState(FALSE) DestroySelf()~ END

APPEND varci
IF ~OR(2) Global("TremainMove","GLOBAL",1) PartyHasItem("MISC54") GlobalTimerNotExpired("Varci","GLOBAL")~ THEN BEGIN varcinewstate1
SAY @246
IF ~~ THEN  EXIT
END
IF ~Global("TremainMove","GLOBAL",0) GlobalGT("HelpVarci","GLOBAL",1) GlobalTimerNotExpired("Varci","GLOBAL")~ THEN BEGIN varcinewstate2
SAY @245
IF ~~ THEN  EXIT
END
IF ~Global("TremainMove","GLOBAL",0) GlobalGT("HelpVarci","GLOBAL",1) GlobalTimerExpired("Varci","GLOBAL")~ THEN BEGIN varcinewstate3
SAY @255
IF ~~ THEN  EXIT
END
IF WEIGHT #-1 ~Global("TremainMove","GLOBAL",6)~ THEN BEGIN varcinewstate4
SAY @295
IF ~~ THEN  EXIT
END
IF WEIGHT #-1 ~Global("TremainMove","GLOBAL",99)~ THEN BEGIN varcinewstate5
SAY @293
IF ~~ THEN  EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gvarci.d~

COPY_EXISTING ~TREMAI.CRE~ ~override~
 WRITE_ASCII SCRIPT_CLASS ~INITDIS~
BUT_ONLY

<<<<<<<< stweaks-inlined/#gtremai.d
REPLACE_ACTION_TEXT tremai ~ActionOverride("Casson",Dialog\(ue\)?(\[PC\]))~ ~FaceObject("Casson") ActionOverride("Casson",FaceObject("Tremain")) Wait(1) SetCursorState(FALSE) ActionOverride("Casson",StartDialogueNoSet([PC]))~
REPLACE_TRANS_ACTION tremai BEGIN 12 END BEGIN 0 END ~SetGlobal("TremainMove","GLOBAL",2)~ ~SetCursorState(TRUE) SetGlobal("TremainMove","GLOBAL",2) Face(4) ActionOverride("varci",FaceObject("Tremain")) Wait(3) SetSequence(2) Wait(1)~
REPLACE_TRANS_ACTION tremai BEGIN 12 END BEGIN 0 END ~CreateCreature("CASSON",\[413.334\],3)~ ~CreateCreature("CASSON",[413.334],0)~
ADD_STATE_TRIGGER tremai 9 ~!GlobalTimerExpired("Varci","GLOBAL") Global("HelpVarci","GLOBAL",2)~
ADD_STATE_TRIGGER tremai 10 ~GlobalTimerExpired("Varci","GLOBAL") Global("TremainMove","GLOBAL",0)~
ADD_STATE_TRIGGER tremai 11 ~!GlobalTimerExpired("Varci","GLOBAL")~
ALTER_TRANS tremai BEGIN 6 7 END BEGIN END BEGIN "ACTION" "" END
ALTER_TRANS tremai BEGIN 11 END BEGIN 0 END BEGIN "ACTION" ~SetCursorState(TRUE) TakePartyItem("MISC54") DestroyItem("MISC54") MoveToPoint([420.320]) Face(4) SetGlobal("TremainMove","GLOBAL",1) Wait(2) SetCursorState(FALSE) StartDialogueNoSet(LastTalkedToBy(Myself))~ END
ALTER_TRANS tremai BEGIN 10 END BEGIN 0 END BEGIN "EPILOGUE" ~EXIT~ END
ADD_TRANS_ACTION tremai BEGIN 0 END BEGIN 0 END ~SetGlobal("HelpVarci","GLOBAL",2)~
ADD_TRANS_ACTION tremai BEGIN 6 7 END BEGIN 0 END ~SetGlobal("HelpTremain","GLOBAL",2) ActionOverride("Varci",Dialogue([PC]))~
ADD_TRANS_ACTION tremai BEGIN 10 END BEGIN 0 END ~SetCursorState(TRUE) SetGlobal("TremainMove","GLOBAL",5) SetGlobal("HelpTremain","GLOBAL",3) TakePartyItem("MISC54") DestroyItem("MISC54") MoveToPointNoInterrupt([353.353]) MoveToPointNoInterrupt([269.267]) SetCursorState(FALSE) ActionOverride("Varci",Dialogue([PC])) DestroySelf()~

APPEND tremai
IF ~!PartyHasItem("MISC54") !Dead("Varci") OR(2) Global("HelpVarci","GLOBAL",3) Global("TremainMove","GLOBAL",6)~ THEN BEGIN tremainewstate1
SAY @244
IF ~~ THEN  EXIT
END
IF WEIGHT #-1 ~Global("TremainMove","GLOBAL",99)~ THEN BEGIN tremainewstate2
SAY @292
IF ~~ THEN  EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gtremai.d~

<<<<<<<< stweaks-inlined/#gcasson.d
REPLACE_TRANS_ACTION casson BEGIN 4 END BEGIN 0 END ~ActionOverride("Tremain",MoveToPoint(\[486.465\]))~ ~SetCursorState(TRUE)~
REPLACE_TRANS_ACTION casson BEGIN 4 END BEGIN 0 END ~ActionOverride("Tremain",DestroySelf())~ ~~
REPLACE_TRANS_ACTION casson BEGIN 4 END BEGIN 0 END ~DestroySelf()~ ~~ 
REPLACE_TRANS_ACTION casson BEGIN 4 END BEGIN 0 END ~MoveToPoint(\[486.465\])~ ~MoveToPoint([353.353]) MoveToPoint([269.267]) ActionOverride("Tremain",MoveToPoint([353.353])) ActionOverride("Tremain",MoveToPoint([269.267])) ActionOverride("Tremain",DestroySelf()) SetCursorState(FALSE) DestroySelf()~

APPEND casson
IF WEIGHT #-1 ~Global("TremainMove","GLOBAL",99)~ THEN BEGIN cassonnewstate
SAY @294
IF ~~ THEN  EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gcasson.d~

// Changes the way the quest works. You now have to pick up the antidote to be cured.  Before you just had to initiate dialogue with Merak which makes no sense.
// This also gives the option to pickpocket the anitiote from Marek.

COMPILE		~stweaks\baf\marcut.baf~
COMPILE		~stweaks\baf\marcut01.baf~
COMPILE		~stweaks\baf\marcut02.baf~
COMPILE		~stweaks\baf\marcut03.baf~
COMPILE		~stweaks\baf\marcut05.baf~
COMPILE		~stweaks\baf\marcut06.baf~
COMPILE		~stweaks\baf\marcut07.baf~
COMPILE		~stweaks\baf\marcut08.baf~
COMPILE		~stweaks\baf\marcut10.baf~
COMPILE		~stweaks\baf\marcut11.baf~
COMPILE		~stweaks\baf\marcut12.baf~
COMPILE		~stweaks\baf\marcut13.baf~
COMPILE		~stweaks\baf\marcut15.baf~
COMPILE		~stweaks\baf\marcut16.baf~
COMPILE		~stweaks\baf\marcut18.baf~
COMPILE		~stweaks\baf\marcut19.baf~
COMPILE		~stweaks\baf\marcut20.baf~
COMPILE		~stweaks\baf\marcut21.baf~
COMPILE		~stweaks\baf\marcut22.baf~
COMPILE		~stweaks\baf\marcut23.baf~
COMPILE		~stweaks\baf\marcut24.baf~
COMPILE		~stweaks\baf\marcut25.baf~
COMPILE		~stweaks\baf\marcut26.baf~
COMPILE		~stweaks\baf\marcut27.baf~
COMPILE		~stweaks\baf\marcut28.baf~
COMPILE		~stweaks\baf\marcut29.baf~
COMPILE		~stweaks\baf\marcut30.baf~
COMPILE		~stweaks\baf\marcut31.baf~
COMPILE		~stweaks\baf\marcut32.baf~
COMPILE		~stweaks\baf\marcut33.baf~
COMPILE		~stweaks\baf\marcut34.baf~
COMPILE		~stweaks\baf\marcut35.baf~
 
COPY ~stweaks/spl/#gclear.spl~ override

<<<<<<<< stweaks-inlined/#gpickpocket.baf
IF
	StateCheck("Marek",STATE_CHARMED)
	GlobalLT("PartyCured","GLOBAL",7)
	HasItem("POTN47","Marek")
THEN
	RESPONSE #100
		SetInterrupt(FALSE)
		SetGlobal("PartyCured","GLOBAL",7)
		ClearAllActions()
		ActionOverride("Marek",ReallyForceSpellRES("#GCLEAR",Myself))
		ChangeEnemyAlly("Marek",NEUTRAL)
		ActionOverride("Marek",CreateItem("POTN47",10,0,0))
		ActionOverride("Marek",Dialogue([PC]))
		SetInterrupt(TRUE)
END

IF
	Global("PartyCured","GLOBAL",2)
THEN
	RESPONSE #100
		SetCursorState(TRUE)
		SetGlobal("PartyCured","GLOBAL",3)
		ActionOverride("Marek",SetSequence(2))
		ActionOverride("Marek",ReallyForceSpell(Myself,WIZARD_TRUE_SIGHT))
		ActionOverride("Marek",DisplayStringHead(Myself,@299))
		Wait(1)
		SetCursorState(FALSE)
END

IF
	Global("PartyCured","GLOBAL",0)
	PartyHasItem("LOPOTN20")
	PartyHasItem("POTN47")
THEN
	RESPONSE #100
		SetGlobal("PartyCured","GLOBAL",2)
END

IF
	Global("PartyCured","GLOBAL",3)
	CombatCounter(0)
	PartyHasItem("POTN47")
	OR(2)
	 !Exists("Marek")
	 Dead("Marek")
	!StateCheck(Player1,STATE_CONFUSED)
	!StateCheck(Player2,STATE_CONFUSED)
	!StateCheck(Player3,STATE_CONFUSED)
	!StateCheck(Player4,STATE_CONFUSED)
	!StateCheck(Player5,STATE_CONFUSED)
	!StateCheck(Player6,STATE_CONFUSED)
	!StateCheck(Player1,STATE_BERSERK)
	!StateCheck(Player2,STATE_BERSERK)
	!StateCheck(Player3,STATE_BERSERK)
	!StateCheck(Player4,STATE_BERSERK)
	!StateCheck(Player5,STATE_BERSERK)
	!StateCheck(Player6,STATE_BERSERK)
	!StateCheck(Player1,STATE_PANIC)
	!StateCheck(Player2,STATE_PANIC)
	!StateCheck(Player3,STATE_PANIC)
	!StateCheck(Player4,STATE_PANIC)
	!StateCheck(Player5,STATE_PANIC)
	!StateCheck(Player6,STATE_PANIC)
	!StateCheck(Player1,STATE_STUNNED)
	!StateCheck(Player2,STATE_STUNNED)
	!StateCheck(Player3,STATE_STUNNED)
	!StateCheck(Player4,STATE_STUNNED)
	!StateCheck(Player5,STATE_STUNNED)
	!StateCheck(Player6,STATE_STUNNED)
	!StateCheck(Player1,STATE_HELPLESS)
	!StateCheck(Player2,STATE_HELPLESS)
	!StateCheck(Player3,STATE_HELPLESS)
	!StateCheck(Player4,STATE_HELPLESS)
	!StateCheck(Player5,STATE_HELPLESS)
	!StateCheck(Player6,STATE_HELPLESS)
THEN
	RESPONSE #100
		SetGlobal("PartyCured","GLOBAL",4)
		TakePartyItem("LOPOTN20")
END

IF
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player2)
THEN
	RESPONSE #100
		ActionOverride(Player2,GiveItem("POTN47",Player1))
END

IF
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player3)
THEN
	RESPONSE #100
		ActionOverride(Player3,GiveItem("POTN47",Player1))
END

IF
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player4)
THEN
	RESPONSE #100
		ActionOverride(Player4,GiveItem("POTN47",Player1))
END

IF
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player5)
THEN
	RESPONSE #100
		ActionOverride(Player5,GiveItem("POTN47",Player1))
END

IF
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player6)
THEN
	RESPONSE #100
		ActionOverride(Player6,GiveItem("POTN47",Player1))
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut")
END

IF
	NumInParty(1)									
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut02")
END

IF
	NumInParty(2)									
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)
	!StateCheck(Player2,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut01")
END

IF
	NumInParty(2)									
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)
	StateCheck(Player2,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut02")
END

IF
	NumInParty(3)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut03")
END

IF
	NumInParty(3)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut01")
END

IF
	NumInParty(3)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut05")
END

IF
	NumInParty(3)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut02")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut06")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut03")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut07")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut01")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut08")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut05")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut10")
END

IF
	NumInParty(4)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut02")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut11")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut06")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut12")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut03")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut13")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut07")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut15")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut01")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut16")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut08")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut18")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut05")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut19")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut10")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut20")
END

IF
	NumInParty(5)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut02")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut11")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut21")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut06")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut22")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut12")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut23")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut03")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut24")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut13")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut13")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut07")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut26")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut15")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut27")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	!StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut01")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut28")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut16")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut29")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut08")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut30")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut19")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut31")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	!StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut10")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut32")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut20")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut33")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut02")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut34")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	!StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut18")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	!StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut35")
END

IF
	NumInParty(6)	
	Global("PartyCured","GLOBAL",4)
	HasItem("POTN47",Player1)								
	StateCheck(Player2,STATE_DEAD)
	!StateCheck(Player3,STATE_DEAD)
	StateCheck(Player4,STATE_DEAD)
	StateCheck(Player5,STATE_DEAD)
	StateCheck(Player6,STATE_DEAD)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("marcut05")
END

IF
	Global("PartyCured","GLOBAL",5)
	!Dead("Marek")
	HasItem("POTN47",Player1)
THEN
	RESPONSE #100
		AddJournalEntry(@238,QUEST_DONE)
		EraseJournalEntry(@231)
		EraseJournalEntry(@232)
		EraseJournalEntry(@233)
		EraseJournalEntry(@234)
		EraseJournalEntry(@235)
		EraseJournalEntry(@236)
		EraseJournalEntry(@237)
		EraseJournalEntry(@298)
		AddexperienceParty(10000)
		ActionOverride(Player1,DisplayString(Myself,20675))
		SetGlobal("PartyCured","GLOBAL",1)
		SetGlobal("MarekMove","GLOBAL",2)
END

IF
	Global("PartyCured","GLOBAL",5)
	Dead("Marek")
	HasItem("POTN47",Player1)
THEN
	RESPONSE #100
		AddJournalEntry(@241,QUEST_DONE)
		EraseJournalEntry(@231)
		EraseJournalEntry(@232)
		EraseJournalEntry(@233)
		EraseJournalEntry(@234)
		EraseJournalEntry(@235)
		EraseJournalEntry(@236)
		EraseJournalEntry(@237)
		EraseJournalEntry(@298)
		AddexperienceParty(10000)
		ActionOverride(Player1,DisplayString(Myself,20675))
		SetGlobal("PartyCured","GLOBAL",1)
		SetGlobal("MarekMove","GLOBAL",2)
END
>>>>>>>>
EXTEND_BOTTOM ~ar7215.bcs~ ~stweaks-inlined/#gpickpocket.baf~

// Added Lothander to initiate dialogue once the player left the divine tent.
							
<<<<<<<< stweaks-inlined/#ginitiatedivine.baf
IF
	Global("HelpLothander","GLOBAL",1)
	OR(2)
	 Global("LothanderMove","GLOBAL",4)
	 Global("LothanderMove","GLOBAL",9)
THEN
	RESPONSE #100
		ActionOverride("Lothander",Dialogue([PC]))
END
>>>>>>>>
EXTEND_BOTTOM ~ar7700.bcs~ ~stweaks-inlined/#ginitiatedivine.baf~

// Fixed a problem with the Devine not checking the amount of gold the player had.
						
<<<<<<<< stweaks-inlined/#gdivine.d
ADD_TRANS_TRIGGER divine 0 ~PartyGoldGT(49)~ DO 1
REPLACE_TRANS_TRIGGER divine BEGIN 1 END BEGIN 2 END ~Global("HelpLothander","GLOBAL",1)~ ~GlobalGT("HelpLothander","GLOBAL",0)~
ADD_TRANS_ACTION divine BEGIN 2 3 4 5 6 7 9 END BEGIN END ~SetGlobal("HelpLothander","GLOBAL",1)~
ADD_TRANS_ACTION divine BEGIN 9 END BEGIN END ~SetGlobal("LothanderMove","GLOBAL",9)~
>>>>>>>>
COMPILE ~stweaks-inlined/#gdivine.d~

// Creates a new unique potion for Lothander  

COPY_EXISTING ~POTN20.itm~ ~override/LOPOTN20.itm~
  SAY 0x0c @226
  SAY 0x54 @227
  PATCH_IF (%SOURCE_SIZE% > 0x70) BEGIN 
   WRITE_SHORT 0x1c 0 // Item Type
   WRITE_SHORT 0x34 0 // Price
   WRITE_SHORT 0x38 1 // Stack Amount
  END
BUT_ONLY_IF_IT_CHANGES

// Removes "Item Ability" from the new unique antidote

DEFINE_PATCH_FUNCTION delete_ability BEGIN
  PATCH_IF BUFFER_LENGTH > 0x71 BEGIN
    READ_ASCII 0x0 sig (3)
    PATCH_IF "%sig%" STRING_MATCHES_REGEXP "SPL\|ITM" = 0 BEGIN
      al = "%sig%" STRING_EQUAL_CASE spl ? 0x28 : 0x38
      READ_LONG  0x64 ao
      READ_SHORT 0x68 na
      READ_LONG  0x6a eo
      FOR (i = na - 1; i >= 0; --i) BEGIN
        READ_SHORT ao + al*i + 0x1e ne
        READ_SHORT ao + al*i + 0x20 ei
        FOR (j = ne - 1; j >= 0; --j) BEGIN
          DELETE_BYTES eo + 0x30*(ei + j) 0x30
        END
        DELETE_BYTES ao + al*i al
        --na
        eo -= al
      END
      WRITE_SHORT 0x68 na
      WRITE_LONG  0x6a eo
    END ELSE PATCH_PRINT "Unsupporetd file type"
  END ELSE PATCH_PRINT "File below minimum size"
END

COPY_EXISTING LOPOTN20.itm override
LPF delete_ability END
BUT_ONLY_IF_IT_CHANGES

// Removes the regular anitote potion and make Lothander's inventory unstealable

COPY_EXISTING ~lothan.cre~ ~override~
  REMOVE_CRE_ITEM ~POTN20~
  SPRINT item_to_change "SW1H08"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS
  SPRINT item_to_change "POTN02"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS 
  SPRINT item_to_change "MISC39"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS 
  SPRINT item_to_change "BOLT01"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS
  SPRINT item_to_change "XBOW04"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS
  ADD_KNOWN_SPELL 	~SPCL412~ #0 ~innate~
  ADD_MEMORIZED_SPELL 	~SPCL412~ #0 ~innate~ (3)
  WRITE_BYTE 0x45 20
  WRITE_BYTE 0x65 90
  WRITE_BYTE 0x67 20
  WRITE_BYTE 0x68 80
  WRITE_BYTE 0x69 10
  WRITE_BYTE 0x6a 10
  WRITE_ASCII SCRIPT_OVERRIDE	~LOTHAN~	#8
  WRITE_ASCII SCRIPT_DEFAULT	~NONE~		#8
  LPF ADD_CRE_EFFECT INT_VAR opcode = 300 timing = 1 target = 0 parameter2 = 1 END
BUT_ONLY_IF_IT_CHANGES

// Make possible to pickpocket and charm Lothander for his half of the antidote too
COPY_EXISTING ~ar7206.bcs~ ~override~
 DECOMPILE_BCS_TO_BAF
  REPLACE_TEXTUALLY ~ActionOverride("Lothander",SetNumTimesTalkedTo(1))~ ~ActionOverride("Lothander",SetNumTimesTalkedTo(1))
GiveItemCreate("LOPOTN20","Lothander",0,0,0)~
 COMPILE_BAF_TO_BCS
BUT_ONLY

<<<<<<<< stweaks-inlined/#gar7206.baf
IF
	Global("MarekMove","GLOBAL",0)
	!HasItem("LOPOTN20","Lothander")
	PartyHasItem("LOPOTN20")
	Exists("Lothander")
	!Dead("Lothander")
THEN
	RESPONSE #100
		SetGlobal("MarekMove","GLOBAL",1)
		SetGlobal("LothanderMove","GLOBAL",5)
		AddJournalEntry(@298,QUEST) 
		TakePartyItem("SCRLJALA")
END

IF
	Global("PartyCured","GLOBAL",1)
	Exists("Lothander")
	!Dead("Lothander")
THEN
	RESPONSE #100
		ActionOverride("Lothander",DestroySelf())
END

IF
	!Global("LothanderMove","GLOBAL",5)
	PartyHasItem("LOPOTN20")
	Dead("Lothander")
THEN
	RESPONSE #100
		SetGlobal("LothanderMove","GLOBAL",5)
		AddJournalEntry(@298,QUEST)
		TakePartyItem("SCRLJALA")
END
>>>>>>>>
EXTEND_BOTTOM ~ar7206.bcs~ ~stweaks-inlined/#gar7206.baf~

<<<<<<<< stweaks-inlined/#glothan.d
REPLACE_TRIGGER_TEXT lothan ~SetGlobal(~ ~Global(~ 
REPLACE_ACTION_TEXT lothan ~GiveItem("POTN20",LastTalkedToBy)~ ~GiveItem("LOPOTN20",LastTalkedToBy(Myself))~
REPLACE_ACTION_TEXT lothan ~MoveToPoint(\[2571.876\])~ ~MoveToPoint([2571.876]) Face(1)~

APPEND ~lothan~
IF WEIGHT #-1 ~StateCheck(Myself,STATE_CHARMED)~ THEN BEGIN lothannewstate1
SAY @297
IF ~~ THEN DO ~AddexperienceParty(1500) TakePartyItem("SCRLJALA") GiveItem("LOPOTN20",LastTalkedToBy(Myself)) SetGlobal("MarekMove","GLOBAL",1) SetGlobal("LothanderMove","GLOBAL",5) EscapeAreaDestroy(90)~ UNSOLVED_JOURNAL @235 /* ~Find an antidote for poison.

Lothander has given us half of the antidote. He told us that the other half is possessed by Marek, who stays at the Blushing Mermaid.~ */ EXIT
END
IF WEIGHT #-1 ~!HasItem("LOPOTN20",Myself) Global("LothanderMove","GLOBAL",5)~ THEN BEGIN lothannewstate2
SAY @302
IF ~~ THEN DO ~SetGlobal("LothanderSneakAttack","GLOBAL",1) CreateItem("potn10",1,0,0) UseItem("potn10",Myself) Enemy()~ EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#glothan.d~

COMPILE		~stweaks\baf\lothcut.baf~

<<<<<<<< stweaks/baf/#glothan.baf
IF
	AttackedBy([GOODCUTOFF],DEFAULT)
	Allegiance(Myself,NEUTRAL)
THEN
	RESPONSE #100
		Enemy()
END

/* Debug
IF
	Die()
THEN
	RESPONSE #100
		DisplayStringHeadDead(Myself,@135)
		Continue()
END

// INVISIBLE: YES OR NO?

IF
	Global("Hidden","LOCALS",0)
	StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobal("Hidden","LOCALS",1)
		DisplayStringHead(Myself,@131)
END

IF
	Global("Hidden","LOCALS",1)
	!StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobal("Hidden","LOCALS",0)
		DisplayStringHead(Myself,@132)
END

*/

// ATTACKED IN AR7700

IF
	AreaCheck("AR7700")
	Allegiance(Myself,ENEMY)
THEN
	RESPONSE #100
		SetCursorState(TRUE)
		ClearAllActions()
		SetGlobal("LothanderMove","GLOBAL",8)
		ChangeEnemyAlly(Myself,NEUTRAL)
		DisplayStringHead(Myself,@303)
		Wait(2)
		MoveToPointNoInterrupt([1597.5])
		SetCursorState(FALSE)
		DestroySelf()
END

// ATTACKED IN AR7206

IF
	AreaCheck("AR7206")
	Allegiance(Myself,ENEMY)
	OR(2)
	 !HasItem("LOPOTN20","Lothander")
	 !PartyHasItem("LOPOTN20")
	Global("LothanderSneakAttack","GLOBAL",0)
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",1)
		DisplayStringHead(Myself,@296)
		CreateItem("potn10",1,0,0)
		UseItem("potn10",Myself)
END

// SEMI CUTSCENE

IF
	Global("LothanderSneakAttack","GLOBAL",1)
	See(NearestEnemyOf(Myself))
	StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",2)
//DEBUG		DisplayStringHead(Myself,@140)
		EquipMostDamagingMelee()
		AttackReevaluate(NearestEnemyOf(Myself),90)
END

IF
	OR(2)
	 Global("LothanderSneakAttack","GLOBAL",1)
	 Global("LothanderSneakAttack","GLOBAL",2)
	!StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",3)
END

IF
	Global("LothanderSneakAttack","GLOBAL",1)
	!See(NearestEnemyOf(Myself))
	StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",3)
END

// GLOBAL 3

IF
	Global("LothanderSneakAttack","GLOBAL",3)
THEN
	RESPONSE #100
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("LOTHCUT")
END

// GLOBAL 9

IF
	Global("LothanderSneakAttack","GLOBAL",9)
THEN
	RESPONSE #25
		SetGlobal("LothanderSneakAttack","GLOBAL",4)
		MoveBetweenAreas("AR8200",[47.1098],10)
//DEBUG		DisplayStringHead(Myself,@141)
	RESPONSE #25
		SetGlobal("LothanderSneakAttack","GLOBAL",4)
		MoveBetweenAreas("AR8200",[648.654],2)
//DEBUG		DisplayStringHead(Myself,@142)
	RESPONSE #25
		SetGlobal("LothanderSneakAttack","GLOBAL",4)
		MoveBetweenAreas("AR8200",[687.1063],6)
//DEBUG		DisplayStringHead(Myself,@143)
	RESPONSE #25
		SetGlobal("LothanderSneakAttack","GLOBAL",4)
		MoveBetweenAreas("AR8200",[267.1323],8)
//DEBUG		DisplayStringHead(Myself,@144)
END

// GLOBAL 4

// NO ENEMY IN SIGHT, TRAP AVAILABLE AND NOT PLACED, I AM NOT INVISIBLE	-> 	PLACE TRAP & CHANGE TO GLOBAL 5

IF
	Global("LothanderSneakAttack","GLOBAL",4)
	Global("LothTrap","LOCALS",0)
	!StateCheck(Myself,STATE_INVISIBLE)
	HaveSpell(4412)
	!TriggerOverride(Player1,See("Lothander"))
	!TriggerOverride(Player2,See("Lothander"))
	!TriggerOverride(Player3,See("Lothander"))
	!TriggerOverride(Player4,See("Lothander"))
	!TriggerOverride(Player5,See("Lothander"))
	!TriggerOverride(Player6,See("Lothander"))
	!See(NearestEnemyOf(Myself))
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",5)
		SetGlobal("LothTrap","LOCALS",1)
		SetGlobalTimer("LothTrapTimer","LOCALS",18)
//DEBUG		DisplayStringHead(Myself,@130)
		RemoveSpell(4412)
		SpellNoDec(Myself,4411)
END

// NO ENEMY IN SIGHT, TRAP NOT AVAILABLE / TRAP PLACED, I AM NOT INVISIBLE	->	HIDE

IF
	Global("LothanderSneakAttack","GLOBAL",4)
	!GlobalTimerNotExpired("LothHide","LOCALS")
	!StateCheck(Myself,STATE_INVISIBLE)
	!See(NearestEnemyOf(Myself))
	!TriggerOverride(Player1,See("Lothander"))
	!TriggerOverride(Player2,See("Lothander"))
	!TriggerOverride(Player3,See("Lothander"))
	!TriggerOverride(Player4,See("Lothander"))
	!TriggerOverride(Player5,See("Lothander"))
	!TriggerOverride(Player6,See("Lothander"))
THEN
	RESPONSE #100
        	SetGlobalTimer("LothHide","LOCALS",6)
//DEBUG		DisplayStringHead(Myself,@129)
		Hide()
END

// ENEMY IN SIGHT, I AM NOT INVISIBLE, MELEE RANGE / NO AMMO			->	RANDOM WALK

IF
	Global("LothanderSneakAttack","GLOBAL",4)
	!StateCheck(Myself,STATE_INVISIBLE)
	See(NearestEnemyOf(Myself))
	OR(2)
	 Range(NearestEnemyOf(Myself),15)
	 !HasItemEquiped("BOLT01",Myself)
THEN
	RESPONSE #100
//DEBUG		DisplayStringHead(Myself,@139)
		RandomWalkContinuous()
END

// ENEMY IN SIGHT, I AM NOT INVISIBLE, XBOW RANGE WITH AMMO			->	ATTACK (XBOW)

IF
	Global("LothanderSneakAttack","GLOBAL",4)
	!StateCheck(Myself,STATE_INVISIBLE)
	See(NearestEnemyOf(Myself))
	LOS(NearestEnemyOf(Myself),30)
	HasItemEquiped("BOLT01",Myself)
THEN
	RESPONSE #100
//DEBUG		DisplayStringHead(Myself,@134)
		EquipRanged()
		AttackReevaluate(NearestEnemyOf(Myself),30)
END

// ENEMY IN SIGHT, I AM INVISIBLE						->	ATTACK (SWORD)

IF
	Global("LothanderSneakAttack","GLOBAL",4)
	StateCheck(Myself,STATE_INVISIBLE)
	See(NearestEnemyOf(Myself))
THEN
	RESPONSE #100
//DEBUG		DisplayStringHead(Myself,@140)
		EquipMostDamagingMelee()
		AttackReevaluate(NearestEnemyOf(Myself),90)
END

// NO ENEMY IN SIGHT, TRAP NOT AVAILABLE / TRAP PLACED, I AM INVISIBLE	->	CHANGE TO GLOBAL 5

IF
	Global("LothanderSneakAttack","GLOBAL",4)
	!See(NearestEnemyOf(Myself))
	StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",5)
//DEBUG		DisplayStringHead(Myself,@146)
END

// GLOBAL 4/5 & 5
// NO ENEMY IN SIGHT, TRAP ACTIVATED							->	RESET TRAP AND CHANGE TO GLOBAL 4

IF
	GlobalGT("LothanderSneakAttack","GLOBAL",3)					
	Global("LothTrap","LOCALS",1)
	!See(NearestEnemyOf(Myself))
	OR(7)
	 TriggerOverride(Player1,AttackedBy("Lothander",DEFAULT))
	 TriggerOverride(Player2,AttackedBy("Lothander",DEFAULT))
	 TriggerOverride(Player3,AttackedBy("Lothander",DEFAULT))
	 TriggerOverride(Player4,AttackedBy("Lothander",DEFAULT))
	 TriggerOverride(Player5,AttackedBy("Lothander",DEFAULT))
	 TriggerOverride(Player6,AttackedBy("Lothander",DEFAULT))
	 GlobalTimerExpired("LothTrapTimer","LOCALS")
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",4)
		SetGlobal("LothTrap","LOCALS",0)
//DEBUG		DisplayStringHead(Myself,@147)
END

// NO ENEMY IN SIGHT, TRAP PLACED/NO TRAPS LEFT AND I AM NOT INVISIBLE			->	CHANGE TO GLOBAL 4

IF
	Global("LothanderSneakAttack","GLOBAL",5)
	!StateCheck(Myself,STATE_INVISIBLE)
	!See(NearestEnemyOf(Myself))
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",4)
//DEBUG		DisplayStringHead(Myself,@145)
END

// NO ENEMY IN SIGHT, TRAP PLACED/NO TRAPS LEFT AND I AM INVISIBLE			->	RUN SCRIPT UNTIL CONDITIONS CHANGE

IF
	Global("LothanderSneakAttack","GLOBAL",5)
	StateCheck(Myself,STATE_INVISIBLE)
	!See(NearestEnemyOf(Myself))
	!GlobalTimerNotExpired("LothIdle","LOCALS")
THEN
	RESPONSE #80
//DEBUG		DisplayStringHead(Myself,@136)
		RandomWalk()
	RESPONSE #20
		SetGlobalTimer("LothIdle","LOCALS",6)
//DEBUG		DisplayStringHead(Myself,@133)
		NoAction()
END

// ENEMY IN SIGHT									->	CHANGE TO GLOBAL 4

IF
	Global("LothanderSneakAttack","GLOBAL",5)
	See(NearestEnemyOf(Myself))
THEN
	RESPONSE #100
		SetGlobal("LothanderSneakAttack","GLOBAL",4)
//DEBUG		DisplayStringHead(Myself,@145)
END
>>>>>>>>
EXTEND_TOP 	~LOTHAN.BCS~	~stweaks/baf/#glothan.baf~

// Prevent charm and pickpocket when you first encounter Marek - this can cause the quest to break if you obtain it early.

COPY_EXISTING ~marek.cre~ ~override~
  REMOVE_CRE_ITEM ~POTN47~
  ADD_CRE_ITEM ~RING95~ #0 #0 #0 ~unstealable&undroppable~ ~LRING~
  SPRINT item_to_change "AROW01"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS 
  SPRINT item_to_change "DAGG03"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS 
  SPRINT item_to_change "BOW08"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS 
  SPRINT item_to_change "POTN45"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS
  SPRINT item_to_change "POTN36"
  SPRINT flags "unstealable"
  LPM
  ADD_CRE_ITEM_FLAGS
  REPLACE_CRE_ITEM		~BRAC01~	#0 	#0 	#0 	~NONE~ 	~GLOVES~	EQUIP
  WRITE_ASCII SCRIPT_OVERRIDE	~MAREK~	#8
 BUT_ONLY

COPY_EXISTING ~ar7215.bcs~ ~override~
 DECOMPILE_BCS_TO_BAF
  REPLACE_TEXTUALLY ~Global("MarekMove","GLOBAL",1)~ ~Global("PartyCured","GLOBAL",0) PartyHasItem("LOPOTN20")~
  REPLACE_TEXTUALLY ~ActionOverride("Marek",SetNumTimesTalkedTo(1))~ ~~
  REPLACE_TEXTUALLY ~CreateCreature("MAREK",\[406.344\],0)~ ~CreateCreature("MAREK",[406.344],0)
ActionOverride("Marek",CreateItem("POTN47",10,0,0))
ActionOverride("Marek",DestroyItem("RING95"))
ActionOverride("Marek",ChangeAIScript("INITDIS",CLASS))~
 COMPILE_BAF_TO_BCS
BUT_ONLY

// Fixes a few mistakes with Marek's dialogue plus enables another way to complete the quest - by charming him - his dialogue states he is giving you the antidote but didn't. 

<<<<<<<< stweaks-inlined/#gmarek.d
ADD_STATE_TRIGGER ~marek~ 6 ~Global("PartyCured","GLOBAL",3)~
REPLACE_ACTION_TEXT ~marek~ ~DisplayString("Marek",20675)~ ~~
REPLACE_ACTION_TEXT ~marek~ ~SetGlobal("PartyCured","GLOBAL",1)~ ~SetGlobal("PartyCured","GLOBAL",3)~
REPLACE_ACTION_TEXT_PROCESS marek ~AddexperienceParty(10000)~ ~EraseJournalEntry(@231) EraseJournalEntry(@298)~
ADD_TRANS_ACTION ~marek~ BEGIN 6 END BEGIN END ~Enemy()~
ADD_TRANS_ACTION ~marek~ BEGIN 5 END BEGIN END ~GiveItem("POTN47",LastTrigger) ChangeEnemyAlly(Myself,NEUTRAL)~
REPLACE_STATE_TRIGGER ~marek~ 0 ~Global("LothanderMove","GLOBAL",0)~
REPLACE_STATE_TRIGGER ~marek~ 5 ~HasItem("POTN47","Marek") OR(2) StateCheck(Myself,STATE_CHARMED) Global("PartyCured","GLOBAL",7)~
REPLACE_TRANS_ACTION ~marek~ BEGIN 4 END BEGIN 0 END ~EraseJournal[^!]*Enemy()~ ~Enemy()~
ALTER_TRANS ~marek~ BEGIN 4 END BEGIN 0 END BEGIN "SOLVED_JOURNAL" "" END
ALTER_TRANS ~marek~ BEGIN 5 END BEGIN 0 END BEGIN "SOLVED_JOURNAL" "@238" END
SET_WEIGHT ~marek~ 5 	#0 
SET_WEIGHT ~marek~ 6 	#1
SET_WEIGHT ~marek~ 0 	#2 
SET_WEIGHT ~marek~ 4 	#3

APPEND ~marek~
IF WEIGHT #-1 ~Global("PartyCured","GLOBAL",6)~ THEN BEGIN mareknewstate
SAY @301
IF ~~ THEN DO ~SetGlobal("PartyCured","GLOBAL",3) Enemy()~ EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gmarek.d~

<<<<<<<< stweaks/baf/#gmarek.baf
IF
	Global("PartyCured","GLOBAL",0)
	PickPocketFailed([PC])
THEN
	RESPONSE #100
		SetGlobal("PartyCured","GLOBAL",6)
		StartDialogueNoSet(LastTrigger)
END
>>>>>>>>
EXTEND_TOP 	~MAREK.BCS~	~stweaks/baf/#gmarek.baf~

// Activate party flag and prevent Marek from leaving this area -- If he can leave then the quest will fail

COPY_EXISTING 	~ar7214.are~ ~override~
 LPF ALTER_AREA_REGION INT_VAR flag_party_required = 1 STR_VAR region_name = "DOOR7215" END
BUT_ONLY
						
COPY_EXISTING ~ar7215.are~ ~override~
 READ_SHORT 0x005a ~regionnum~
 READ_LONG 0x005c ~regionoff~
 FOR (x1=0;x1<%regionnum%;x1+=1) BEGIN
  READ_ASCII (%regionoff% + (0xc4*%x1%)) ~regionname~ 
  PATCH_IF (~Door7214~ STRING_EQUAL_CASE ~%regionname%~) BEGIN
   READ_LONG (%regionoff% + (0xc4*%x1%)+0x0060) ~flags~
   WRITE_LONG (%regionoff% + (0xc4*%x1%)+0x0060) (%flags% BOR 0b1000000000)
  END
 END
 LPF ALTER_AREA_REGION INT_VAR flag_party_required = 1 STR_VAR region_name = "DOOR7214" END
BUT_ONLY

// Gives Pumberl and "Script Name"  -- required for Lothan's new dialogue and a different script for Pumberl

COPY_EXISTING ~pumberl.cre~ ~override~
 WRITE_EVALUATED_ASCII 0x280 ~pumberl~
BUT_ONLY

// Ensures Chanthalas actually takes 500 gold

<<<<<<<< stweaks-inlined/#gchanth.d
ADD_TRANS_ACTION ~chanth~ BEGIN 5 END BEGIN 0 END ~TakePartyGold(500)~
>>>>>>>>
COMPILE ~stweaks-inlined/#gchanth.d~

COMPILE ~stweaks/d/lothan.d~

//////////////////////////////////////////////////////////////////////////////////////////////////////////
/// Give Valen&C a proper name and remove enemy state from statues and add missing trigger to Felonius ///
//////////////////////////////////////////////////////////////////////////////////////////////////////////

<<<<<<<< stweaks-inlined/#gfelon.d
ADD_TRANS_TRIGGER feloni 0 ~PartyGoldGT(299)~ DO 2
>>>>>>>>
COMPILE ~stweaks-inlined/#gfelon.d~

EXTEND_TOP 	~AR7719.BCS~ 	~stweaks/baf/ar7719a.baf~

//////////////////////////////////////////////
/// Change Petrine animation to non static ///
//////////////////////////////////////////////

COPY_EXISTING ~petrin.cre~ override
  WRITE_LONG 0x28 50960
BUT_ONLY

////////////////////////////
/// Add trigger to Garan ///
////////////////////////////

<<<<<<<< stweaks-inlined/#ggaran.d
ADD_TRANS_TRIGGER ~garan~ 0 ~Global("KillDaughter","GLOBAL",1)~ DO 3
>>>>>>>>
COMPILE ~stweaks-inlined/#ggaran.d~

////////////////////////////////////////////////
/// Give XP for avoiding fight with Tel-Anon ///
////////////////////////////////////////////////

<<<<<<<< stweaks-inlined/#gtelan.d
REPLACE_TRANS_ACTION ~telano~ BEGIN 9 END BEGIN 0 END ~EscapeAreaDestroy(90)~
~AddexperienceParty(600)
EscapeAreaDestroy(90)~
>>>>>>>>
COMPILE ~stweaks-inlined/#gtelan.d~

////////////////////////////////////////////////////
/// Change Class for attacking group in Beregost ///
////////////////////////////////////////////////////

COPY_EXISTING ~merc.cre~ override
  WRITE_BYTE 0x273 2
BUT_ONLY

<<<<<<<< stweaks-inlined/#galain.d
REPLACE_TRANS_ACTION ~MTBE9~ BEGIN 2 END BEGIN 0 END ~CreateCreature("MERC",\[457.334\],0)~
~CreateCreature("MERC",[457.334],0)
EscapeArea()~
>>>>>>>>
COMPILE ~stweaks-inlined/#galain.d~

//////////////////////////////////////////////
/// Make Brielbara leave, not turn hostile ///
//////////////////////////////////////////////

<<<<<<<< stweaks-inlined/#gbriel.d
REPLACE_ACTION_TEXT ~BRIELB~ ~Enemy()~ ~MoveToPointNoInterrupt([856.499])
DestroySelf()~
>>>>>>>>
COMPILE ~stweaks-inlined/#gbriel.d~

/////////////////////////////////////////////////
/// Fix Menda's global variable not being set ///
/////////////////////////////////////////////////

<<<<<<<< stweaks-inlined/#gmenda1.d
ADD_TRANS_ACTION ~MENDA1~ BEGIN 0 END BEGIN 1 2 END ~SetGlobal("MetMendas","GLOBAL",1)~
>>>>>>>>
COMPILE ~stweaks-inlined/#gmenda1.d~

//////////////////////////////////////
/// Reduce Noober's dialogue limit ///
//////////////////////////////////////

<<<<<<<< stweaks-inlined/#gnoob.d
REPLACE_TRIGGER_TEXT ~noober~ ~NumTimesTalkedToLT(31)~ ~NumTimesTalkedToLT(15)~
REPLACE_TRIGGER_TEXT ~noober~ ~NumberOfTimesTalkedTo(31)~ ~NumberOfTimesTalkedTo(15)~
>>>>>>>>
COMPILE ~stweaks-inlined/#gnoob.d~

/////////////////////////////////////////////////////////////////
/// Parties with evil members should have a chance of leaving ///
/////////////////////////////////////////////////////////////////
<<<<<<<< stweaks-inlined/#gphanda.d
REPLACE PHANDA
IF ~  NumberOfTimesTalkedTo(0)
InParty([0.0.0.0.0.0.MASK_EVIL])
See([PC.0.0.0.0.0.MASK_EVIL])
~ THEN BEGIN 0 // from:
  SAY @5 /* ~I sense malevolence in your company, stranger. I cannot let any evil character stay here and threaten the good patrons of this inn. Leave now or prepare to fight!~ */
  IF ~~ THEN DO ~SetNumTimesTalkedTo(0)
Wait(12)
Attack([0.0.0.0.0.0.MASK_EVIL])
~ JOURNAL @6 /* ~Evil deeds go punished.

My party has been confronted by Phandalyn, an over-vigilant paladin loitering in one of Baldur's Gate's many seedy taverns. Mental note: when one depends on a party of evil, steer clear of muscle-bound paladins.~ */ EXIT
END
END

REPLACE_TRIGGER_TEXT ~phanda~ ~False()~ ~True()~
>>>>>>>>
COMPILE ~stweaks-inlined/#gphanda.d~

COPY_EXISTING ~ARAM00.bcs~ ~override~
  DECOMPILE_AND_PATCH BEGIN
  REPLACE_TEXTUALLY ~ChangeEnemyAlly("BPIMOEN",GOODCUTOFF)~ ~EraseJournalEntry(@6)
ChangeEnemyAlly("BPIMOEN",GOODCUTOFF)~
END
BUT_ONLY

///////////////////////////////////////////////////////
/// Tanya, the fishermen and the quest for the body ///
///////////////////////////////////////////////////////

<<<<<<<< stweaks-inlined/#gsonn.d
REPLACE_ACTION_TEXT ~sonner~ ~SetGlobal("HostileFishermen","GLOBAL",1)~ ~~
>>>>>>>>
COMPILE ~stweaks-inlined/#gsonn.d~ // The fishermen shouldn't turn hostile

COPY_EXISTING JEBADO.CRE override
	      SONNER.CRE override   
	      TELMEN.CRE override  
/* Change alignment to Neutral Evil 035 */
WRITE_BYTE 0x27b 35
BUT_ONLY

COPY_EXISTING ~TENYA.CRE~ ~override/TENYA.CRE~
REMOVE_MEMORIZED_SPELL ~SPPR105~
ADD_MEMORIZED_SPELL ~SPPR102~ #1 ~priest~
REMOVE_KNOWN_SPELL ~SPPR105~
ADD_KNOWN_SPELL ~SPPR102~ #1 ~priest~
BUT_ONLY

<<<<<<<< .../Fisher754-inlined/FisherDialog.D
/****** SONNER ******/
EXTEND_TOP SONNER 4
  IF ~Global("TenyaStory","GLOBAL",1)~ THEN REPLY @210 /* ~The child has said that you killed her mother and have been taking far too much from the seas. I don't like being used, Sonner. It makes me... angry.~ */ EXTERN ~TELMAN~ 6
END
ALTER_TRANS SONNER 
	BEGIN 8 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~SetGlobal("HelpJebadoh","GLOBAL",3)
			EraseJournalEntry(@200)
			EraseJournalEntry(@201)
			EraseJournalEntry(@202)
			EraseJournalEntry(@203)
			EraseJournalEntry(@204)
			EraseJournalEntry(@205)
			EraseJournalEntry(@206)
			EraseJournalEntry(@207)
			EraseJournalEntry(@208)~
	END
	
ALTER_TRANS SONNER
	BEGIN 10 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~SetGlobal("HelpJebadoh","GLOBAL",3)
			EraseJournalEntry(@200)
			EraseJournalEntry(@201)
			EraseJournalEntry(@202)
			EraseJournalEntry(@203)
			EraseJournalEntry(@204)
			EraseJournalEntry(@205)
			EraseJournalEntry(@206)
			EraseJournalEntry(@207)
			EraseJournalEntry(@208)~
	END
	
ALTER_TRANS SONNER
	BEGIN 13 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~SetGlobal("HelpJebadoh","GLOBAL",3)
			EraseJournalEntry(@200)
			EraseJournalEntry(@201)
			EraseJournalEntry(@202)
			EraseJournalEntry(@203)
			EraseJournalEntry(@204)
			EraseJournalEntry(@205)
			EraseJournalEntry(@206)
			EraseJournalEntry(@207)
			EraseJournalEntry(@208)~
	END
	
ALTER_TRANS SONNER
	BEGIN 14 END
	BEGIN 1 END
	BEGIN
		"TRIGGER" ~Global("HelpJebadoh","GLOBAL",1)~
	END

EXTEND_BOTTOM SONNER 14
  IF ~~ THEN REPLY @211 /* ~You will die for your trickery!~ */ DO ~SetGlobal("HostileFishermen","GLOBAL",1)~ EXIT
END

ALTER_TRANS SONNER
	BEGIN 17 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~SetGlobal("HelpJebadoh","GLOBAL",3)~
	END
	
ALTER_TRANS SONNER
	BEGIN 18 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~GivePartyGoldGlobal("FisherPrice","GLOBAL")
			AddexperienceParty(1000)
			GiveItem("BLUN03",[PC])
			ActionOverride("Telman",EscapeArea())
			ActionOverride("Jebadoh",EscapeArea())
			EscapeArea()
			EraseJournalEntry(@201)
			EraseJournalEntry(@202)
			EraseJournalEntry(@203)
			EraseJournalEntry(@204)
			EraseJournalEntry(@205)
			EraseJournalEntry(@206)
			EraseJournalEntry(@207)
			EraseJournalEntry(@208)~ 
		"SOLVED_JOURNAL" ~@200~
	END
	
APPEND SONNER
	IF WEIGHT #6 ~Global("TenyaStory","GLOBAL",1)~ THEN BEGIN 27 // from:
	SAY @209  /* ~You again?~ */
	IF ~~ THEN REPLY @210 /* ~The child has said that you killed her mother and have been taking far too much from the seas. I don't like being used, Sonner. It makes me... angry.~ */ EXTERN ~TELMAN~ 6
	END
END

/****** JEBADO ******/
REPLACE_STATE_TRIGGER JEBADO 10 ~Global("HelpJebadoh","GLOBAL",2)~
ALTER_TRANS JEBADO 
	BEGIN 7 END 
	BEGIN 0 END
	BEGIN
		"ACTION" ~~
		"EPILOGUE" ~EXTERN SONNER 7~
	END
APPEND JEBADO 
	IF WEIGHT #7 ~Global("TenyaStory","GLOBAL",1)
	~ THEN BEGIN 12 // from:
	SAY @209  /* ~You again?~ */
	IF ~~ THEN EXTERN ~SONNER~ 27
	END
END

/****** TELMAN ******/

APPEND TELMAN
	IF WEIGHT #6 ~Global("TenyaStory","GLOBAL",1)
	~ THEN BEGIN 15 // from:
	  SAY @209  /* ~You again?~ */
	  IF ~~ THEN EXTERN ~SONNER~ 27
	END
END

/****** TENYA ******/
ALTER_TRANS TENYA
	BEGIN 2 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~GiveItemCreate("minhp1","TENYA",0,0,0)
				ActionOverride("TENYA",FillSlot(SLOT_AMULET))
				Enemy()~
	END
ALTER_TRANS TENYA
	BEGIN 5 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~SetGlobal("TenyaHit","GLOBAL",2)
			ChangeEnemyAlly(Myself,NEUTRAL)
			ClearAllActions()
			ActionOverride(Player1,ClearAllActions())
			ActionOverride(Player2,ClearAllActions())
			ActionOverride(Player3,ClearAllActions())
			ActionOverride(Player4,ClearAllActions())
			ActionOverride(Player5,ClearAllActions())
			ActionOverride(Player6,ClearAllActions())
			SetGlobal("TenyaStory","GLOBAL",1)~
	END
ALTER_TRANS TENYA
	BEGIN 5 END
	BEGIN 1 END
	BEGIN
		"ACTION" ~SetGlobal("TenyaHit","GLOBAL",2)
			ChangeEnemyAlly(Myself,NEUTRAL)
			ClearAllActions()
			SetGlobal("TenyaStory","GLOBAL",1)
			EraseJournalEntry(@200)
			EraseJournalEntry(@201)
			EraseJournalEntry(@202)
			EraseJournalEntry(@203)
			EraseJournalEntry(@204)
			EraseJournalEntry(@205)
			EraseJournalEntry(@206)
			EraseJournalEntry(@207)
			EraseJournalEntry(@208)~
	END

ALTER_TRANS TENYA
	BEGIN 10 END
	BEGIN 0 END
	BEGIN
		"ACTION" ~SetGlobal("HelpTenya","GLOBAL",2)
			TakePartyItem("MISC53")
			AddexperienceParty(1000)
			SetGlobal("TalkedToTenya","GLOBAL",1)
			ForceSpell(Myself,DRYAD_TELEPORT)
			SetGlobal("HelpJebadoh","GLOBAL",3)
			EraseJournalEntry(@200)
			EraseJournalEntry(@201)
			EraseJournalEntry(@202)
			EraseJournalEntry(@203)
			EraseJournalEntry(@204)
			EraseJournalEntry(@205)
			EraseJournalEntry(@206)
			EraseJournalEntry(@207)
			EraseJournalEntry(@208)~
	END
	
ALTER_TRANS TENYA
	BEGIN 16 END
	BEGIN 0 END
	BEGIN
		"EPILOGUE" ~GOTO 13~
	END
>>>>>>>>
COMPILE ~.../Fisher754-inlined/FisherDialog.D~


<<<<<<<< .../Fisher754-inlined/TENYA1.baf
IF
	See(NearestEnemyOf(Myself))
	HaveSpell(CLERIC_COMMAND)
	!StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
	!StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
THEN
	RESPONSE #100
		Spell(NearestEnemyOf(Myself),CLERIC_COMMAND)
END
>>>>>>>>

COPY_EXISTING ~TENYA.bcs~  ~override/TENYA.bcs~          
DECOMPILE_AND_PATCH BEGIN
REPLACE_TEXTUALLY CASE_SENSITIVE EXACT_MATCH ~SetGlobal("TenyaHit","GLOBAL",1)~ ~SetGlobal("TenyaHit","GLOBAL",1) DestroyItem("minhp1")~
APPEND_FILE ~.../Fisher754-inlined/TENYA1.baf~
END

////////////////////////////////
// WaterQueen House revision ///
////////////////////////////////

/// STORE \\\

/*COPY 	~stweaks/sto/tem0003.sto~ 	~override~
    SAY 0xc @283

COPY	~stweaks/itm/gwebowl.itm~ 	~override~
    SAY 0x8   @287
    SAY 0xc   @287
    SAY 0x54  @288

COPY	~stweaks/itm/umbamul.itm~ 	~override~
    SAY 0x8   @289
    SAY 0xc   @289
    SAY 0x54  @290

COPY	~stweaks/cre/elwatg02.cre~ 	~override~
COPY	~stweaks/eff/sumgrwat.eff~ 	~override~
COPY	~stweaks/bam2/umbneck.bam~ 	~override~
 
/// CREATURES \\\



COPY 	~stweaks/bcs/pumber.bcs~ ~override~

COPY_EXISTING ~pumber2.cre~ ~override\pumber3.cre~
COPY_EXISTING ~pumber2.cre~ ~override\pumber4.cre~
COPY_EXISTING ~pumber2.cre~ ~override\pumber5.cre~
COPY_EXISTING ~pumber2.cre~ ~override\pumber6.cre~

COPY_EXISTING ~pumber.bcs~ ~override\pumber2.bcs~
COPY_EXISTING ~pumber.bcs~ ~override\pumber3.bcs~
COPY_EXISTING ~pumber.bcs~ ~override\pumber4.bcs~
COPY_EXISTING ~pumber.bcs~ ~override\pumber5.bcs~
COPY_EXISTING ~pumber.bcs~ ~override\pumber6.bcs~

COPY_EXISTING ~pumberl.cre~ ~override~
 WRITE_BYTE 0x2d 60
 WRITE_BYTE 0x2e 60
 WRITE_BYTE 0x30 59
 WRITE_ASCII SCRIPT_CLASS ~pumber~ #8
 WRITE_ASCII SCRIPT_DEFAULT ~wtasight~ #8
 REPLACE_CRE_ITEM		~CHAN01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~BLUN02~	#0 	#0 	#0 	~NONE~ 	~WEAPON~	EQUIP
 REMOVE_KNOWN_SPELL		~SPPR208~
 REMOVE_MEMORIZED_SPELL		~SPPR208~
 ADD_KNOWN_SPELL 		~SPPR102~ 	#0 	~priest~
 ADD_KNOWN_SPELL 		~SPPR208~ 	#1 	~priest~
 ADD_MEMORIZED_SPELL		~SPPR102~	#0 	~priest~	(2)
 ADD_MEMORIZED_SPELL		~SPPR208~	#1 	~priest~	(1)
BUT_ONLY

COPY_EXISTING ~pumber2.cre~ ~override~
 WRITE_EVALUATED_ASCII 0x280 ~pumber2~
 WRITE_ASCII SCRIPT_CLASS ~pumber2~ #8
 WRITE_ASCII SCRIPT_GENERAL ~None~ #8
 WRITE_ASCII SCRIPT_DEFAULT ~wtasight~ #8
 REPLACE_CRE_ITEM		~LEAT01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~BLUN04~	#0 	#0 	#0 	~NONE~ 	~WEAPON~	EQUIP
 REPLACE_CRE_ITEM		~SHLD01~	#0 	#0 	#0 	~NONE~ 	~SHIELD~	EQUIP
 REMOVE_KNOWN_SPELL		~SPPR208~
 REMOVE_MEMORIZED_SPELL		~SPPR208~
 ADD_KNOWN_SPELL 		~SPPR102~ 	#0 	~priest~
 ADD_KNOWN_SPELL 		~SPPR208~ 	#1 	~priest~
 ADD_MEMORIZED_SPELL		~SPPR102~	#0 	~priest~	(2)
 ADD_MEMORIZED_SPELL		~SPPR208~	#1 	~priest~	(1)
BUT_ONLY

COPY_EXISTING ~pumber3.cre~ ~override~
 WRITE_EVALUATED_ASCII 0x280 ~pumber3~
 WRITE_ASCII SCRIPT_CLASS ~pumber3~ #8
 WRITE_ASCII SCRIPT_GENERAL ~None~ #8
 WRITE_ASCII SCRIPT_DEFAULT ~wtasight~ #8
 REPLACE_CRE_ITEM		~LEAT01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~BLUN04~	#0 	#0 	#0 	~NONE~ 	~WEAPON~	EQUIP
 REPLACE_CRE_ITEM		~SHLD01~	#0 	#0 	#0 	~NONE~ 	~SHIELD~	EQUIP
 REMOVE_KNOWN_SPELL		~SPPR208~
 REMOVE_MEMORIZED_SPELL		~SPPR208~
 ADD_KNOWN_SPELL 		~SPPR102~ 	#0 	~priest~
 ADD_KNOWN_SPELL 		~SPPR208~ 	#1 	~priest~
 ADD_MEMORIZED_SPELL		~SPPR102~	#0 	~priest~	(2)
 ADD_MEMORIZED_SPELL		~SPPR208~	#1 	~priest~	(1)
BUT_ONLY

COPY_EXISTING ~pumber4.cre~ ~override~
 WRITE_EVALUATED_ASCII 0x280 ~pumber4~
 WRITE_ASCII SCRIPT_CLASS ~pumber4~ #8
 WRITE_ASCII SCRIPT_GENERAL ~None~ #8
 WRITE_ASCII SCRIPT_DEFAULT ~wtasight~ #8
 REPLACE_CRE_ITEM		~LEAT01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~BLUN04~	#0 	#0 	#0 	~NONE~ 	~WEAPON~	EQUIP
 REPLACE_CRE_ITEM		~SHLD01~	#0 	#0 	#0 	~NONE~ 	~SHIELD~	EQUIP
 REMOVE_KNOWN_SPELL		~SPPR208~
 REMOVE_MEMORIZED_SPELL		~SPPR208~
 ADD_KNOWN_SPELL 		~SPPR102~ 	#0 	~priest~
 ADD_KNOWN_SPELL 		~SPPR208~ 	#1 	~priest~
 ADD_MEMORIZED_SPELL		~SPPR102~	#0 	~priest~	(2)
 ADD_MEMORIZED_SPELL		~SPPR208~	#1 	~priest~	(1)
BUT_ONLY

COPY_EXISTING ~pumber5.cre~ ~override~
 WRITE_EVALUATED_ASCII 0x280 ~pumber5~
 WRITE_ASCII SCRIPT_CLASS ~pumber5~ #8
 WRITE_ASCII SCRIPT_GENERAL ~None~ #8
 WRITE_ASCII SCRIPT_DEFAULT ~wtasight~ #8
 REPLACE_CRE_ITEM		~LEAT01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~BLUN04~	#0 	#0 	#0 	~NONE~ 	~WEAPON~	EQUIP
 REPLACE_CRE_ITEM		~SHLD01~	#0 	#0 	#0 	~NONE~ 	~SHIELD~	EQUIP
 REMOVE_KNOWN_SPELL		~SPPR208~
 REMOVE_MEMORIZED_SPELL		~SPPR208~
 ADD_KNOWN_SPELL 		~SPPR102~ 	#0 	~priest~
 ADD_KNOWN_SPELL 		~SPPR208~ 	#1 	~priest~
 ADD_MEMORIZED_SPELL		~SPPR102~	#0 	~priest~	(2)
 ADD_MEMORIZED_SPELL		~SPPR208~	#1 	~priest~	(1)
BUT_ONLY

COPY_EXISTING ~pumber6.cre~ ~override~
 WRITE_EVALUATED_ASCII 0x280 ~pumber6~
 WRITE_ASCII SCRIPT_CLASS ~pumber6~ #8
 WRITE_ASCII SCRIPT_GENERAL ~None~ #8
 WRITE_ASCII SCRIPT_DEFAULT ~wtasight~ #8
 REPLACE_CRE_ITEM		~LEAT01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~BLUN04~	#0 	#0 	#0 	~NONE~ 	~WEAPON~	EQUIP
 REPLACE_CRE_ITEM		~SHLD01~	#0 	#0 	#0 	~NONE~ 	~SHIELD~	EQUIP
 REMOVE_KNOWN_SPELL		~SPPR208~
 REMOVE_MEMORIZED_SPELL		~SPPR208~
 ADD_KNOWN_SPELL 		~SPPR102~ 	#0 	~priest~
 ADD_KNOWN_SPELL 		~SPPR208~ 	#1 	~priest~
 ADD_MEMORIZED_SPELL		~SPPR102~	#0 	~priest~	(2)
 ADD_MEMORIZED_SPELL		~SPPR208~	#1 	~priest~	(1)
BUT_ONLY

COPY_EXISTING ~jalant.cre~ ~override~
 WRITE_ASCII SCRIPT_OVERRIDE ~jalant~ #8
 WRITE_ASCII SCRIPT_CLASS ~shout~ #8
 WRITE_ASCII SCRIPT_GENERAL ~None~ #8
 WRITE_ASCII SCRIPT_DEFAULT ~wtasight~ #8
 REPLACE_CRE_ITEM		~HELM01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~PLAT01~	#0 	#0 	#0 	~NONE~ 	~ARMOR~		EQUIP
 REPLACE_CRE_ITEM		~BLUN07~	#0 	#0 	#0 	~NONE~ 	~WEAPON~	EQUIP
 REPLACE_CRE_ITEM		~SHLD03~	#0 	#0 	#0 	~NONE~ 	~SHIELD~	EQUIP
BUT_ONLY

COPY_EXISTING ~tenya.cre~ ~override~
	      ~tenya2.cre~ ~override~
 WRITE_BYTE 0x2c 57
 WRITE_BYTE 0x2d 58
 WRITE_BYTE 0x2e 58
 WRITE_BYTE 0x30 18
 WRITE_BYTE 0x32 19
 SAY INITIAL_MEETING ~Umberlee guides my way.~ [TENYA02]	// TENYA01 makes sense only when meeting her the first time
BUT_ONLY

/// AREAS \\\

// Entering and leaving the Water Queen House will require the entire party

COPY_EXISTING 	~ar8100.are~ ~override~
 LPF ALTER_AREA_REGION INT_VAR flag_party_required = 1 STR_VAR region_name = "DOOR7609" END
BUT_ONLY

COPY_EXISTING 	~ar7609.are~ ~override~
 LPF ALTER_AREA_REGION INT_VAR "flag_party_required" = 1 STR_VAR region_name = "DOOR8100" END
BUT_ONLY

// Temple of Umberlee adjustments

COPY_EXISTING ~ar7609.are~ ~override~
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    actnum = (0 - 1)
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = (act_cnt - 1); i >= 0; i -= 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Priest of Umberlee~ = 1) BEGIN
        actnum = i
      END
      PATCH_IF actnum >= 0 BEGIN
        LAUNCH_PATCH_FUNCTION fj_are_structure
          INT_VAR fj_delete_mode = actnum
          STR_VAR fj_structure_type = actor
        END
      END
    END
  END
BUT_ONLY

COPY_EXISTING ~ar7609.are~ ~override~
 READ_SHORT 0x005a ~regionnum~
 READ_LONG 0x005c ~regionoff~
 FOR (x1=0;x1<%regionnum%;x1+=1) BEGIN
  READ_ASCII (%regionoff% + (0xc4*%x1%)) ~regionname~ 
  PATCH_IF (~Door8100~ STRING_EQUAL_CASE ~%regionname%~) BEGIN
   READ_LONG (%regionoff% + (0xc4*%x1%)+0x0060) ~flags~
   WRITE_LONG (%regionoff% + (0xc4*%x1%)+0x0060) (%flags% BOR 0b1000000000)
  END
 END
 LPF fj_are_structure
   	INT_VAR
   	fj_loc_x          = 576
    	fj_loc_y          = 576
    	fj_dest_x         = 576
    	fj_dest_y         = 576
    	fj_animation      = 0x6000 // CLERIC_MALE_HUMAN
    	fj_orientation    = 14     // SE
    	STR_VAR
    	fj_structure_type = actor
    	fj_name           = Priest of Umberlee
    	fj_cre_resref     = pumberl
 END
 LPF fj_are_structure
   	INT_VAR
   	fj_loc_x          = 352
    	fj_loc_y          = 252
    	fj_dest_x         = 352
    	fj_dest_y         = 252
    	fj_animation      = 0x6000 // CLERIC_MALE_HUMAN
    	fj_orientation    = 14     // SE
    	STR_VAR
    	fj_structure_type = actor
    	fj_name           = Priest of Umberlee
    	fj_cre_resref     = pumber2
 END
 LPF fj_are_structure
   	INT_VAR
   	fj_loc_x          = 1040
    	fj_loc_y          = 432
    	fj_dest_x         = 1040
    	fj_dest_y         = 432
    	fj_animation      = 0x6000 // CLERIC_MALE_HUMAN
    	fj_orientation    = 6      // NW
    	STR_VAR
    	fj_structure_type = actor
    	fj_name           = Priest of Umberlee
    	fj_cre_resref     = pumber3
 END
 LPF fj_are_structure
   	INT_VAR
   	fj_loc_x          = 896
    	fj_loc_y          = 588
    	fj_dest_x         = 896
    	fj_dest_y         = 588
    	fj_animation      = 0x6000 // CLERIC_MALE_HUMAN
    	fj_orientation    = 6      // NW
    	STR_VAR
    	fj_structure_type = actor
    	fj_name           = Priest of Umberlee
    	fj_cre_resref     = pumber4
 END
 LPF fj_are_structure
   	INT_VAR
   	fj_loc_x          = 400
    	fj_loc_y          = 828
    	fj_dest_x         = 400
    	fj_dest_y         = 828
    	fj_animation      = 0x6000 // CLERIC_MALE_HUMAN
    	fj_orientation    = 10     // NE
    	STR_VAR
    	fj_structure_type = actor
    	fj_name           = Priest of Umberlee
    	fj_cre_resref     = pumber5
 END
 LPF fj_are_structure
   	INT_VAR
   	fj_loc_x          = 624
    	fj_loc_y          = 840
    	fj_dest_x         = 631
    	fj_dest_y         = 840
    	fj_animation      = 0x6000 // CLERIC_MALE_HUMAN
    	fj_orientation    = 6      // NW
    	STR_VAR
    	fj_structure_type = actor
    	fj_name           = Priest of Umberlee
    	fj_cre_resref     = pumber6
 END
BUT_ONLY

/// AREA SCRIPTS \\\

COMPILE		~stweaks\baf\temcut.baf~

<<<<<<<< stweaks-inlined/#gumberleetemple.baf
IF
	Global("WaterQueenTempleForbidden","GLOBAL",13)
	Exists("pumber2")
THEN
	RESPONSE #100
		ChangeEnemyAlly("pumber2",NEUTRAL)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",13)
	Exists("pumber3")
THEN
	RESPONSE #100
		ChangeEnemyAlly("pumber3",NEUTRAL)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",13)
	Exists("pumber4")
THEN
	RESPONSE #100
		ChangeEnemyAlly("pumber4",NEUTRAL)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",13)
	Exists("pumber5")
THEN
	RESPONSE #100
		ChangeEnemyAlly("pumber5",NEUTRAL)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",13)
	Exists("pumber6")
THEN
	RESPONSE #100
		ChangeEnemyAlly("pumber6",NEUTRAL)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",13)
	!Dead("pumberl")
	CombatCounter(0)
THEN
	RESPONSE #100
		CreateCreature("rat",[112.775],0)
		ClearAllActions()
		StartCutSceneMode()
		StartCutScene("TEMCUT")
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",8)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",8)
THEN
	RESPONSE #100
		FadeFromColor([20.0],0)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",8)
	Dead("pumber2")
THEN
	RESPONSE #100
		CreateCreature("pumber2",[352.252],14)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",8)
	Dead("pumber3")
THEN
	RESPONSE #100
		CreateCreature("pumber3",[1040.432],6)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",8)
	Dead("pumber4")
THEN
	RESPONSE #100
		CreateCreature("pumber4",[896.588],6)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",8)
	Dead("pumber5")
THEN
	RESPONSE #100
		CreateCreature("pumber5",[400.828],10)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",8)
	Dead("pumber6")
THEN
	RESPONSE #100
		CreateCreature("pumber6",[624.840],6)
		Continue()
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",8)
THEN
	RESPONSE #100
		FadeFromColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",3)
		ActionOverride("rat",DestroySelf())
		CreateCreature("pumberl",[573.576],14)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",13)
	Dead("pumber2")
	Dead("pumber3")
	Dead("pumber4")
	Dead("pumber5")
	Dead("pumber6")
THEN
	RESPONSE #100
		FadeFromColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",3)
		CreateCreature("pumberl",[573.576],14)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",5)
	!Dead("pumberl")
THEN
	RESPONSE #100
		FadeToColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",6)
		ActionOverride("pumberl",DestroySelf())
END

IF
	!Dead("pumberl")
	!Exists("pumberl")
	!Exists("Jalantha")
	!Exists("Tenya2")
	Global("WaterQueenTempleForbidden","GLOBAL",6)
THEN
	RESPONSE #100
		FadeFromColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",0)
		CreateCreature("pumberl",[573.576],14)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",10)
	!Exists("pumberl")
	!Exists("Jalantha")
THEN
	RESPONSE #100
		FadeToColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",7)
		Wait(1) 
		ActionOverride(Player1,LeaveAreaLUAPanic("AR8100","",[920.2407],14))
		ActionOverride(Player1,LeaveAreaLUA("AR8100","",[920.2407],14))
		ActionOverride(Player2,LeaveAreaLUA("AR8100","",[945.2393],14))
		ActionOverride(Player3,LeaveAreaLUA("AR8100","",[915.2438],14))
		ActionOverride(Player4,LeaveAreaLUA("AR8100","",[993.2380],14))
		ActionOverride(Player5,LeaveAreaLUA("AR8100","",[947.2469],14))
		ActionOverride(Player6,LeaveAreaLUA("AR8100","",[1035.2403],14))
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",17)
	!Exists("Tenya2")
THEN
	RESPONSE #100
		FadeToColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",19)
		Wait(1) 
		ActionOverride(Player1,LeaveAreaLUAPanic("AR8100","",[920.2407],14))
		ActionOverride(Player1,LeaveAreaLUA("AR8100","",[920.2407],14))
		ActionOverride(Player2,LeaveAreaLUA("AR8100","",[945.2393],14))
		ActionOverride(Player3,LeaveAreaLUA("AR8100","",[915.2438],14))
		ActionOverride(Player4,LeaveAreaLUA("AR8100","",[993.2380],14))
		ActionOverride(Player5,LeaveAreaLUA("AR8100","",[947.2469],14))
		ActionOverride(Player6,LeaveAreaLUA("AR8100","",[1035.2403],14))
END

IF
	!Dead("Tenya2")
	!Exists("Tenya2")
	Global("WaterQueenTempleForbidden","GLOBAL",14)
	Global("PartyCured","GLOBAL",1)
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		FadeFromColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",15)
		ActionOverride("pumberl",DestroySelf())
		ActionOverride("pumber5",MoveToPoint([526.872]))
		ActionOverride("pumber5",Face(6))
		CreateCreature("TENYA2",[536.648],10)
		ActionOverride("TENYA2",Dialogue([PC]))
END

IF
	!Dead("pumberl")
	!Exists("pumberl")
	!Exists("Jalantha")
	!Exists("Tenya2")
	Global("PartyCured","GLOBAL",0)
	Global("WaterQueenTempleForbidden","GLOBAL",14)
THEN
	RESPONSE #100
		FadeFromColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",0)
		CreateCreature("pumberl",[573.576],14)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",21)	
	Exists("Jalantha")
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",5)
		ActionOverride("Jalantha",DestroySelf())
END

IF 
	PartyHasItem("MISC54")
	Global("WaterQueenTempleForbidden","GLOBAL",11)
THEN
	RESPONSE #100
		SetGlobal("BOYBODY","GLOBAL",1)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",10)
END

IF 
	PartyHasItem("MISC54")
	Global("WaterQueenTempleForbidden","GLOBAL",4)
THEN
	RESPONSE #100
		FadeToColor([20.0],0)
		SetGlobal("BOYBODY","GLOBAL",1)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",16)
		Wait(1) 
		ActionOverride(Player1,LeaveAreaLUAPanic("AR8100","",[920.2407],14))
		ActionOverride(Player1,LeaveAreaLUA("AR8100","",[920.2407],14))
		ActionOverride(Player2,LeaveAreaLUA("AR8100","",[945.2393],14))
		ActionOverride(Player3,LeaveAreaLUA("AR8100","",[915.2438],14))
		ActionOverride(Player4,LeaveAreaLUA("AR8100","",[993.2380],14))
		ActionOverride(Player5,LeaveAreaLUA("AR8100","",[947.2469],14))
		ActionOverride(Player6,LeaveAreaLUA("AR8100","",[1035.2403],14))
END

IF
	PartyHasItem("MISC54")
	Global("WaterQueenTempleAmbush","AR7609",0)
	Global("WaterQueenTempleForbidden","GLOBAL",12)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleAmbush","AR7609",1)
		SetGlobal("BOYBODY","GLOBAL",1)
		DisplayStringHead(Player1,@280)
		TriggerActivation("Door8100",TRUE)
END

IF
	Global("NoRestWaterQueenTemple","AR7609",0)
	Global("WaterQueenTempleForbidden","GLOBAL",2)
THEN
	RESPONSE #100
		SetGlobal("NoRestWaterQueenTemple","AR7609",1)
		RemoveAreaType(128)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",18)
	!Dead("Tenya2")
	!Dead("jalantha")
THEN
	RESPONSE #100
		FadeFromColor([20.0],0)
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",99)
		ActionOverride("pumber2",ChangeAIscript("WDASIGHT",DEFAULT) 
		ActionOverride("pumber3",ChangeAIscript("WDASIGHT",DEFAULT) 
		ActionOverride("pumber4",ChangeAIscript("WDASIGHT",DEFAULT) 
		ActionOverride("pumber5",ChangeAIscript("WDASIGHT",DEFAULT) 
		ActionOverride("pumber6",ChangeAIscript("WDASIGHT",DEFAULT)
		CreateCreature("jalant",[235.363],10)
		CreateCreature("TENYA2",[172.717],14)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",2)
	Global("jalanthaspawn","AR7609",0)
	!Exists("jalantha")
	!Dead("jalantha")
THEN
	RESPONSE #100
		SetGlobal("jalanthaspawn","AR7609",1)
		CreateVisualEffect("spdimndr",[210.186])
		Wait(3)
		CreateCreature("jalant",[210.186],14)
END
>>>>>>>>
EXTEND_TOP 	~AR7609.BCS~ 	~stweaks-inlined/#gumberleetemple.baf~

<<<<<<<< stweaks-inlined/#gumberleetemplereset.baf
IF
	OR(3)
	 Global("WaterQueenTempleForbidden","GLOBAL",7)
	 Global("WaterQueenTempleForbidden","GLOBAL",16)
	 Global("WaterQueenTempleForbidden","GLOBAL",19)
	!AreaCheckObject("AR7609",Player1)
	!AreaCheckObject("AR7609",Player2)
	!AreaCheckObject("AR7609",Player3)
	!AreaCheckObject("AR7609",Player4)
	!AreaCheckObject("AR7609",Player5)
	!AreaCheckObject("AR7609",Player6)
THEN
	RESPONSE #100
		Wait(1)
		FadeFromColor([20.0],0)
		Continue()
END

IF
	OR(2)
	 Global("WaterQueenTempleForbidden","GLOBAL",1)
	 Global("WaterQueenTempleForbidden","GLOBAL",7)
	!AreaCheckObject("AR7609",Player1)
	!AreaCheckObject("AR7609",Player2)
	!AreaCheckObject("AR7609",Player3)
	!AreaCheckObject("AR7609",Player4)
	!AreaCheckObject("AR7609",Player5)
	!AreaCheckObject("AR7609",Player6)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",5)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",12)
	!AreaCheckObject("AR7609",Player1)
	!AreaCheckObject("AR7609",Player2)
	!AreaCheckObject("AR7609",Player3)
	!AreaCheckObject("AR7609",Player4)
	!AreaCheckObject("AR7609",Player5)
	!AreaCheckObject("AR7609",Player6)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",13)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",19)
	!AreaCheckObject("AR7609",Player1)
	!AreaCheckObject("AR7609",Player2)
	!AreaCheckObject("AR7609",Player3)
	!AreaCheckObject("AR7609",Player4)
	!AreaCheckObject("AR7609",Player5)
	!AreaCheckObject("AR7609",Player6)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",18)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",16)
	!AreaCheckObject("AR7609",Player1)
	!AreaCheckObject("AR7609",Player2)
	!AreaCheckObject("AR7609",Player3)
	!AreaCheckObject("AR7609",Player4)
	!AreaCheckObject("AR7609",Player5)
	!AreaCheckObject("AR7609",Player6)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",14)
END

IF
	Global("HelpTenya","GLOBAL",5)
	!Global("WaterQueenTempleForbidden","GLOBAL",14)
	!Global("WaterQueenTempleForbidden","GLOBAL",18)
	!AreaCheckObject("AR7609",Player1)
	!AreaCheckObject("AR7609",Player2)
	!AreaCheckObject("AR7609",Player3)
	!AreaCheckObject("AR7609",Player4)
	!AreaCheckObject("AR7609",Player5)
	!AreaCheckObject("AR7609",Player6)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",14)
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",20)
	!AreaCheckObject("AR7609",Player1)
	!AreaCheckObject("AR7609",Player2)
	!AreaCheckObject("AR7609",Player3)
	!AreaCheckObject("AR7609",Player4)
	!AreaCheckObject("AR7609",Player5)
	!AreaCheckObject("AR7609",Player6)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",21)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR8100.BCS~ 	~stweaks-inlined/#gumberleetemplereset.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint1.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[2832.1294],8)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR7800.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint1.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint2.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[1376.1753],10)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR8200.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint2.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint3.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[2006.2573],15)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR7400.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint3.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint4.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[538.1916],7)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR7300.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint4.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint5.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[1010.2710],12)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR7700.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint5.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint6.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[2548.1491],0)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR7200.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint6.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint7.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[1980.954],14)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR7600.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint7.baf~

<<<<<<<< stweaks-inlined/#gpriestessspawnpoint8.baf
IF
	Global("HelpTenya","GLOBAL",5)
	Exists("pumberl")
THEN
	RESPONSE #100
		ActionOverride("pumberl",DestroySelf())
END

IF
	OR(2)
	 GlobalTimerExpired("Varci","GLOBAL")
	 GlobalGT("TremainMove","GLOBAL",2)
	Global("PartyCured","GLOBAL",1)
	Global("HelpTenya","GLOBAL",3)
	!Global("WaterQueenTempleForbidden","GLOBAL",99)
	GlobalTimerExpired("TenyaInvitation","GLOBAL")
	!Exists("pumberl")
	ReputationLT(Player1,13)
THEN
	RESPONSE #100
		SetGlobal("HelpTenya","GLOBAL",4)
		CreateCreature("pumberl",[3866.1703],9)
END
>>>>>>>>
EXTEND_BOTTOM 	~AR8000.BCS~ 	~stweaks-inlined/#gpriestessspawnpoint8.baf~

/// CRE SCRIPTS \\\

COMPILE		~stweaks\baf\jalcut.baf~
COMPILE		~stweaks\baf\jalcut2.baf~
COMPILE		~stweaks\baf\tencut.baf~
COMPILE		~stweaks\baf\tencut2.baf~

<<<<<<<< stweaks-inlined/#gpumber.baf
IF
	See([PC])
	NumTimesTalkedTo(0)
	!Global("HelpTenya","GLOBAL",4)
THEN
	RESPONSE #100
		StartDialogueNoSet([PC])
END

IF
	See([PC])
	Global("HelpTenya","GLOBAL",4)
THEN
	RESPONSE #100
		Dialogue([PC])
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",1)
	TimerExpired(0)
	Allegiance("pumberl",NEUTRAL)
	See([PC])
THEN
	RESPONSE #100
		SetGlobal("TimeIsUp","LOCALS",1)
		SetNumTimesTalkedTo(0)
END

IF
	AttackedBy([GOODCUTOFF],DEFAULT)
	!Global("WaterQueenTempleForbidden","GLOBAL",2)
	!Global("WaterQueenTempleForbidden","GLOBAL",12)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",2)
END
>>>>>>>>
EXTEND_BOTTOM 	~PUMBER.BCS~ 	~stweaks-inlined/#gpumber.baf~

<<<<<<<< stweaks-inlined/#gpumberall.baf
IF
	Global("WaterQueenTempleForbidden","GLOBAL",1)	
	Allegiance(Myself,NEUTRAL)
	LOS([PC],15)
THEN
	RESPONSE #100
		Dialogue([PC])
END

IF
	OR(2)
	 Global("WaterQueenTempleForbidden","GLOBAL",2)
	 Allegiance("pumberl",ENEMY)
	Allegiance(Myself,Neutral)
THEN
	RESPONSE #100
		Enemy()
END

IF
	AttackedBy([GOODCUTOFF],DEFAULT)
	!Global("WaterQueenTempleForbidden","GLOBAL",2)
	!Global("WaterQueenTempleForbidden","GLOBAL",12)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",2)
END

IF

	See(NearestEnemyOf(Myself))
	HaveSpell(CLERIC_COMMAND)
	!StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
	!StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
THEN
	RESPONSE #100
		Spell(NearestEnemyOf(Myself),CLERIC_COMMAND)
END

IF

	See(NearestEnemyOf(Myself))
	HaveSpell(CLERIC_HOLD_PERSON)
	!StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
	!StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
THEN
	RESPONSE #100
		Spell(NearestEnemyOf(Myself),CLERIC_HOLD_PERSON)
END

IF

	See(SecondNearestEnemyOf(Myself))
	HaveSpell(CLERIC_COMMAND)
	!StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
	!StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
THEN
	RESPONSE #100
		Spell(SecondNearestEnemyOf(Myself),CLERIC_COMMAND)
END

IF

	See(SecondNearestEnemyOf(Myself))
	HaveSpell(CLERIC_HOLD_PERSON)
	!StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
	!StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
THEN
	RESPONSE #100
		Spell(SecondNearestEnemyOf(Myself),CLERIC_HOLD_PERSON)
END

IF

	See(ThirdNearestEnemyOf(Myself))
	HaveSpell(CLERIC_COMMAND)
	!StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
	!StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
THEN
	RESPONSE #100
		Spell(ThirdNearestEnemyOf(Myself),CLERIC_COMMAND)
END

IF

	See(ThirdNearestEnemyOf(Myself))
	HaveSpell(CLERIC_HOLD_PERSON)
	!StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
	!StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
THEN
	RESPONSE #100
		Spell(SecondNearestEnemyOf(Myself),CLERIC_HOLD_PERSON)
END
>>>>>>>>
EXTEND_BOTTOM 	~PUMBER2.BCS~ 	~stweaks-inlined/#gpumberall.baf~
EXTEND_BOTTOM 	~PUMBER3.BCS~ 	~stweaks-inlined/#gpumberall.baf~
EXTEND_BOTTOM 	~PUMBER4.BCS~ 	~stweaks-inlined/#gpumberall.baf~
EXTEND_BOTTOM 	~PUMBER5.BCS~ 	~stweaks-inlined/#gpumberall.baf~
EXTEND_BOTTOM 	~PUMBER6.BCS~ 	~stweaks-inlined/#gpumberall.baf~

<<<<<<<< stweaks-inlined/#gpumber2.baf
IF
	Global("WaterQueenTempleForbidden","GLOBAL",12)
	Global("pumber2move","LOCALS",0)
THEN
	RESPONSE #100
		SetGlobal("pumber2move","LOCALS",1)
		MoveToPoint([480.534])
		Face(14)
END

IF
	Global("pumber2move","LOCALS",1)
	!Exists("Tenya2")
THEN
	RESPONSE #100
		SetGlobal("pumber2move","LOCALS",2)
		DisplayStringHead(Myself,@258)
		Shout(99)
END
>>>>>>>>
EXTEND_BOTTOM 	~PUMBER2.BCS~ 	~stweaks-inlined/#gpumber2.baf~

<<<<<<<< stweaks-inlined/#gpumber3.baf
IF
	Global("WaterQueenTempleForbidden","GLOBAL",12)
	Global("pumber3move","LOCALS",0)
THEN
	RESPONSE #100
		SetGlobal("pumber3move","LOCALS",1)
		MoveToPoint([817.334])
		MoveToPoint([648.528])
		Face(2)
END

IF
	Global("pumber3move","LOCALS",1)
	!Exists("Tenya2")
THEN
	RESPONSE #100
		SetGlobal("pumber3move","LOCALS",2)
END
>>>>>>>>
EXTEND_BOTTOM 	~PUMBER3.BCS~ 	~stweaks-inlined/#gpumber3.baf~

<<<<<<<< stweaks-inlined/#gpumber4.baf
IF
	Global("WaterQueenTempleForbidden","GLOBAL",12)
	Global("pumber4move","LOCALS",0)
THEN
	RESPONSE #100
		SetGlobal("pumber4move","LOCALS",1)
		MoveToPoint([782.585])
		Face(2)
END

IF
	Global("pumber4move","LOCALS",1)
	!Exists("Tenya2")
THEN
	RESPONSE #100
		SetGlobal("pumber4move","LOCALS",2)
END
>>>>>>>>
EXTEND_BOTTOM 	~PUMBER4.BCS~ 	~stweaks-inlined/#gpumber4.baf~

<<<<<<<< stweaks-inlined/#gpumber5.baf
IF
	Global("WaterQueenTempleForbidden","GLOBAL",12)
	Global("pumber5move","LOCALS",0)
THEN
	RESPONSE #100
		SetGlobal("pumber5move","LOCALS",1)
		Wait(4)
		MoveToPoint([395.826])
		MoveToPoint([544.646])
		Face(10)
END

IF
	Global("pumber5move","LOCALS",1)
	!Exists("Tenya2")
THEN
	RESPONSE #100
		SetGlobal("pumber5move","LOCALS",2)
END
>>>>>>>>
EXTEND_BOTTOM 	~PUMBER5.BCS~ 	~stweaks-inlined/#gpumber5.baf~

<<<<<<<< stweaks-inlined/#gpumber6.baf
IF
	Global("WaterQueenTempleForbidden","GLOBAL",12)
	Global("pumber6move","LOCALS",0)
THEN
	RESPONSE #100
		SetGlobal("pumber6move","LOCALS",1)
		MoveToPoint([672.704])
		Face(10)
END

IF
	Global("pumber6move","LOCALS",1)
	!Exists("Tenya2")
THEN
	RESPONSE #100
		SetGlobal("pumber6move","LOCALS",2)
END
>>>>>>>>
EXTEND_BOTTOM 	~PUMBER6.BCS~ 	~stweaks-inlined/#gpumber6.baf~

<<<<<<<< stweaks-inlined/#jalantlocalcheck.baf
IF
	Die()
	Global("BOYBODY","GLOBAL",1)
	HasItem("MISC54",Myself)
THEN
	RESPONSE #100
		DestroyItem("MISC54")
		Continue()
END

IF
	Die()
	Global("LothanderMove","GLOBAL",5)
	HasItem("SCRLJALA",Myself)
THEN
	RESPONSE #100
		DestroyItem("SCRLJALA")
		Continue()
END

IF
	Global("JALCUT2","LOCALS",1)
THEN
	RESPONSE #100
		SetGlobal("JALCUT2","LOCALS",0)
		StartDialogueNoSet(LastTalkedToBy("pumberl"))
END

IF
	Allegiance(Myself,NEUTRAL)
	Global("WaterQueenTempleForbidden","GLOBAL",2)
THEN
	RESPONSE #100
		Enemy()
END

IF
	AttackedBy([GOODCUTOFF],DEFAULT)
	!Global("WaterQueenTempleForbidden","GLOBAL",2)
	!Global("WaterQueenTempleForbidden","GLOBAL",12)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",2)
END

IF
	OR(3)
	 Global("TalkedToTenya","GLOBAL",0)
	 Global("WaterQueenTempleForbidden","GLOBAL",2)
	 Global("WaterQueenTempleForbidden","GLOBAL",12)
	Global("Bowl","LOCALS",0)
THEN
	RESPONSE #100
		CreateItem("gwebowl",1,0,0)
		SetGlobal("Bowl","LOCALS",1)	
END

IF
	Global("Bowl","LOCALS",1)
	Allegiance(Myself,ENEMY)
	HasItem("gwebowl",Myself)
	See([PC])
THEN
	RESPONSE #100
		SetInterrupt(FALSE)
		SetGlobal("Bowl","LOCALS",2)
		DisplayStringHead(Myself,@291)
		SetSequence(SEQ_CONJURE)
		PlaySound("CAS_P03")
		Wait(1)
		CreateCreatureObjectEffect("ELWATG01","SPPORTAL",Myself)
		DestroyItem("gwebowl")
		SetInterrupt(TRUE)
END
>>>>>>>>
EXTEND_TOP ~jalant.bcs~ ~stweaks-inlined/#jalantlocalcheck.baf~

<<<<<<<< stweaks-inlined/#tenyalocalcheck.baf
IF
	Die()
	GlobalGT("Necklace","LOCALS",0)
	HasItem("umbamul",Myself)
	PartyHasItem("umbamul")
THEN
	RESPONSE #100
		DestroyItem("umbamul")
END

IF
	Global("WaterQueenTempleForbidden","GLOBAL",2)
	Allegiance(Myself,NEUTRAL)
THEN
	RESPONSE #100
		Enemy()
END

IF
	Global("TENCUT","LOCALS",1)
THEN
	RESPONSE #100
		SetGlobal("TENCUT","LOCALS",2)
		FaceObject([PC])
		Wait(1)
		StartDialogueNoSet(LastTalkedToBy("pumberl"))
END

IF
	Global("TENCUT","LOCALS",3)
THEN
	RESPONSE #100
		SetGlobal("TENCUT","LOCALS",0)
		Shout(99)
		ForceSpell(Myself,DRYAD_TELEPORT)
END

IF
	AttackedBy([GOODCUTOFF],DEFAULT)
	!Global("WaterQueenTempleForbidden","GLOBAL",2)
	!Global("WaterQueenTempleForbidden","GLOBAL",12)
THEN
	RESPONSE #100
		SetGlobal("WaterQueenTempleForbidden","GLOBAL",2)
END

IF
	OR(2)
	 Global("WaterQueenTempleForbidden","GLOBAL",2)
	 Global("WaterQueenTempleForbidden","GLOBAL",12)
	Global("Necklace","LOCALS",0)
THEN
	RESPONSE #100
		CreateItem("umbamul",1,0,0)
		SetGlobal("Necklace","LOCALS",1)	
END

IF
	Global("Necklace","LOCALS",1)
	Allegiance(Myself,ENEMY)
	HasItem("umbamul",Myself)
THEN
	RESPONSE #100
		SetGlobal("Necklace","LOCALS",2)
		FillSlot(SLOT_AMULET)
END
>>>>>>>>
EXTEND_TOP ~tenya.bcs~ ~stweaks-inlined/#tenyalocalcheck.baf~

/// DIALOGUES \\\

<<<<<<<< stweaks-inlined/#gtenya.d
REPLACE tenya2
IF ~Global("HelpTenya","GLOBAL",2)ReactionGT(LastTalkedToBy,HOSTILE_UPPER)~ THEN BEGIN 0 // from:
  SAY @11 /* ~Well, I should say the Mother and I expected to see you again at some point, though it was certainly not to be so soon. I suppose it's to collect some sort of payment for your actions outside of Baldur's Gate, hm?~ */
  IF ~ReputationLT(Player1,16)~ THEN REPLY @8 /* ~I wish nothing of you, save the body of the fool that tried to break into your hallowed halls. I imagine the return of such an infidel is ample return for my services.~ */ GOTO 2
  IF ~ReputationGT(Player1,15)~ THEN REPLY @8 /* ~I wish nothing of you, save the body of the fool that tried to break into your hallowed halls. I imagine the return of such an infidel is ample return for my services.~ */ GOTO 3
  IF ~Dead("Jebadoh")~ THEN REPLY @9 /* ~I demand the body of the child you found trespassing as payment for helping your cause! You and your Umberlee would not have prevailed without my help, and 'twas said you would repay me in time!~ */ GOTO 4
  IF ~!Dead("Jebadoh")~ THEN REPLY @9 /* ~I demand the body of the child you found trespassing as payment for helping your cause! You and your Umberlee would not have prevailed without my help, and 'twas said you would repay me in time!~ */ GOTO 10
  IF ~~ THEN REPLY @10 /* ~Please... I beg of you. I have but one wish and then I will go. There is a child who came here and was killed. I simply hope to obtain his body. Then I shall trouble you no more.~ */ GOTO 5
END
IF ~Global("HelpTenya","GLOBAL",2)ReactionLT(LastTalkedToBy,NEUTRAL_LOWER)~ THEN BEGIN 1 // from:
  SAY @7 /* ~To what dishonor do we owe your violating our temple? Is it not you who served Umberlee once in the past? Such a promising introduction to be followed by your breaking onto our sacred ground. State your purpose here!~ */
  IF ~ReputationLT(Player1,16)~ THEN REPLY @8 /* ~I wish nothing of you, save the body of the fool that tried to break into your hallowed halls. I imagine the return of such an infidel is ample return for my services.~ */ GOTO 2
  IF ~ReputationGT(Player1,15)~ THEN REPLY @8 /* ~I wish nothing of you, save the body of the fool that tried to break into your hallowed halls. I imagine the return of such an infidel is ample return for my services.~ */ GOTO 3
  IF ~Dead("Jebadoh")~ THEN REPLY @9 /* ~I demand the body of the child you found trespassing as payment for helping your cause! You and your Umberlee would not have prevailed without my help, and 'twas said you would repay me in time!~ */ GOTO 4
  IF ~!Dead("Jebadoh")~ THEN REPLY @9 /* ~I demand the body of the child you found trespassing as payment for helping your cause! You and your Umberlee would not have prevailed without my help, and 'twas said you would repay me in time!~ */ GOTO 10
  IF ~~ THEN REPLY @10 /* ~Please... I beg of you. I have but one wish and then I will go. There is a child who came here and was killed. I simply hope to obtain his body. Then I shall trouble you no more.~ */ GOTO 5
END
IF ~  Global("HelpTenya","GLOBAL",1)~ THEN BEGIN 6 // from:
  SAY @12 /* ~You! Is it nerve that brings thee here?! No, more likely stupidity. Was it not you who turned thy back on Umberlee's cause? You have changed somewhat but it is you. I see with the Mother's eyes! Your inaction was of little consequence, for the mother and I dealt well with all of them. Now you will join them!~ */
  IF ~ReactionLT(LastTalkedToBy,NEUTRAL_LOWER)~ THEN REPLY @13 /* ~I meant no ill on you or your temple. Please, I beg of you. It is a mission of mercy I am on: I seek the body of a child killed here. The child's parent does miss him so!~ */ GOTO 7
  IF ~ReactionGT(LastTalkedToBy,HOSTILE_UPPER)~ THEN REPLY @13 /* ~I meant no ill on you or your temple. Please, I beg of you. It is a mission of mercy I am on: I seek the body of a child killed here. The child's parent does miss him so!~ */ GOTO 8
  IF ~ReactionGT(LastTalkedToBy,NEUTRAL_UPPER)~ THEN REPLY @14 /* ~It was not my fight. Far be it from me to get in the path of your righteous fury. My purpose here now hath no more inconvenience than when we last met. You have the body of a child here. Your justice has been dealt, and now I have come to take him home.~ */ GOTO 9
  IF ~ReactionLT(LastTalkedToBy,NEUTRAL_LOWER)~ THEN REPLY @14 /* ~It was not my fight. Far be it from me to get in the path of your righteous fury. My purpose here now hath no more inconvenience than when we last met. You have the body of a child here. Your justice has been dealt, and now I have come to take him home.~ */ GOTO 7
END
END
REPLACE_TRIGGER_TEXT ~tenya2~ ~False()~ ~Global("WaterQueenTempleForbidden","GLOBAL",15) Global("HelpTenya","GLOBAL",5)~
ADD_STATE_TRIGGER ~tenya2~ 0 ~Global("BOYBODY","GLOBAL",0)~
ADD_STATE_TRIGGER ~tenya2~ 1 ~Global("BOYBODY","GLOBAL",0)~
ADD_STATE_TRIGGER ~tenya2~ 6 ~Global("BOYBODY","GLOBAL",0)~
ALTER_TRANS ~tenya2~ BEGIN 2 4 8 9 END BEGIN 0 END BEGIN "ACTION" ~SetCursorState(TRUE) SetGlobal("BOYBODY","GLOBAL",1) SetGlobal("WaterQueenTempleForbidden","GLOBAL",4) SetGlobal("HelpTenya","GLOBAL",3) SetGlobalTimer("TenyaInvitation","GLOBAL",36000) CreateItem("MISC54",0,0,0) DropItem("MISC54",[-1.-1]) Wait(1) MoveToPoint([390.823]) MoveToPoint([140.749]) Wait(1) ActionOverride("pumber5",MoveToPoint([400.828])) ActionOverride("pumber5",Face(10)) SetCursorState(FALSE) DestroySelf()~ END
ALTER_TRANS ~tenya2~ BEGIN 3 5 END BEGIN 0 END BEGIN "ACTION" ~SetCursorState(TRUE) SetGlobal("BOYBODY","GLOBAL",1) SetGlobal("WaterQueenTempleForbidden","GLOBAL",12) TriggerActivation("Door8100",FALSE) CreateItem("MISC54",0,0,0) DropItem("MISC54",[-1.-1]) Wait(1) MoveToPoint([390.823]) ActionOverride(LastTalkedToBy,FaceObject("Door8100")) DisplayStringHead(LastTalkedToBy,@279) MoveToPoint([140.749]) ActionOverride(LastTalkedToBy,FaceObject("pumber2")) Wait (2) SetCursorState(FALSE) DestroySelf()~ END
ALTER_TRANS ~tenya2~ BEGIN 11 END BEGIN 0 END BEGIN "ACTION" ~SetCursorState(TRUE) SetGlobal("WaterQueenTempleForbidden","GLOBAL",17) AddAreaType(128) Wait(1) MoveToPoint([418.799]) MoveToPoint([140.749]) ActionOverride("pumber5",MoveToPoint([400.828])) ActionOverride("pumber5",Face(10)) Wait(1) SetCursorState(FALSE) DestroySelf()~ END
ALTER_TRANS ~tenya2~ BEGIN 10 END BEGIN 0 END BEGIN "ACTION" ~SetGlobal("BOYBODY","GLOBAL",1) SetGlobal("WaterQueenTempleForbidden","GLOBAL",2) CreateItem("MISC54",0,0,0) Shout(99) Enemy()~ END
ALTER_TRANS ~tenya2~ BEGIN 7 END BEGIN 0 END BEGIN "ACTION" ~ClearAllActions() StartCutSceneMode() StartCutScene("TENCUT2")~ END
ALTER_TRANS ~tenya2~ BEGIN 2 4 END BEGIN 0 END BEGIN "UNSOLVED_JOURNAL" ~@253~ END
ALTER_TRANS ~tenya2~ BEGIN 8 9 END BEGIN 0 END BEGIN "UNSOLVED_JOURNAL" ~@248~ END
ALTER_TRANS ~tenya2~ BEGIN 7 END BEGIN 0 END BEGIN "UNSOLVED_JOURNAL" ~@249~ END
ALTER_TRANS ~tenya2~ BEGIN 10 END BEGIN 0 END BEGIN "UNSOLVED_JOURNAL" ~@252~ END
ALTER_TRANS ~tenya2~ BEGIN 3 5 END BEGIN 0 END BEGIN "UNSOLVED_JOURNAL" ~@251~ END
ALTER_TRANS ~tenya2~ BEGIN 11 END BEGIN 0 END BEGIN "JOURNAL" ~@286~ END
SET_WEIGHT ~tenya2~ 1 #-1

APPEND ~tenya2~
IF WEIGHT #-1 ~Global("WaterQueenTempleForbidden","GLOBAL",99)~ THEN BEGIN tenya2newstate
SAY @282
IF ~~ THEN EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gtenya.d~

<<<<<<<< stweaks-inlined/#gpumberl.d
REPLACE ~pumberl~
IF ~True()~ THEN BEGIN 0 // from:
  SAY @264 /* ~For what purpose do you visit the Bitch Queen?~ */
  IF ~Global("HelpLothander","GLOBAL",1) Global("LothanderSneakAttack","GLOBAL",0) Global("ReturnedBook","GLOBAL",0)~ THEN REPLY @261 /* ~We wish to speak with high priestess Jalantha Mistmyr.~ */ GOTO 1
  IF ~!Dead("Tenya") Global("TalkedToTenya","GLOBAL",1) Global("HelpTremain","GLOBAL",1) !PartyHasItem("MISC54") Global("BOYBODY","GLOBAL",0)~ THEN REPLY @274 /* ~We wish to see priestess Tenya.~ */ GOTO 7
  IF ~Global("HelpTremain","GLOBAL",1) Global("TalkedToTenya","GLOBAL",0)~ THEN REPLY @261 /* ~We wish to speak with high priestess Jalantha Mistmyr.~ */ GOTO 1
  IF ~~ THEN REPLY @262 /* ~We want to see what a temple to an evil goddess looks like on the inside. We're from, uh, Cormyr. Tourists, you know?~ */ GOTO 2
  IF ~~ THEN REPLY @263 /* ~We wish to pay our respects to the Queen of the Deeps.~ */ GOTO 3
END
END
REPLACE_ACTION_TEXT pumberl ~ActionOverride("Tenya2",SetNumTimesTalkedTo(1))~ ~~
ALTER_TRANS ~pumberl~ BEGIN 6 END BEGIN 0 END BEGIN "ACTION" ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",0) CreateCreature("JALANT",[450.405],0) ClearAllActions() StartCutSceneMode() StartCutScene("JALCUT2")~ END
ALTER_TRANS ~pumberl~ BEGIN 7 END BEGIN 0 END BEGIN "ACTION" ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",0) CreateCreature("TENYA2",[140.749],3) ClearAllActions() StartCutSceneMode() StartCutScene("TENCUT")~ END
ALTER_TRANS ~pumberl~ BEGIN 10 END BEGIN 0 END BEGIN "ACTION" ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",0) CreateCreature("JALANT",[450.405],0) ClearAllActions() StartCutSceneMode() StartCutScene("JALCUT2")~ END
REPLACE_TRANS_ACTION ~pumberl~ BEGIN 2 END BEGIN END ~Wait(10)~ ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",1) StartTimer(0,16)~
REPLACE_TRANS_ACTION ~pumberl~ BEGIN 2 END BEGIN END ~Enemy()~ ~~
ADD_STATE_TRIGGER ~pumberl~ 8 ~Global("HelpJalantha","GLOBAL",1)~
ADD_STATE_TRIGGER ~pumberl~ 12 ~Global("WaterQueenTempleForbidden","GLOBAL",1)~
ADD_TRANS_TRIGGER ~pumberl~ 1 ~PartyGoldGT(49)~ DO 1
ADD_TRANS_TRIGGER ~pumberl~ 5 ~PartyGoldGT(99)~ DO 1
ADD_TRANS_TRIGGER ~pumberl~ 8 ~PartyHasItem("BOOK08")~ DO 1
ADD_TRANS_ACTION ~pumberl~ BEGIN 3 9 END BEGIN 0 END ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",7) FadeToColor([20.0],0) Wait(1) ActionOverride(Player1,LeaveAreaLUAPanic("AR8100","",[920.2407],14)) ActionOverride(Player1,LeaveAreaLUA("AR8100","",[920.2407],14)) ActionOverride(Player2,LeaveAreaLUA("AR8100","",[945.2393],14)) ActionOverride(Player3,LeaveAreaLUA("AR8100","",[915.2438],14)) ActionOverride(Player4,LeaveAreaLUA("AR8100","",[993.2380],14)) ActionOverride(Player5,LeaveAreaLUA("AR8100","",[947.2469],14)) ActionOverride(Player6,LeaveAreaLUA("AR8100","",[1035.2403],14))~
ADD_TRANS_ACTION ~pumberl~ BEGIN 12 END BEGIN 0 END ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",2) Shout(99) Enemy()~
ALTER_TRANS ~pumberl~ BEGIN 5 END BEGIN 0 END BEGIN "EPILOGUE" ~GOTO newstate1~ END

APPEND ~pumberl~
IF ~~ THEN BEGIN newstate1
SAY @257
IF ~~ THEN DO ~SetCursorState(TRUE) SetGlobal("WaterQueenTempleForbidden","GLOBAL",10) Wait(1) MoveToPoint([592.590]) MoveToPoint([741.420]) MoveToPoint([430.287]) SetCursorState(FALSE) DestroySelf()~
EXIT
END
IF WEIGHT #-1 ~Global("WaterQueenTempleForbidden","GLOBAL",3) Global("SPRITE_IS_DEADPUMBER2","GLOBAL",0) Global("SPRITE_IS_DEADPUMBER3","GLOBAL",0) Global("SPRITE_IS_DEADPUMBER4","GLOBAL",0) Global("SPRITE_IS_DEADPUMBER5","GLOBAL",0) Global("SPRITE_IS_DEADPUMBER6","GLOBAL",0)~ THEN BEGIN newstate2
SAY @259
  IF ~Global("HelpLothander","GLOBAL",1) Global("LothanderSneakAttack","GLOBAL",0)~ THEN REPLY @261 /* ~We wish to speak with high priestess Jalantha Mistmyr.~ */ GOTO 1
  IF ~~ THEN REPLY @262 /* ~We want to see what a temple to an evil goddess looks like on the inside. We're from, uh, Cormyr. Tourists, you know?~ */ GOTO 2
  IF ~~ THEN REPLY @263 /* ~We wish to pay our respects to the Queen of the Deeps.~ */ GOTO 3
END
IF WEIGHT #-1 ~Global("WaterQueenTempleForbidden","GLOBAL",3)~ THEN BEGIN newstate3
SAY @260
  IF ~Global("HelpLothander","GLOBAL",1) Global("LothanderSneakAttack","GLOBAL",0)~ THEN REPLY @261 /* ~We wish to speak with high priestess Jalantha Mistmyr.~ */ GOTO 1
  IF ~~ THEN REPLY @262 /* ~We want to see what a temple to an evil goddess looks like on the inside. We're from, uh, Cormyr. Tourists, you know?~ */ GOTO 2
  IF ~~ THEN REPLY @263 /* ~We wish to pay our respects to the Queen of the Deeps.~ */ GOTO 3
END
IF WEIGHT #-1 ~Global("WaterQueenTempleForbidden","GLOBAL",1) Global("TimeIsUp","LOCALS",0)~ THEN BEGIN newstate4
SAY @284
  IF ~~ THEN EXIT
END
IF WEIGHT #-1 ~Global("HelpTenya","GLOBAL",4)~ THEN BEGIN newstate5
SAY @285
  IF ~AreaCheck("AR7200")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([4280.1753]) SetCursorState(FALSE) DestroySelf()~ EXIT
  IF ~AreaCheck("AR7300")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([538.1916]) SetCursorState(FALSE) DestroySelf()~ EXIT
  IF ~AreaCheck("AR7400")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([2204.3195]) SetCursorState(FALSE) DestroySelf()~ EXIT
  IF ~AreaCheck("AR7600")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([3937.21]) SetCursorState(FALSE) DestroySelf()~ EXIT
  IF ~AreaCheck("AR7700")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([1209.3323]) SetCursorState(FALSE) DestroySelf()~ EXIT
  IF ~AreaCheck("AR7800")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([2562.3316]) SetCursorState(FALSE) DestroySelf()~ EXIT
  IF ~AreaCheck("AR8000")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([4280.1879]) SetCursorState(FALSE) DestroySelf()~ EXIT
  IF ~AreaCheck("AR8200")~ THEN DO ~SetCursorState(TRUE) SetGlobal("HelpTenya","GLOBAL",5) MoveToPoint([7.902]) SetCursorState(FALSE) DestroySelf()~ EXIT
END
END

SET_WEIGHT ~pumberl~ 11 #4
SET_WEIGHT ~pumberl~ 12 #5
SET_WEIGHT ~pumberl~ 8 #6
SET_WEIGHT ~pumberl~ 0 #7
>>>>>>>>
COMPILE ~stweaks-inlined/#gpumberl.d~

<<<<<<<< stweaks-inlined/#gpumber2.d
REPLACE_TRANS_ACTION ~pumber2~ BEGIN 1 END BEGIN END ~Enemy()~ ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",2) Shout(99) Enemy()~
ADD_STATE_TRIGGER ~pumber2~ 1 ~Global("WaterQueenTempleForbidden","GLOBAL",1)~

SET_WEIGHT ~pumber2~ 1 #0
SET_WEIGHT ~pumber2~ 0 #1
>>>>>>>>
COMPILE ~stweaks-inlined/#gpumber2.d~

<<<<<<<< stweaks-inlined/#gjalantha.d
REPLACE ~jalant~
IF WEIGHT #2 /* Triggers after states #: 7 16 even though they appear after this state */
~True()~ THEN BEGIN 0 // from:
  SAY @265 /* ~I am the High Priestess Jalantha Mistmyr; what reason do you have to see me?~ */
  IF ~~ THEN REPLY @266 /* ~We have come to pay our respects at your temple.~ */ GOTO 1
  IF ~Global("HelpLothander","GLOBAL",1) Global("ReturnedBook","GLOBAL",0)~ THEN REPLY @267 /* ~We have need of your powers. A companion of ours is cursed with a geas spell. We humbly ask that you remove it.~ */ GOTO 3
  IF ~Global("HelpLothander","GLOBAL",1) Global("ReturnedBook","GLOBAL",0)~ THEN REPLY @268 /* ~We want you to remove a geas spell from a companion of ours. We will pay any price.~ */ GOTO 4
  IF ~Global("BOYBODY","GLOBAL",0) Global("TalkedToTenya","GLOBAL",0) Global("HelpTremain","GLOBAL",1)~ THEN REPLY @269 /* ~I wish nothing of you, save the body of the fool that tried to break into your hallowed halls. I imagine the return of such an infidel is ample return for my services.~ */ GOTO 13
END
IF ~~ THEN BEGIN 1 // from:
  SAY @270 /* ~You say you have come to worship at this temple, yet none of you bear any holy items of my goddess. Why are you here?~ */
  IF ~~ THEN REPLY @271 /* ~We did not lie, we are here to pay our respects to your goddess.~ */ GOTO 2
  IF ~~ THEN REPLY @272 /* ~You're right. We're not here to worship; rather, we need the power you possess. A friend of ours is afflicted by a geas spell. Would you be able to remove it from him?~ */ GOTO 3
  IF ~~ THEN REPLY @273 /* ~We need you to remove a geas spell from one of our companions. Name your price.~ */ GOTO 4
  IF ~Global("BOYBODY","GLOBAL",0) Global("TalkedToTenya","GLOBAL",0) Global("HelpTremain","GLOBAL",1)~ THEN REPLY @269 /* ~I wish nothing of you, save the body of the fool that tried to break into your hallowed halls. I imagine the return of such an infidel is ample return for my services.~ */ GOTO 13
END
IF WEIGHT #0 ~Global("HelpJalantha","GLOBAL",1)~ THEN BEGIN 7 // from:
  SAY @276 /* ~So, you've returned with the Book of Wisdom. Let me see it.~ */
  IF ~CheckStatGT(LastTalkedToBy(Myself),14,CHR)~ THEN REPLY @275 /* ~We don't trust you. Before we show it to you, we want the cure to our friend's geas.~ */ DO ~GiveItem("SCRLJALA",LastTalkedToBy)~ GOTO 9
  IF ~CheckStatLT(LastTalkedToBy(Myself),15,CHR)~ THEN REPLY @275 /* ~We don't trust you. Before we show it to you, we want the cure to our friend's geas.~ */ GOTO 14
  IF ~PartyHasItem("BOOK08")~ THEN REPLY @277 /* ~Here you go. Now give us the cure to the geas.~ */ GOTO 10
  IF ~~ THEN REPLY @278 /* ~Actually we don't have it with us right now.~ */ GOTO 8
END
END
REPLACE_STATE_TRIGGER ~jalant~ 16 ~Global("ReturnedBook","GLOBAL",1)~
ADD_TRANS_ACTION ~jalant~ BEGIN 10 12 END BEGIN 0 END ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",20)~
REPLACE_TRANS_ACTION ~jalant~ BEGIN 14 END BEGIN 0 END ~Shout(1)~ ~Global("WaterQueenTempleForbidden","GLOBAL",2) Shout(99)~
REPLACE_TRANS_ACTION ~jalant~ BEGIN 11 END BEGIN 0 END ~Enemy()~ ~Global("WaterQueenTempleForbidden","GLOBAL",2) Shout(99) Enemy()~
REPLACE_TRANS_ACTION ~jalant~ BEGIN 6 END BEGIN 0 END ~SetGlobal("HelpJalantha","GLOBAL",1)~ ~SetGlobal("HelpJalantha","GLOBAL",1) SetGlobal("WaterQueenTempleForbidden","GLOBAL",10) ClearAllActions() StartCutSceneMode() StartCutScene("JALCUT")~
REPLACE_TRANS_ACTION ~jalant~ BEGIN 15 END BEGIN 0 END ~GiveItem("MISC54",LastTalkedToBy)~ ~DropItem("MISC54",[-1.-1]) SetGlobal("WaterQueenTempleForbidden","GLOBAL",11)~
REPLACE_TRANS_ACTION ~jalant~ BEGIN 15 END BEGIN 0 END ~TakePartyGold(2000)~ ~TakePartyGold(2000) ClearAllActions() StartCutSceneMode() StartCutScene("JALCUT")~
ADD_TRANS_ACTION ~jalant~ BEGIN 2 END BEGIN 0 END ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",10) ClearAllActions() StartCutSceneMode() StartCutScene("JALCUT")~
ADD_TRANS_ACTION ~jalant~ BEGIN 5 8 END BEGIN 0 END ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",7) FadeToColor([20.0],0) Wait(1) ActionOverride(Player1,LeaveAreaLUAPanic("AR8100","",[920.2407],14)) ActionOverride(Player1,LeaveAreaLUA("AR8100","",[920.2407],14)) ActionOverride(Player2,LeaveAreaLUA("AR8100","",[945.2393],14)) ActionOverride(Player3,LeaveAreaLUA("AR8100","",[915.2438],14)) ActionOverride(Player4,LeaveAreaLUA("AR8100","",[993.2380],14)) ActionOverride(Player5,LeaveAreaLUA("AR8100","",[947.2469],14)) ActionOverride(Player6,LeaveAreaLUA("AR8100","",[1035.2403],14))~
ALTER_TRANS ~jalant~ BEGIN 13 END BEGIN 0 END BEGIN "EPILOGUE" ~GOTO newstate1~ END

APPEND ~jalant~
IF ~~ THEN BEGIN newstate1
SAY @256
IF ~~ THEN DO ~SetGlobal("WaterQueenTempleForbidden","GLOBAL",10) ClearAllActions() StartCutSceneMode() StartCutScene("JALCUT")~
EXIT
END
IF WEIGHT #-1 ~Global("WaterQueenTempleForbidden","GLOBAL",99)~ THEN BEGIN newstate2
SAY @281
IF ~~ THEN DO ~StartStore("Tem0003",LastTalkedToBy(Myself))~ 
EXIT
END
END
>>>>>>>>
COMPILE ~stweaks-inlined/#gjalantha.d~
*/
//////////////////////////////////////////////////////////////////////////
/// Seal the doors at Felonius if the Degrodel mission has not started ///
//////////////////////////////////////////////////////////////////////////

COPY_EXISTING ~AR7700.ARE~ ~override~
 LPF ALTER_AREA_DOOR INT_VAR lock_difficulty = 100 door_hp = 100 STR_VAR door_name = "DOOR0719" door_script = "DR0719"END
 LPF ALTER_AREA_DOOR INT_VAR lock_difficulty = 100 door_hp = 100 STR_VAR door_name = "DOOR0719b" door_script = "DR0719b" END
BUT_ONLY

EXTEND_TOP 	~DR0719.BCS~ 	~stweaks/baf/door0719.baf~
EXTEND_TOP 	~DR0719b.BCS~ 	~stweaks/baf/door0719b.baf~

//////////////////////////////////////////////////////////////////////
/// Remove extra info in journal entry and a senseless gold reward ///
//////////////////////////////////////////////////////////////////////

<<<<<<<< .../stweaks/#gdryad.d
REPLACE_ACTION_TEXT ~DRYAD~ ~GivePartyGold(20)~ ~~
ALTER_TRANS DRYAD BEGIN 4 10 END BEGIN 0 END BEGIN ~SOLVED_JOURNAL~ ~@3~ END
>>>>>>>>
COMPILE ~.../stweaks/#gdryad.d~

COPY_EXISTING ~ARAM00.bcs~ ~override~
  DECOMPILE_AND_PATCH BEGIN
  REPLACE_TEXTUALLY ~ChangeEnemyAlly("BPIMOEN",GOODCUTOFF)~ ~EraseJournalEntry(@3)
ChangeEnemyAlly("BPIMOEN",GOODCUTOFF)~
END
BUT_ONLY

//////////////////////////////
/// Firebead's Contingency ///
//////////////////////////////

APPEND ~spell.ids~ ~3128 FIREB1_WARD~ UNLESS ~3128 FIREB1_WARD~
APPEND ~spell.ids~ ~3129 FIREB1_CONTINGENCY~ UNLESS ~3129 FIREB1_CONTINGENCY~

STRING_SET 1934 ~Firebead's Contingency~
STRING_SET 1935 ~Firebead's Contingency has triggered~

COPY ~stweaks/fbead/ch1cutz1.bcs~ override
COPY ~stweaks/fbead/ch1cutz4.bcs~ override
COPY ~stweaks/fbead/spin128.spl~ override
COPY ~stweaks/fbead/spin129.spl~ override

<<<<<<<< .../inlined/#gcutsar.d
REPLACE ~%tsu%CUTSAR~
IF ~~ THEN BEGIN 1 // from:
  SAY @212 /* ~I'm sorry that you feel that way, old man.~ [SAREV11] */
  IF ~  !Global("HelpFirebead","GLOBAL",2)
~ THEN DO ~StartCutSceneMode()
StartCutScene("ch1cut04")
~ EXIT
  IF ~  Global("HelpFirebead","GLOBAL",2)
~ THEN DO ~StartCutSceneMode()
StartCutScene("ch1cutz4")
~ EXIT
END
END
>>>>>>>>
COMPILE EVALUATE_BUFFER ~.../inlined/#gcutsar.d~

<<<<<<<< .../inlined/#ggorion.d
REPLACE ~%tsu%GORION~
IF ~See(Player1)~ THEN BEGIN 0 // from:
  SAY @213 /* ~This is very unnerving, I know, but you must trust me. It is very important that you pack your possessions so that we may leave Candlekeep immediately. Hurry, for there is no time to tarry! The keep is well protected, but not invulnerable.~ */
  IF ~HPPercentLT(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cut01")~ EXIT
  IF ~HPPercent(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cutz1")~ EXIT
  IF ~~ THEN REPLY @215 /* ~Just wait a little longer. There are a few more things I must do.~ */ DO ~SetGlobal("TalkedToGorion","GLOBAL",1)~ EXIT
  IF ~~ THEN REPLY @216 /* ~Please father, tell me where we will be going.~ */ GOTO 9
  IF ~~ THEN REPLY @217 /* ~What could possibly harm us here? This place is a fortress, and guarded beyond measure.~ */ GOTO 8
  IF ~~ THEN REPLY @218 /* ~What should I bring with me on this journey? If you would just give some clue as to what I will need...~ */ GOTO 7
END
IF ~~ THEN BEGIN 7 // from: 9.3 8.3 0.4
  SAY @219 /* ~My dear child, you should know yourself well enough to purchase the gear you need. I have given you what I can spare, so hurry off to the Inn and speak with Winthrop. Use your skills as a reference and buy what basics you must, though spend wisely. His prices are fair, but you may not have enough gold to purchase all that you would want.~ */
  IF ~HPPercentLT(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cut01")~ EXIT
  IF ~HPPercent(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cutz1")~ EXIT
  IF ~~ THEN REPLY @215 /* ~Just wait a little longer. There are a few more things I must do.~ */ DO ~SetGlobal("TalkedToGorion","GLOBAL",1)~ EXIT
  IF ~~ THEN REPLY @216 /* ~Please father, tell me where we will be going.~ */ GOTO 9
  IF ~~ THEN REPLY @217 /* ~What could possibly harm us here? This place is a fortress, and guarded beyond measure.~ */ GOTO 8
END
IF ~~ THEN BEGIN 8 // from: 9.2 7.3 0.3
  SAY @220 /* ~Candlekeep is indeed a formidable obstacle for ne'er-do-wells, but it is not insurmountable. No matter how thick the mesh, at least one mosquito always finds its way through. No my child, we must leave as soon as possible, for our safety, and for that of our friends here.~ */
  IF ~HPPercentLT(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cut01")~ EXIT
  IF ~HPPercent(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cutz1")~ EXIT
  IF ~~ THEN REPLY @215 /* ~Just wait a little longer. There are a few more things I must do.~ */ DO ~SetGlobal("TalkedToGorion","GLOBAL",1)~ EXIT
  IF ~~ THEN REPLY @216 /* ~Please father, tell me where we will be going.~ */ GOTO 9
  IF ~~ THEN REPLY @218 /* ~What should I bring with me on this journey? If you would just give some clue as to what I will need...~ */ GOTO 7
END
IF ~~ THEN BEGIN 9 // from: 8.2 7.2 0.2
  SAY @221 /* ~Alas, I cannot, for I have not truly decided yet. All that is certain is that we will be far safer on the move. Perhaps the woods might offer some secluded security, or perhaps the city of Baldur's Gate would offer cover amidst its teaming throngs of people. I do not know where we shall end up, but I have a few friends here and there. Hmm... I will think on this...~ */
  IF ~HPPercentLT(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cut01")~ EXIT
  IF ~HPPercent(Player1,100)~ THEN REPLY @214 /* ~I'm ready to go right now.~ */ DO ~ClearAllActions()
StartCutSceneMode()
StartCutScene("ch1cutz1")~ EXIT
  IF ~~ THEN REPLY @215 /* ~Just wait a little longer. There are a few more things I must do.~ */ DO ~SetGlobal("TalkedToGorion","GLOBAL",1)~ EXIT
  IF ~~ THEN REPLY @217 /* ~What could possibly harm us here? This place is a fortress, and guarded beyond measure.~ */ GOTO 8
  IF ~~ THEN REPLY @218 /* ~What should I bring with me on this journey? If you would just give some clue as to what I will need...~ */ GOTO 7
END
END
>>>>>>>>
COMPILE EVALUATE_BUFFER ~.../inlined/#ggorion.d~

<<<<<<<< .../inlined/#gfireb1.d
REPLACE_ACTION_TEXT ~fireb1~ ~ForceSpell(Player1,CLERIC_PROTECT_FROM_EVIL)~ ~ForceSpell(Player1,FIREB1_WARD)~
>>>>>>>>
COMPILE ~.../inlined/#gfireb1.d~

////////////////////////////////
/// Rashad minor restoration ///
////////////////////////////////

<<<<<<<< .../inlined/#grasspk.baf
IF
	Global("RashadKilled","GLOBAL",0)
	AreaCheck("AR7608")
	HitBy([PC],CRUSHING)
	HPPercentLT(Myself,25)
THEN
	RESPONSE #100
		ClearAllACtions()
		ChangeEnemyAlly(Myself,NEUTRAL)
		SetGlobal("RashadKilled","GLOBAL",1)
		StartDialog("rashad",[PC])
END
>>>>>>>>
EXTEND_TOP ~DOPSPELL.BCS~ ~.../inlined/#grasspk.baf~

<<<<<<<< .../stweaks/#grash.d
ADD_STATE_TRIGGER ~rashad~ 5 ~Global("RashadKilled","GLOBAL",1)~
REPLACE_TRANS_ACTION ~rashad~ BEGIN 5 END BEGIN 0 END ~DestroySelf()~ ~Wait(1)
AddExperienceParty(4000)
Kill(Myself)~
SET_WEIGHT ~rashad~ 5 #-1 
>>>>>>>>
COMPILE ~.../stweaks/#grash.d~

////////////////////////////////////////
/// Add possibility to charm Quenash ///
////////////////////////////////////////

<<<<<<<< .../stweaks/#gquenas.d
APPEND QUENAS
IF WEIGHT #-1 ~StateCheck(Myself,STATE_CHARMED)
OR(2)
 !HasItem("CLCK05",Myself)
 GlobalLT("Baldurian","GLOBAL",2)~ THEN BEGIN quenas1
 SAY @42 /* ~Hello, darling! What a plesant surprise seeing you again! Do you think we can spend the night together, sweetheart?~ */
 IF ~~ THEN EXIT
END

IF WEIGHT #-1 ~StateCheck(Myself,STATE_CHARMED)
GlobalGT("Baldurian","GLOBAL",1)~ THEN BEGIN quenas2
 SAY @41 /* ~My lover has returned! Oh it's so chilly this time of the year and I worry you don't dress properly. Here, try on this cloak... Beautiful, ain't it? One of my regular customers left it in my care but I'm sure he won't mind... *giggle* He'd intended to keep it together with its match, a helm, but then he changed his mind because he did not want both to be hidden in the same public place. What was it he said? He said that he could not have found a better location to hide both the cloak and the helm, and that the building was practically named for the purpose. Oh I am all flustered now... Will you stay with your Quenash for the night?~ */
 IF ~~ THEN DO ~GiveItem("CLCK05",LastTalkedToBy)~ EXIT
END
END

REPLACE_ACTION_TEXT ~QUENAS~ ~EscapeAreaDestroy(90)~ ~SetGlobal("Baldurian","GLOBAL",3)~
REPLACE_TRIGGER_TEXT ~QUENAS~ ~True()~ ~!Global("Baldurian","GLOBAL",2)~
>>>>>>>>
COMPILE ~.../stweaks/#gquenas.d~

////////////////////////////////////////////////////////////////////////////////////
/// Change Koveras ring so that it will make sense (ITEM REVISION INCLUDES THIS) ///
////////////////////////////////////////////////////////////////////////////////////
/*
COPY ~stweaks/misc/RING25.ITM~  ~override~
 PATCH_IF (SOURCE_SIZE > 0x71) THEN BEGIN // protects against invalid files
  SAY DESC @1
 END
BUT_ONLY 
*/
/////////////////////////////////////////////////////////////////////////
/// Try and fix the mess with the 6th floor of the Candlekeep library ///
/// DEPRECATED BECAUSE NOW INCLUDED IN BG1 UB 15.1+		      ///
/////////////////////////////////////////////////////////////////////////

/*

COPY_EXISTING ~tethto2.cre~ ~override~
 REMOVE_CRE_ITEM ~SHLD04~
 REMOVE_CRE_ITEM ~BLUN05~
 REMOVE_CRE_ITEM ~CHAN02~
 REMOVE_CRE_ITEM ~SCRL75~
 WRITE_ASCII 0x2cc 		~TETHTO~ 				#8
BUT_ONLY

<<<<<<<< stweaks-inlined/#gtethto.d
ADD_STATE_TRIGGER ~TETHTO~ 0 ~Global("Arrested","GLOBAL",0)~
ADD_STATE_TRIGGER ~TETHTO~ 1 ~Global("Arrested","GLOBAL",0)~
ADD_TRANS_ACTION ~TETHTO~ BEGIN 0 END BEGIN 0 END ~MoveToPointNoInterrupt([1000.824])
DestroySelf()~
>>>>>>>>
COMPILE ~stweaks-inlined/#gtethto.d~

COPY_EXISTING ~ar6514.are~ override
  PATCH_IF SOURCE_SIZE > 0x28f BEGIN
    actnum = (0 - 1)
    READ_LONG 0x54 act_off
    READ_SHORT 0x58 act_cnt
    FOR (i = 0; i < act_cnt; i += 1) BEGIN
      READ_ASCII (i * 0x110 + act_off) act_name (32) NULL
      PATCH_IF (~%act_name%~ STRING_EQUAL_CASE ~Gatewarden~ = 1) BEGIN
        actnum = i
      END
    END
    PATCH_IF actnum >= 0 BEGIN
      LAUNCH_PATCH_FUNCTION fj_are_structure
        INT_VAR fj_delete_mode = actnum
        STR_VAR fj_structure_type = actor
      END
    END
  END
BUT_ONLY

<<<<<<<< stweaks-inlined/#ggatew.baf
IF
	Global("Criminal","GLOBAL",1)
	Global("GateWSpawn","AR6508",0)
THEN
	RESPONSE #100
		SetGlobal("GateWSpawn","AR6508",1)
		CreateCreature("GATEWA2",[1658.1254],5)
END

>>>>>>>>
EXTEND_BOTTOM ~ar6508.bcs~ ~stweaks-inlined/#ggatew.baf~

*/

/////////////////////////////////////////////////////////////////////////////
//! Minor BG1 UB Adjustments ////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////

BEGIN ~Minor BG1 UB Adjustments~
DEPRECATED @2
REQUIRE_PREDICATE (GAME_IS ~bgt tutu tutu_totsc~) ~This component only applies to BGT or Tutu.~
REQUIRE_PREDICATE (MOD_IS_INSTALLED ~SETUP-ATWEAKS.TP2~ 0) ~This component requires the presence of BG1 Unfinished Business.~
DESIGNATED 80

/////////////////////////////////
/// Adjust messed up lahl.dlg ///
/////////////////////////////////

ACTION_IF (GAME_IS ~bgt~) THEN BEGIN

<<<<<<<< .../bg1ub/ublahl.d
REPLACE_STATE_TRIGGER ~%tsu%lahl~ 1 ~Global("Kaishas1","GLOBAL",1) !Dead("hunter") GlobalLT("UBHelpLahl","GLOBAL",2)~ 
REPLACE_STATE_TRIGGER ~%tsu%lahl~ 2 ~~ 3 4 5 7
REPLACE_STATE_TRIGGER ~%tsu%lahl~ 6 ~Global("Kaishas1","GLOBAL",1) Dead("hunter")~ 
ADD_STATE_TRIGGER ~%tsu%lahl~ 8 ~Global("UBHelpLahl","GLOBAL",1)~
SET_WEIGHT ~%tsu%lahl~ 8 #-1 

ADD_TRANS_TRIGGER ~%tsu%lahl~ 1 ~Global("UBHelpLahl","GLOBAL",0)~ DO 0
ADD_TRANS_ACTION ~%tsu%lahl~ BEGIN 2 END BEGIN 0 END ~SetGlobal("UBHelpLahl","GLOBAL",1)~ 
ADD_TRANS_ACTION ~%tsu%lahl~ BEGIN 2 END BEGIN 1 END ~SetGlobal("UBHelpLahl","GLOBAL",5)~ 
ADD_TRANS_ACTION ~%tsu%lahl~ BEGIN 8 END BEGIN 0 END ~SetGlobal("UBHelpLahl","GLOBAL",2)~

APPEND ~%tsu%lahl~
IF WEIGHT #-1 ~Global("Kaishas1","GLOBAL",1) Global("UBHelpLahl","GLOBAL",5) !Dead("hunter")~ THEN BEGIN LahlAngry
  SAY #13308
  IF ~~ THEN EXIT
  END
END
>>>>>>>>

COMPILE EVALUATE_BUFFER ~.../bg1ub/ublahl.d~

ACTION_GET_STRREF 75168 palinchange

OUTER_PATCH_SAVE palinchange ~%palinchange%~ BEGIN
  REPLACE_TEXTUALLY ~Lahl was grateful for my defeat of Karoug.~ ~Lahl was grateful for my defeat of some beasts outside the walls.~
END

STRING_SET_EVALUATE 75168 ~%palinchange%~

END

//////////////////////////////////
/// Restored unshey's dialogue ///
//////////////////////////////////

ACTION_IF !(GAME_IS ~bg1 totsc~) THEN BEGIN
<<<<<<<< .../bg1ub/ubunsh.d
REPLACE_TRIGGER_TEXT ~%tsu%unshey~ ~belt04~ ~ubunbelt~
REPLACE_ACTION_TEXT ~%tsu%unshey~ ~belt04~ ~ubunbelt~
REPLACE_TRANS_ACTION ~%tsu%unshey~ BEGIN 6 END BEGIN 0 END ~EraseJournalEntry(74458)~ ~~ 

ADD_STATE_TRIGGER ~%tsu%unshey~ 4 ~GlobalLT("UBHelpUnshey","GLOBAL",2)~
ADD_STATE_TRIGGER ~%tsu%unshey~ 5 ~GlobalLT("UBHelpUnshey","GLOBAL",2)~

REPLACE_STATE_TRIGGER ~%tsu%unshey~ 0 ~Global("UBHelpUnshey","GLOBAL",0) ReactionLT(LastTalkedToBy,NEUTRAL_LOWER)~
REPLACE_STATE_TRIGGER ~%tsu%unshey~ 1 ~Global("UBHelpUnshey","GLOBAL",0) ReactionGT(LastTalkedToBy,HOSTILE_UPPER)~
REPLACE_STATE_TRIGGER ~%tsu%unshey~ 2 ~GlobalLT("UBHelpUnshey","GLOBAL",2)!HasItem("ubunbelt",LastTalkedToBy)~
REPLACE_STATE_TRIGGER ~%tsu%unshey~ 3 ~GlobalLT("UBHelpUnshey","GLOBAL",2)!HasItem("ubunbelt",LastTalkedToBy)OR(4)HasItem("BELT01",LastTalkedToBy)HasItem("BELT03",LastTalkedToBy)HasItem("BELT04",LastTalkedToBy)HasItem("BELT05",LastTalkedToBy)~ 
REPLACE_STATE_TRIGGER ~%tsu%unshey~ 7 ~Global("UBHelpUnshey","GLOBAL",3)~

ADD_TRANS_ACTION ~%tsu%unshey~ BEGIN 1 END BEGIN 0 END ~SetGlobal("UBHelpUnshey","GLOBAL",1)~ 
ADD_TRANS_ACTION ~%tsu%unshey~ BEGIN 4 5 END BEGIN 0 END ~SetGlobal("UBHelpUnshey","GLOBAL",2)~ 
ADD_TRANS_ACTION ~%tsu%unshey~ BEGIN 6 END BEGIN 0 END ~SetGlobal("UBHelpUnshey","GLOBAL",3)AddexperienceParty(800)GiveItemCreate("UBUNBOOK",LastTalkedToBy,0,0,0)~ 

SET_WEIGHT ~%tsu%unshey~ 3 #-1

APPEND ~%tsu%unshey~
  IF WEIGHT #-1 ~Global("UBHelpUnshey","GLOBAL",2)HasItemEquiped("%tsu%BELT05",LastTalkedToBy)~ THEN BEGIN UBUnsheyGenderGirdle
  SAY ~Now here is something you do not see every day! How did that happen?~
    IF ~~ THEN  REPLY ~That ogre had another girdle and putting it on caused... well... this *change*.~ GOTO 6
  END
END
>>>>>>>>
END

COMPILE EVALUATE_BUFFER ~.../bg1ub/ubunsh.d~

//////////////////////////////////////////////////////////////////////////////////
//! Restored Elfsong Tavern Movie/////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////

BEGIN ~Restore Elfsong Tavern Movie~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 90
DEPRECATED @2

EXTEND_TOP ~ar7705.bcs~ ~stweaks/mov/elftav.baf~

/* Biff movie file */

AT_INTERACTIVE_NOW ~stweaks/stwemov_in.bat~

AT_UNINSTALL ~stweaks/stwemov_un.bat~

//////////////////////////////////////////////////////////////////////////////////
//! Restored Lizardmen Animation//////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////

BEGIN ~Restore brown lizard man missing weapons~
REQUIRE_PREDICATE (GAME_IS ~bg2 tob tutu tutu_totsc~) ~This component only applies to the BG2 engine.~
DESIGNATED 100

COPY ~stweaks/bam~ ~override~

//////////////////////////////////////////////////////////////////////////////////
//! Revised Reputation table&Flaming Fist's Low Rep Spawning//////////////////////
//////////////////////////////////////////////////////////////////////////////////

BEGIN ~Revised Reputation table&Flaming Fist's Low Rep Spawning~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 200

COPY ~stweaks/2da/reputati.2da~ override
COMPILE ~stweaks/baf/actflam.baf~

//////////////////////////////////////////////////////////////////////////////////
//! Fix for SCS oversensitive SHOUT script interrupting dialogue initiation///////
//////////////////////////////////////////////////////////////////////////////////

BEGIN ~Fix a few SCS Cres that should not respond to shouts for help~
REQUIRE_COMPONENT ~setup-stratagems.tp2~ ~6010~ ~This component requires SCS 'Better Call for Help'~
DESIGNATED 300


/* 						!!!!THIS SOLUTION BELOW DOES NOT SEEM TO WORK ON BGT!!!!
					
OUTER_INNER_PATCH ~12~ BEGIN
 WRITE_BYTE 1 0x0a
 READ_ASCII 1 lnl(1)
 WRITE_BYTE 0 0x0d
 READ_ASCII 0 mnl(1)
 READ_ASCII 0 nl(2)
END

//change this so that nearby buddys don't get changed
<<<<<<<< inlined/pre_dlg_change.d
REPLACE_ACTION_TEXT ~%dialog%~ ~Enemy())~ ~abe())~
>>>>>>>>
//change the speaker to not hear or shout until after dialog options are complete
<<<<<<<< inlined/dlg_change.d
REPLACE_ACTION_TEXT ~%dialog%~ ~Enemy()~ ~ActionOverride("%dv%",ChangeAiScript("MACSHOUT",OVERRIDE))%nl%Enemy()~
>>>>>>>>
//put this back so that nearby buddys are correct
<<<<<<<< inlined/post_dlg_change.d
REPLACE_ACTION_TEXT ~%dialog%~ ~abe())~ ~Enemy())~
>>>>>>>>

COPY_EXISTING_REGEXP GLOB ~.*\.cre~ ~override~
 PATCH_IF (%SOURCE_SIZE% > 0x2d4) BEGIN
  READ_ASCII 0x248 override
  READ_ASCII 0x250 class
  READ_ASCII 0x2cc dialog
  READ_ASCII 0x280 dv (32)NULL
  READ_STRREF 0xc ~sname~
  PATCH_IF ( (~%class%~ STRING_COMPARE_REGEXP ~INITDLG~ =0)
		 AND (~%override%~ STRING_COMPARE_REGEXP ~MACSHOUT~ =0) ) BEGIN
   WRITE_ASCII 0x248 ~~ (8)
   PATCH_IF ( (~%dv%~ STRING_COMPARE_REGEXP ~NONE~ =0)
		   OR (~%dv%~ STRING_COMPARE_REGEXP ~~ =0) ) BEGIN
	PATCH_IF (~%sname%~ STRING_COMPARE_REGEXP ~<Invalid Strref -1>~ =0) BEGIN
	 WRITE_ASCII 0x280 %SOURCE_RES%
	 READ_ASCII 0x280 dv (32)NULL
	END
	ELSE
	PATCH_IF !(~%sname%~ STRING_COMPARE_REGEXP ~<Invalid Strref -1>~ =0) BEGIN
	 WRITE_EVALUATED_ASCII 0x280 ~%sname%~
	 READ_ASCII 0x280 dv (32)NULL
	END
   END
   INNER_ACTION BEGIN
	ACTION_IF (FILE_EXISTS_IN_GAME ~%dialog%.dlg~) THEN BEGIN
	 COMPILE EVALUATE_BUFFER ~inlined/pre_dlg_change.d~
	 COMPILE EVALUATE_BUFFER ~inlined/dlg_change.d~
	 COMPILE EVALUATE_BUFFER ~inlined/post_dlg_change.d~
	END
   END
  END
 END
BUT_ONLY

						!!!!THE SOLUTION ABOVE DOES NOT SEEM TO WORK ON BGT!!!!*/						

COPY ~stweaks/bcs/bgshout.bcs~ override

COPY_EXISTING 	~iron3.cre~ 	~override~
		~iron4.cre~ 	~override~
		~iron7.cre~ 	~override~
		~iron11.cre~ 	~override~
    READ_ASCII SCRIPT_OVERRIDE override
    PATCH_IF (~%override%~ STR_EQ ~SHOUT~ = 1) BEGIN
     WRITE_ASCII 0x248 ~BGSHOUT~
    END
BUT_ONLY

/////////////////////////////////////////////////////////////////////////////////////////////
//! Change initdlg.bcs to force dialogue with Protagonist rather than any party member///////
/////////////////////////////////////////////////////////////////////////////////////////////

BEGIN ~Force initiating dialogue with Protagonist rather than any party member~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 400

COPY ~stweaks/bcs/p1initd.bcs~ ~override~

COPY_EXISTING 	~BELTBRD.CRE~ 	~override~
		~BGCARBOS.CRE~	~override~
		~BGSHANK.CRE~	~override~
		~C6SQUIRE.CRE~	~override~
		~ELMIN2.CRE~	~override~
		~ELMIN3.CRE~	~override~
		~ELMIN5.CRE~	~override~
		~FIREBE.CRE~	~override~
		~GATEWA.CRE~	~override~
		~LARZE.CRE~	~override~
		~WATCH6.CRE~	~override~
READ_ASCII SCRIPT_OVERRIDE override
PATCH_IF (~%override%~ STR_EQ ~INITDLG~ = 1) BEGIN
	WRITE_ASCII SCRIPT_OVERRIDE	~p1initd~	#8
END
BUT_ONLY

COPY_EXISTING 	~BENJY.CRE~ 	~override~
		~CHLOE.CRE~ 	~override~
		~DRUIDAD.CRE~ 	~override~
		~ELMIN1.CRE~ 	~override~
		~GATEWA2.CRE~ 	~override~
		~IMOEN1.CRE~ 	~override~
		~IMOEN2.CRE~ 	~override~
		~IMOEN4.CRE~ 	~override~
		~IMOEN61.CRE~ 	~override~
		~IMOEN1.CRE~ 	~override~
		~IMOENDRM.CRE~ 	~override~
		~LANTAN.CRE~ 	~override~
		~SORREL.CRE~ 	~override~
		~TAMOKO.CRE~ 	~override~
		~WASLEEP.CRE~ 	~override~
		~WIRTHI.CRE~ 	~override~
READ_ASCII SCRIPT_CLASS class
PATCH_IF (~%class%~ STR_EQ ~INITDLG~ = 1) BEGIN
	WRITE_ASCII SCRIPT_CLASS	~p1initd~	#8
END
BUT_ONLY

/////////////////////////////////////////////////////////////////////////////////////////
//! Fix for BGT NPCs disappearing after talking//////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////

BEGIN ~AWful hack around the BGT NPCs disappearing act (install late/after Virtue)~
REQUIRE_PREDICATE (GAME_IS ~bgt~) ~This component only applies to BGT.~
DESIGNATED 500

COPY_EXISTING ~ajantis.bcs~  ~override/ajantis.bcs~
              ~ar6801.bcs~   ~override/ar6801.bcs~
              ~ar9600.bcs~   ~override/ar9600.bcs~
              ~bandit.bcs~   ~override/bandit.bcs~
              ~bandit2.bcs~  ~override/bandit2.bcs~
              ~bandit3.bcs~  ~override/bandit3.bcs~
              ~capcut02.bcs~ ~override/capcut02.bcs~
              ~druid3.bcs~   ~override/druid3.bcs~
              //~gnoll5.bcs~   ~override/gnoll5.bcs~ /*a hard-coded combination change is made below*/
              ~gnoll5a.bcs~  ~override/gnoll5a.bcs~
              ~greywolf.bcs~ ~override/greywolf.bcs~
              ~guard1.bcs~   ~override/guard1.bcs~
              ~guard2.bcs~   ~override/guard2.bcs~
              ~hobgobc.bcs~  ~override/hobgobc.bcs~
              ~kescape.bcs~  ~override/kescape.bcs~
              ~sarrun.bcs~   ~override/sarrun.bcs~
              ~shadow.bcs~   ~override/shadow.bcs~
              ~thief.bcs~    ~override/thief.bcs~
              ~watchen2.bcs~ ~override/watchen2.bcs~
  DECOMPILE_AND_PATCH BEGIN
  REPLACE_TEXTUALLY ~EscapeAreaDestroy(90)~ ~EscapeArea()~
  END
BUT_ONLY

COPY_EXISTING ~ar9600.bcs~  ~override~
  DECOMPILE_AND_PATCH BEGIN
  REPLACE_TEXTUALLY ~ActionOverride("FOOTY",EscapeArea())~ ~ActionOverride("FOOTY",MoveToPointNoInterrupt([2.2274]))
ActionOverride("FOOTY",DestroySelf())~
  END
BUT_ONLY

COPY_EXISTING ~greywolf.bcs~  ~override~
  DECOMPILE_AND_PATCH BEGIN
  REPLACE_TEXTUALLY ~EscapeArea()~ ~MoveToPointNoInterrupt([2680.2])
DestroySelf()~
  END
BUT_ONLY

COMPILE ~stweaks/d/escfix.d~